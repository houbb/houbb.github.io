---
layout: post
title:  CORS
date:  2018-04-04 17:30:47 +0800
categories: [JS]
tags: [js, cors, web]
published: true
---

# CORS

[CORS](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS)


[跨域资源共享 CORS 详解](http://www.ruanyifeng.com/blog/2016/04/cors.html)


# 什么是 CORS

- 常见前端错误信息如下

```
Failed to load https://example.com/: No ‘Access-Control-Allow-Origin’ header is present on the requested resource. Origin ‘https://XXX' is therefore not allowed access. If an opaque response serves your needs, set the request’s mode to ‘no-cors’ to fetch the resource with CORS disabled.
```

上面的错误是因为浏览器的CORS机制导致的

## Cross-Origin Resource Sharing (CORS)

COSR（跨站点资源分享）通俗的讲是跨域问题，严格来说它是**跨域问题的解决方案之一，而且是官方解决方案**。
   
在CORS成为标准之前，是没有办法请求不同域名的后端API的，因为安全原因。请求会被同源策略阻止，现在也是。

## Access-Control-Allow-Origin

- 允许任意域名

`*`

- 完整的域名

```
https://example.com
```

如果你需要客户端传递验证信息到头部（比如：cookies）。这个值不能为 `*`。

## Access-Control-Allow-Credentials

这个头部信息只会在服务器支持通过cookies传递验证信息的返回数据里。

它的值只有一个就是 `true`。

跨站点带验证信息时，服务器必须要争取设置这个值，服务器才能获取到用户的cookie。

## Access-Control-Allow-Headers

提供一个逗号分隔的列表表示服务器支持的请求数据类型。

假如你使用自定义头部(比如：`x-authentication-token` 服务器需要在返回OPTIONS请求时，要把这个值放到这个头部里，否则请求会被阻止)。

## Access-Control-Expose-Headers

相似的，这个返回信息里包含了一组头部信息，这些信息表示那些客户端可以使用。

其他没有在里面的头部信息将会被限制（译者注：这个头信息实战中使用较少）。

## Access-Control-Allow-Methods

一个逗号分隔的列表，表明服务器支持的请求类型（比如：GET, POST）

## Origin

这个头部信息，属于请求数据的一部分。这个值表明这个请求是从浏览器打开的哪个域名下发出的。出于安全原因，浏览器不允许你修改这个值


# 后端解决方式

## SpringBoot

```java
@Configuration
@EnableAsync
public class WebConfig extends WebMvcConfigurerAdapter {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedHeaders("*")
                .allowedMethods("*")
                .allowedOrigins("*")
                // 允许凭证,解决session跨域丢失问题
                .allowCredentials(true)
                .maxAge(3600)
                .exposedHeaders(
                        "Access-Control-Allow-Origin",
                        "Access-Control-Allow-Methods",
                        "Access-Control-Allow-Headers",
                        "Access-Control-Max-Age",
                        "Access-Control-Request-Headers",
                        "Access-Control-Request-Method"
                );
    }
}
```




* any list
{:toc}









 





