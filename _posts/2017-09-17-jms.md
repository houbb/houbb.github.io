---
layout: post
title:  JMS
date:  2017-09-17 10:58:36 +0800
categories: [MQ]
tags: [jms, activeMQ]
published: true
---


# JMS

The Java Message Service (JMS) API is a messaging standard that allows application components based on the Java Platform Enterprise Edition (Java EE) 
to create, send, receive, and read messages. It enables distributed communication that is loosely coupled, reliable, and asynchronous.

## 基本概念

JMS 是 java 的消息服务，JMS 的客户端之间可以通过 JMS 服务进行异步的消息传输。

## 消息模型

- Point-to-Point (P2P)

点对点

- Publish/Subscribe (Pub/Sub)

发布订阅

## P2P

![p2p](https://raw.githubusercontent.com/houbb/resource/master/img/jms/2017-09-20-jms-p2p.png)

P2P 的特点:

- 每个消息只有一个消费者（Consumer）(即一旦被消费，消息就不再在消息队列中)

- 发送者和接收者之间在时间上没有依赖性，也就是说当发送者发送了消息之后，不管接收者有没有正在运行，它不会影响到消息被发送到队列

- 接收者在成功接收消息之后需向队列应答成功。

如果你希望发送的**每个消息都应该被成功处理**的话，那么你需要 P2P 模式。

## Pub/Sub

![Pub/Sub](https://raw.githubusercontent.com/houbb/resource/master/img/jms/2017-09-20-jms-ps.png)

Pub/Sub 的特点:

- 每个消息可以有多个消费者

- 发布者和订阅者之间有时间上的依赖性。针对某个主题（Topic）的订阅者，它必须创建一个订阅者之后，才能消费发布者的消息，而且为了消费消息，订阅者必须保持运行的状态。

- 为了缓和这样严格的时间相关性，JMS允许订阅者创建一个可持久化的订阅。这样，即使订阅者没有被激活（运行），它也能接收到发布者的消息。

如果你希望发送的消息**可以不被做任何处理、或者被一个消息者处理、或者可以被多个消费者处理**的话，那么可以采用 Pub/Sub 模型。


## 消息的消费 

在JMS中，消息的产生和消息是异步的。对于消费来说，JMS的消息者可以通过两种方式来消费消息。 

- 同步
 
订阅者或接收者调用 `receive` 方法来接收消息，receive 方法在能够接收到消息之前（或超时之前）将一直阻塞 

- 异步
 
订阅者或接收者可以注册为一个消息监听器。当消息到达之后，系统自动调用监听器的 `onMessage()` 方法。

## JMS 编程模型

(1) ConnectionFactory

创建Connection对象的工厂，针对两种不同的jms消息模型，分别有QueueConnectionFactory和TopicConnectionFactory两种。可以通过JNDI来查找ConnectionFactory对象。

(2) Destination

Destination的意思是消息生产者的消息发送目标或者说消息消费者的消息来源。对于消息生产者来说，它的Destination是某个队列（Queue）或某个主题（Topic）;对于消息消费者来说，它的Destination也是某个队列或主题（即消息来源）。

所以，Destination实际上就是两种类型的对象：Queue、Topic可以通过JNDI来查找Destination。

(3) Connection

Connection表示在客户端和JMS系统之间建立的链接（对TCP/IP socket的包装）。Connection可以产生一个或多个Session。跟ConnectionFactory一样，Connection也有两种类型：QueueConnection和TopicConnection。

(4) Session

Session是我们操作消息的接口。可以通过session创建生产者、消费者、消息等。Session提供了事务的功能。当我们需要使用session发送/接收多个消息时，可以将这些发送/接收动作放到一个事务中。同样，也分QueueSession和TopicSession。

(5) 消息的生产者

消息生产者由Session创建，并用于将消息发送到Destination。同样，消息生产者分两种类型：QueueSender和TopicPublisher。可以调用消息生产者的方法（send或publish方法）发送消息。

(6) 消息消费者

消息消费者由Session创建，用于接收被发送到Destination的消息。两种类型：QueueReceiver和TopicSubscriber。可分别通过session的createReceiver(Queue)或createSubscriber(Topic)来创建。当然，也可以session的creatDurableSubscriber方法来创建持久化的订阅者。

(7) MessageListener

消息监听器。如果注册了消息监听器，一旦消息到达，将自动调用监听器的onMessage方法。EJB中的MDB（Message-Driven Bean）就是一种MessageListener。

## 优点

- 提供消息灵活性

- 松散耦合

- 异步性

# 参考资料

[深入浅出JMS(一)--JMS基本概念](http://blog.csdn.net/jiuqiyuliang/article/details/46701559)

[JMS(Java消息服务)入门教程](http://www.cnblogs.com/chenpi/p/5559349.html)

* any list
{:toc}












 

