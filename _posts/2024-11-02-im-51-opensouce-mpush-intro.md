---
layout: post
title: IM å³æ—¶é€šè®¯ç³»ç»Ÿ-51-MPushå¼€æºå®æ—¶æ¶ˆæ¯æ¨é€ç³»ç»Ÿ
date: 2024-11-02 21:01:55 +0800
categories: [IM]
tags: [im, opensource, sh]
published: true
---

# IM å¼€æºç³»åˆ—

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-41-å¼€æº é‡ç«IM ä¸“æ³¨äºå³æ—¶é€šè®¯å®æ—¶éŸ³è§†é¢‘æŠ€æœ¯ï¼Œæä¾›ä¼˜è´¨å¯æ§çš„IM+RTCèƒ½åŠ›](https://houbb.github.io/2024/11/02/im-41-opensouce-yehuo-overview)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-42-åŸºäºnettyå®ç°çš„IMæœåŠ¡ç«¯,æä¾›å®¢æˆ·ç«¯jaråŒ…,å¯é›†æˆè‡ªå·±çš„ç™»å½•ç³»ç»Ÿ](https://houbb.github.io/2024/11/02/im-42-opensouce-yuanrw-im-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-43-ç®€å•çš„ä»¿QQèŠå¤©å®‰å“APP](https://houbb.github.io/2024/11/02/im-43-opensouce-xiuweikang-im)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-44-ä»¿QQå³æ—¶é€šè®¯ç³»ç»ŸæœåŠ¡ç«¯](https://houbb.github.io/2024/11/02/im-44-opensouce-kingston-csj-im)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-45-merua0oo0 IM åˆ†å¸ƒå¼èŠå¤©ç³»ç»Ÿ](https://houbb.github.io/2024/11/02/im-45-opensouce-merua0oo0-im)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-46-OpenIM æä¾›äº†ä¸“ä¸ºå¼€å‘è€…è®¾è®¡çš„å¼€æºå³æ—¶é€šè®¯è§£å†³æ–¹æ¡ˆ](https://houbb.github.io/2024/11/02/im-46-opensouce-open-im-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-47-beardlessCat IM ä½¿ç”¨nettyå¼€å‘åˆ†å¸ƒå¼Imï¼Œæä¾›åˆ†å¸ƒnettyé›†ç¾¤è§£å†³æ–¹æ¡ˆ](https://houbb.github.io/2024/11/02/im-47-opensouce-beardlessCat-im-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-48-aurora-imui æ˜¯ä¸ªé€šç”¨çš„å³æ—¶é€šè®¯ï¼ˆIMï¼‰UI åº“ï¼Œä¸ç‰¹å®šäºä»»ä½• IM SDK](https://houbb.github.io/2024/11/02/im-48-opensouce-aurora-imui-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-49-äº‘ä¿¡ IM UIKit æ˜¯åŸºäº NIM SDKï¼ˆç½‘æ˜“äº‘ä¿¡ IM SDKï¼‰å¼€å‘çš„ä¸€æ¬¾å³æ—¶é€šè®¯ UI ç»„ä»¶åº“ï¼ŒåŒ…æ‹¬èŠå¤©ã€ä¼šè¯ã€åœˆç»„ã€æœç´¢ã€ç¾¤ç®¡ç†ç­‰ç»„ä»¶](https://houbb.github.io/2024/11/02/im-49-opensouce-nim-uikit-android-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-50-ğŸ“²cim(cross IM) é€‚ç”¨äºå¼€å‘è€…çš„åˆ†å¸ƒå¼å³æ—¶é€šè®¯ç³»ç»Ÿ](https://houbb.github.io/2024/11/02/im-50-opensouce-cim-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-51-MPushå¼€æºå®æ—¶æ¶ˆæ¯æ¨é€ç³»ç»Ÿ](https://houbb.github.io/2024/11/02/im-51-opensouce-mpush-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-52-leo-im æœåŠ¡ç«¯](https://houbb.github.io/2024/11/02/im-52-opensouce-leo-im-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-53-im system server](https://houbb.github.io/2024/11/02/im-53-opensouce-linyu-intro)

# IM

https://github.com/mpusher/mpush

# mpush

## [è¯¦ç»†æ•™ç¨‹](http://mpush.mydoc.io)

* å®˜ç½‘ï¼š[https://mpusher.github.io](https://mpusher.github.io)

* æ–‡æ¡£ï¼š[http://mpush.mydoc.io](http://mpush.mydoc.io)

## æºç 

* group [https://github.com/mpusher/](https://github.com/mpusher/) æºä»£ç ç©ºé—´

* server [https://github.com/mpusher/mpush](https://github.com/mpusher/mpush) æœåŠ¡ç«¯æºç 

* alloc [https://github.com/mpusher/alloc](https://github.com/mpusher/alloc)  è°ƒåº¦å™¨æºç 

* mpns [https://github.com/mpusher/mpns](https://github.com/mpusher/mpns)     ä¸ªæ€§åŒ–æ¨é€ä¸­å¿ƒæºç 

* java-client [https://github.com/mpusher/mpush-client-java](https://github.com/mpusher/mpush-client-java) çº¯javaå®¢æˆ·ç«¯æºç 

* android sdk&demo [https://github.com/mpusher/mpush-android](https://github.com/mpusher/mpush-android)    å®‰å“SDKå’ŒDEMOæºç 

* IOS sdk(swift) [https://github.com/mpusher/mpush-client-swift](https://github.com/mpusher/mpush-client-swift) swiftç‰ˆå®¢æˆ·ç«¯æºç 

* IOS sdk(OC) [https://github.com/mpusher/mpush-client-oc](https://github.com/mpusher/mpush-client-oc)  Object C å®¢æˆ·ç«¯æºç 

ps:ç”±äºæºç åˆ†åˆ«åœ¨githubå’Œç äº‘æœ‰ä¸¤ä»½ï¼Œæœ€æ–°çš„ä»£ç ä»¥githubä¸ºä¸»

## æœåŠ¡è°ƒç”¨å…³ç³»

![](https://mpusher.github.io/docs/æœåŠ¡ä¾èµ–å…³ç³».png)

## æºç æµ‹è¯•

1. ```git clone https://github.com/mpusher/mpush.git```

2. å¯¼å…¥åˆ°eclipseæˆ–Intellij IDEA

3. æ‰“å¼€```mpush-test```æ¨¡å—ï¼Œæ‰€æœ‰çš„æµ‹è¯•ä»£ç éƒ½åœ¨è¯¥æ¨¡å—ä¸‹

4. ä¿®æ”¹é…ç½®æ–‡ä»¶```src/test/resource/application.conf```æ–‡ä»¶ä¿®æ”¹æ–¹å¼å‚ç…§ æœåŠ¡éƒ¨ç½²ç¬¬6ç‚¹

5. è¿è¡Œ```com.mpush.test.sever.ServerTestMain.java```å¯åŠ¨é•¿é“¾æ¥æœåŠ¡

6. è¿è¡Œ```com.mpush.test.client.ConnClientTestMain.java``` æ¨¡æ‹Ÿä¸€ä¸ªå®¢æˆ·ç«¯

7. è¿è¡Œ```com.mpush.test.push.PushClientTestMain``` æ¨¡æ‹Ÿç»™ç”¨æˆ·ä¸‹å‘æ¶ˆæ¯

8. å¯ä»¥åœ¨æ§åˆ¶å°è§‚å¯Ÿæ—¥å¿—çœ‹æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œæ¶ˆæ¯æ˜¯å¦ä¸‹å‘æˆåŠŸ

## æœåŠ¡éƒ¨ç½²

###### è¯´æ˜ï¼šmpush æœåŠ¡åªä¾èµ–äºzookeeperå’Œredisï¼Œå½“ç„¶è¿˜æœ‰JDK>=1.8

1. å®‰è£…```jdk 1.8``` ä»¥ä¸Šç‰ˆæœ¬å¹¶è®¾ç½®```%JAVA_HOMEï¼…```

2. å®‰è£…```zookeeper``` (å®‰è£…é…ç½®æ­¥éª¤ç•¥)

3. å®‰è£…```Redis``` (å®‰è£…é…ç½®æ­¥éª¤ç•¥)

4. ä¸‹è½½mpush server æœ€æ–°çš„æ­£å¼åŒ…[https://github.com/mpusher/mpush/releases](https://github.com/mpusher/mpush/releases)

5. è§£å‹ä¸‹è½½çš„taråŒ…`tar -zvxf mpush-release-0.0.2.tar.gz`åˆ° mpush ç›®å½•, ç»“æ„å¦‚ä¸‹

   ><pre class="md-fences">
   >drwxrwxr-x 2 shinemo shinemo  4096 Aug 20 09:30 bin â€”> å¯åŠ¨è„šæœ¬
   >drwxrwxr-x 2 shinemo shinemo  4096 Aug 20 09:52 conf â€”> é…ç½®æ–‡ä»¶
   >drwxrwxr-x 2 shinemo shinemo  4096 Aug 20 09:29 lib â€”> æ ¸å¿ƒç±»åº“
   >-rw-rw-r-- 1 shinemo shinemo 11357 May 31 11:07 LICENSE
   >drwxrwxr-x 2 shinemo shinemo  4096 Aug 20 09:32 logs â€”> æ—¥å¿—ç›®å½•
   >-rw-rw-r-- 1 shinemo shinemo    21 May 31 11:07 README.md
   >drwxrwxr-x 2 shinemo shinemo  4096 Aug 20 09:52 tmp
   ></pre>

6. ä¿®æ”¹ conf ç›®å½•ä¸‹çš„ ```vi mpush.conf```æ–‡ä»¶, ```mpush.conf```é‡Œçš„é…ç½®é¡¹ä¼šè¦†ç›–åŒç›®å½•ä¸‹çš„```reference.conf```æ–‡ä»¶
   ```java
      #ä¸»è¦ä¿®æ”¹ä»¥ä¸‹é…ç½®
      mp.net.connect-server-port=3000//é•¿é“¾æ¥æœåŠ¡å¯¹å¤–ç«¯å£, å…¬ç½‘ç«¯å£
      mp.zk.server-address="127.0.0.1:2181"//zk æœºå™¨çš„åœ°å€
      mp.redis={//redis ç›¸å…³é…ç½®
            nodes:["127.0.0.1:6379"] //æ ¼å¼æ˜¯ip:port
            cluster-model:single //single, cluster
      }
      //è¿˜æœ‰ç”¨äºå®‰å…¨åŠ å¯†çš„RSA mp.security.private-key å’Œ mp.security.public-key ç­‰...
   ```
    å¦‚æœè¦ä¿®æ”¹å…¶ä»–é…ç½®è¯·å‚ç…§reference.confæ–‡ä»¶

7. ç»™binç›®å½•ä¸‹çš„è„šæœ¬å¢åŠ æ‰§è¡Œæƒé™```chmod u+x *.sh```

8. æ‰§è¡Œ```./mp.sh start``` å¯åŠ¨æœåŠ¡, æŸ¥çœ‹å¸®åŠ©```./mp.sh``` ç›®å‰æ”¯æŒçš„å‘½ä»¤ï¼š

   ```Usage: ./mp.sh {start|start-foreground|stop|restart|status|upgrade|print-cmd}```

   ```set-env.sh``` ç”¨äºå¢åŠ å’Œä¿®æ”¹jvmå¯åŠ¨å‚æ•°ï¼Œæ¯”å¦‚å †å†…å­˜ã€å¼€å¯è¿œç¨‹è°ƒè¯•ç«¯å£ã€å¼€å¯jmxç­‰

9. ```cd logs```ç›®å½•ï¼Œ```cat mpush.out```æŸ¥çœ‹æœåŠ¡æ˜¯å¦å¯åŠ¨æˆåŠŸ
10. é›†æˆéƒ¨ç½²ï¼Œæ¯”å¦‚é›†æˆåˆ°ç°æœ‰webå·¥ç¨‹ä¸€èµ·éƒ¨ç½²åˆ°tomcat,å¯ä»¥æ·»åŠ å¦‚ä¸‹ä¾èµ–
   
   ```xml
   <dependency>
      <groupId>com.github.mpusher</groupId>
      <artifactId>mpush-boot</artifactId>
      <version>0.0.2</version>
   </dependency>
   ```
   å¯åŠ¨å…¥å£`com.mpush.bootstrap.ServerLauncher.java` 
   
## é…ç½®æ–‡ä»¶è¯¦è§£
   ```java
##################################################################################################################
#
# NOTICEï¼š
#
# ç³»ç»Ÿé…ç½®æ–‡ä»¶ï¼Œæ‰€æœ‰åˆ—å‡ºçš„é¡¹æ˜¯ç³»ç»Ÿæ‰€æ”¯æŒå…¨éƒ¨é…ç½®é¡¹
# å¦‚æœè¦è¦†ç›–æŸé¡¹çš„å€¼å¯ä»¥æ·»åŠ åˆ°mpush.confä¸­ã€‚
#
# é…ç½®æ–‡ä»¶æ ¼å¼é‡‡ç”¨HOCONæ ¼å¼ã€‚è§£æåº“ç”±https://github.com/typesafehub/configæä¾›ã€‚
# å…·ä½“å¯å‚ç…§è¯´æ˜æ–‡æ¡£ï¼Œæ¯”å¦‚å«æœ‰ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²å¿…é¡»ç”¨åŒå¼•å·åŒ…èµ·æ¥ã€‚
#
##################################################################################################################

mp {
    #åŸºç¡€é…ç½®
    home=${user.dir} //ç¨‹åºå·¥ä½œç›®å½•

    #æ—¥å¿—é…ç½®
    log-level=warn
    log-dir=${mp.home}/logs
    log-conf-path=${mp.home}/conf/logback.xml

    #æ ¸å¿ƒé…ç½®
    core {
        max-packet-size=10k //ç³»ç»Ÿå…è®¸ä¼ è¾“çš„æœ€å¤§åŒ…çš„å¤§å°
        compress-threshold=10k //æ•°æ®åŒ…å¯ç”¨å‹ç¼©çš„ä¸´ç•Œå€¼ï¼Œè¶…è¿‡è¯¥å€¼åå¯¹æ•°æ®è¿›è¡Œå‹ç¼©
        min-heartbeat=3m //æœ€å°å¿ƒè·³é—´éš”
        max-heartbeat=3m //æœ€å¤§å¿ƒè·³é—´éš”
        max-hb-timeout-times=2 //å…è®¸çš„å¿ƒè·³è¿ç»­è¶…æ—¶çš„æœ€å¤§æ¬¡æ•°
        session-expired-time=1d //ç”¨äºå¿«é€Ÿé‡è¿çš„session è¿‡æœŸæ—¶é—´é»˜è®¤1å¤©
        epoll-provider=netty //nio:jdkè‡ªå¸¦ï¼Œnetty:ç”±nettyå®ç°
    }

    #å®‰å…¨é…ç½®
    security {
        #rsa ç§é’¥ã€å…¬é’¥keyé•¿åº¦ä¸º1024;å¯ä»¥ä½¿ç”¨è„šæœ¬bin/rsa.shç”Ÿæˆ, @see com.mpush.tools.crypto.RSAUtils#main
        private-key="MIIBNgIBADANBgkqhkiG9w0BAQEFAASCASAwggEcAgEAAoGBAKCE8JYKhsbydMPbiO7BJVq1pbuJWJHFxOR7L8Hv3ZVkSG4eNC8DdwAmDHYu/wadfw0ihKFm2gKDcLHp5yz5UQ8PZ8FyDYvgkrvGV0ak4nc40QDJWws621dm01e/INlGKOIStAAsxOityCLv0zm5Vf3+My/YaBvZcB5mGUsPbx8fAgEAAoGAAy0+WanRqwRHXUzt89OsupPXuNNqBlCEqgTqGAt4Nimq6Ur9u2R1KXKXUotxjp71Ubw6JbuUWvJg+5Rmd9RjT0HOUEQF3rvzEepKtaraPhV5ejEIrB+nJWNfGye4yzLdfEXJBGUQzrG+wNe13izfRNXI4dN/6Q5npzqaqv0E1CkCAQACAQACAQACAQACAQA="
        public-key="MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCghPCWCobG8nTD24juwSVataW7iViRxcTkey/B792VZEhuHjQvA3cAJgx2Lv8GnX8NIoShZtoCg3Cx6ecs+VEPD2fBcg2L4JK7xldGpOJ3ONEAyVsLOttXZtNXvyDZRijiErQALMTorcgi79M5uVX9/jMv2Ggb2XAeZhlLD28fHwIDAQAB"
        aes-key-length=16 //AES key é•¿åº¦
    }

    #ç½‘ç»œé…ç½®
    net {
        local-ip=""  //æœ¬åœ°ip, é»˜è®¤å–ç¬¬ä¸€ä¸ªç½‘å¡çš„æœ¬åœ°IP
        public-ip="" //å¤–ç½‘ip, é»˜è®¤å–ç¬¬ä¸€ä¸ªç½‘å¡çš„å¤–ç½‘IP

        connect-server-bind-ip=""  //connSrv ç»‘å®šçš„æœ¬åœ°ip (é»˜è®¤anyLocalAddress 0.0.0.0 or ::0)
        connect-server-register-ip=${mp.net.public-ip}  //å…¬ç½‘ip, æ³¨å†Œåˆ°zkä¸­çš„ip, é»˜è®¤æ˜¯public-ip
        connect-server-port=3000 //é•¿é“¾æ¥æœåŠ¡å¯¹å¤–ç«¯å£, å…¬ç½‘ç«¯å£
        connect-server-register-attr { //æ³¨å†Œåˆ°zké‡Œçš„é¢å¤–å±æ€§ï¼Œæ¯”å¦‚é…ç½®æƒé‡ï¼Œå¯åœ¨allocé‡Œæ’åº
            weight:1
        }

        gateway-server-bind-ip=""  //gatewaySrv ç»‘å®šçš„æœ¬åœ°ip (é»˜è®¤anyLocalAddress 0.0.0.0 or ::0)
        gateway-server-register-ip=${mp.net.local-ip}  //æœ¬åœ°ip, æ³¨å†Œåˆ°zkä¸­çš„ip, é»˜è®¤æ˜¯local-ip
        gateway-server-port=3001 //ç½‘å…³æœåŠ¡ç«¯å£, å†…éƒ¨ç«¯å£
        gateway-server-net=tcp //ç½‘å…³æœåŠ¡ä½¿ç”¨çš„ç½‘ç»œç±»å‹tcp/udp/sctp/udt

        gateway-client-port=4000 //UDP å®¢æˆ·ç«¯ç«¯å£
        gateway-server-multicast="239.239.239.88" //239.0.0.0ï½239.255.255.255ä¸ºæœ¬åœ°ç®¡ç†ç»„æ’­åœ°å€ï¼Œä»…åœ¨ç‰¹å®šçš„æœ¬åœ°èŒƒå›´å†…æœ‰æ•ˆ
        gateway-client-multicast="239.239.239.99" //239.0.0.0ï½239.255.255.255ä¸ºæœ¬åœ°ç®¡ç†ç»„æ’­åœ°å€ï¼Œä»…åœ¨ç‰¹å®šçš„æœ¬åœ°èŒƒå›´å†…æœ‰æ•ˆ
        gateway-client-num=1 //ç½‘å…³å®¢æˆ·ç«¯è¿æ¥æ•°

        admin-server-port=3002 //æ§åˆ¶å°æœåŠ¡ç«¯å£, å†…éƒ¨ç«¯å£
        ws-server-port=0 //websocketå¯¹å¤–ç«¯å£, å…¬ç½‘ç«¯å£, 0è¡¨ç¤ºç¦ç”¨websocket
        ws-path="/" //websocket path

        public-host-mapping { //æœ¬æœºå±€åŸŸç½‘IPå’Œå…¬ç½‘IPçš„æ˜ å°„å…³ç³», è¯¥é…ç½®åç»­ä¼šè¢«åºŸå¼ƒ
            //"10.0.10.156":"111.1.32.137"
            //"10.0.10.166":"111.1.33.138"
        }

        snd_buf { //tcp/udp å‘é€ç¼“å†²åŒºå¤§å°
            connect-server=32k
            gateway-server=0
            gateway-client=0 //0è¡¨ç¤ºä½¿ç”¨æ“ä½œç³»ç»Ÿé»˜è®¤å€¼
        }

        rcv_buf { //tcp/udp æ¥æ”¶ç¼“å†²åŒºå¤§å°
            connect-server=32k
            gateway-server=0
            gateway-client=0 //0è¡¨ç¤ºä½¿ç”¨æ“ä½œç³»ç»Ÿé»˜è®¤å€¼
        }

        write-buffer-water-mark { //netty å†™ä¿æŠ¤
            connect-server-low=32k
            connect-server-high=64k
            gateway-server-low=10m
            gateway-server-high=20m
        }

        traffic-shaping { //æµé‡æ•´å½¢é…ç½®
            gateway-client {
                enabled:false
                check-interval:100ms
                write-global-limit:30k
                read-global-limit:0
                write-channel-limit:3k
                read-channel-limit:0
            }

            gateway-server {
                enabled:false
                check-interval:100ms
                write-global-limit:0
                read-global-limit:30k
                write-channel-limit:0
                read-channel-limit:3k
            }

            connect-server {
                enabled:false
                check-interval:100ms
                write-global-limit:0
                read-global-limit:100k
                write-channel-limit:3k
                read-channel-limit:3k
            }
        }
    }

    #Zookeeperé…ç½®
    zk {
        server-address="127.0.0.1:2181" //å¤šå°æœºå™¨ä½¿ç”¨","åˆ†éš”å¦‚ï¼š"10.0.10.44:2181,10.0.10.49:2181" @see org.apache.zookeeper.ZooKeeper#ZooKeeper()
        namespace=mpush
        digest=mpush //zkCli.sh acl å‘½ä»¤ addauth digest mpush
        watch-path=/
        retry {
            #initial amount of time to wait between retries
            baseSleepTimeMs=3s
            #max number of times to retry
            maxRetries=3
            #max time in ms to sleep on each retry
            maxSleepMs=5s
        }
        connectionTimeoutMs=5s
        sessionTimeoutMs=5s
    }

    #Redisé›†ç¾¤é…ç½®
    redis {
        cluster-model=single //single,cluster,sentinel
        sentinel-master:""
        nodes:[] s//["127.0.0.1:6379"]æ ¼å¼ip:port
        password="" //your password
        config {
            maxTotal:8,
            maxIdle:4,
            minIdle:1,
            lifo:true,
            fairness:false,
            maxWaitMillis:5000,
            minEvictableIdleTimeMillis:300000,
            softMinEvictableIdleTimeMillis:1800000,
            numTestsPerEvictionRun:3,
            testOnCreate:false,
            testOnBorrow:false,
            testOnReturn:false,
            testWhileIdle:false,
            timeBetweenEvictionRunsMillis:60000,
            blockWhenExhausted:true,
            jmxEnabled:false,
            jmxNamePrefix:pool,
            jmxNameBase:pool
        }
    }

    #HTTPä»£ç†é…ç½®
    http {
        proxy-enabled=false //å¯ç”¨Httpä»£ç†
        max-conn-per-host=5 //æ¯ä¸ªåŸŸåçš„æœ€å¤§é“¾æ¥æ•°, å»ºè®®webæœåŠ¡nginxè¶…æ—¶æ—¶é—´è®¾é•¿ä¸€ç‚¹, ä»¥ä¾¿ä¿æŒé•¿é“¾æ¥
        default-read-timeout=10s //è¯·æ±‚è¶…æ—¶æ—¶é—´
        max-content-length=5m //response body æœ€å¤§å¤§å°
        dns-mapping { //åŸŸåæ˜ å°„å¤–ç½‘åœ°å€è½¬å†…éƒ¨IP, åŸŸåéƒ¨åˆ†ä¸åŒ…å«ç«¯å£å·
            //"mpush.com":["127.0.0.1:8080", "127.0.0.1:8081"]
        }
    }

    #çº¿ç¨‹æ± é…ç½®
    thread {
        pool {
            conn-work:0 //æ¥å…¥æœåŠ¡çº¿ç¨‹æ± å¤§å°ï¼Œ0è¡¨ç¤ºçº¿ç¨‹æ•°æ ¹æ®cpuæ ¸æ•°åŠ¨æ€è°ƒæ•´(2*cpu)
            gateway-server-work:0 //ç½‘å…³æœåŠ¡çº¿ç¨‹æ± å¤§å°ï¼Œ0è¡¨ç¤ºçº¿ç¨‹æ•°æ ¹æ®cpuæ ¸æ•°åŠ¨æ€è°ƒæ•´(2*cpu)
            http-work:0 //http proxy netty client work pool sizeï¼Œ0è¡¨ç¤ºçº¿ç¨‹æ•°æ ¹æ®cpuæ ¸æ•°åŠ¨æ€è°ƒæ•´(2*cpu)
            ack-timer:1 //å¤„ç†ACKæ¶ˆæ¯è¶…æ—¶
            push-task:0 //æ¶ˆæ¯æ¨é€ä¸­å¿ƒï¼Œæ¨é€ä»»åŠ¡çº¿ç¨‹æ± å¤§å°, å¦‚æœä¸º0è¡¨ç¤ºä½¿ç”¨Gateway Serverçš„workçº¿ç¨‹æ± ï¼Œtcpä¸‹æ¨è0
            gateway-client-work:0 //ç½‘å…³å®¢æˆ·ç«¯çº¿ç¨‹æ± å¤§å°ï¼Œ0è¡¨ç¤ºçº¿ç¨‹æ•°æ ¹æ®cpuæ ¸æ•°åŠ¨æ€è°ƒæ•´(2*cpu)ï¼Œè¯¥çº¿ç¨‹æ± åœ¨å®¢æˆ·ç«¯è¿è¡Œ
            push-client:2 //æ¶ˆæ¯æ¨é€å›è°ƒå¤„ç†ï¼Œè¯¥çº¿ç¨‹æ± åœ¨å®¢æˆ·ç«¯è¿è¡Œ

            event-bus { //ç”¨æˆ·å¤„ç†å†…éƒ¨äº‹ä»¶åˆ†å‘
                min:1
                max:16
                queue-size:10000 //å¤§é‡çš„onlineï¼Œoffline
            }

            mq { //ç”¨æˆ·ä¸Šä¸‹çº¿æ¶ˆæ¯, è¸¢äººç­‰
                min:1
                max:4
                queue-size:10000
            }
        }
    }

    #æ¨é€æ¶ˆæ¯æµæ§
    push {
       flow-control { //qps = limit/(duration)
            global:{ //é’ˆå¯¹éå¹¿æ’­æ¨é€çš„æµæ§ï¼Œå…¨å±€æœ‰æ•ˆ
                limit:5000 //qps = 5000
                max:0 //UN limit
                duration:1s //1s
            }

            broadcast:{ //é’ˆå¯¹å¹¿æ’­æ¶ˆæ¯çš„æµæ§ï¼Œå•æ¬¡ä»»åŠ¡æœ‰æ•ˆ
                limit:3000 //qps = 3000
                max:100000 //10w
                duration:1s //1s
            }
       }
    }

    #ç³»ç»Ÿç›‘æ§é…ç½®
    monitor {
        dump-dir=${mp.home}/tmp
        dump-stack=false //æ˜¯å¦å®šæ—¶dumpå †æ ˆ
        dump-period=1m  //å¤šä¹…ç›‘æ§ä¸€æ¬¡
        print-log=true //æ˜¯å¦æ‰“å°ç›‘æ§æ—¥å¿—
        profile-enabled=false //å¼€å¯æ€§èƒ½ç›‘æ§
        profile-slowly-duration=10ms //è€—æ—¶è¶…è¿‡10msæ‰“å°æ—¥å¿—
    }

    #SPIæ‰©å±•é…ç½®
    spi {
        thread-pool-factory:"com.mpush.tools.thread.pool.DefaultThreadPoolFactory"
        dns-mapping-manager:"com.mpush.common.net.HttpProxyDnsMappingManager"
    }
}
```
11. æœªå®Œå¾…ç»­...


# å‚è€ƒèµ„æ–™

* any list
{:toc}