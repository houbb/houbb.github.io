---
layout: post
title: 监控报警系统如何实现自监控?
date: 2024-11-23 01:18:08 +0800
categories: [Note]
tags: [note, sh]
published: true
---

# 随笔

[从千万粉丝“何同学”抄袭开源项目说起，为何纯技术死路一条？](https://houbb.github.io/2024/11/22/note-02-he-tech)

[数据源的统一与拆分](https://houbb.github.io/2024/11/22/note-03-split-apache-calcite)

[监控报警系统的指标、规则与执行闭环](https://houbb.github.io/2024/11/22/note-04-indicator-rule-execute-mearurement)

[我们的系统应该配置哪些监控报警项？](https://houbb.github.io/2024/11/22/note-04-indicator-rule-items)

[监控报警系统如何实现自监控?](https://houbb.github.io/2024/11/22/note-04-indicator-rule-items-self-monitor)

[java 老矣，尚能饭否？](https://houbb.github.io/2024/11/22/note-05-is-java-so-old)

[一骑红尘妃子笑，无人知是荔枝来!](https://houbb.github.io/2024/11/22/note-06-lizhi)

# 监控系统自己如何自监控？

我们前面在 [我们的系统应该配置哪些监控报警项？](https://houbb.github.io/2024/11/22/note-04-indicator-rule-items) 介绍了一些基本应用应该如何配置，那么监控系统本身如果出问题了怎么办?

下面简单分析一下应该有哪些自监控的配置？

## 一、报警数据采集

1. **数据采集延迟**  
   监控日志和指标数据的采集延迟，避免报警滞后错过关键时机。  
2. **数据丢失率**  
   检查采集过程中是否丢失数据，防止漏报关键问题。  
3. **采集数据量**  
   监控单位时间内的数据量异常，排查采集系统故障或异常业务行为。  

---

## 二、报警生成
1. **规则匹配耗时**  
   检测报警规则触发的时间延迟，确保及时生成报警。  
2. **报警生成率**  
   分析单位时间内的报警数量，避免漏报或误报。  
3. **规则异常**  
   检查规则是否加载失败、重复或无效，确保报警可靠性。  

---

## 三、报警传输与通知
1. **通知通道可用性**  
   确保短信、邮件、Webhook等通知方式正常可用。  
2. **通知发送延迟**  
   监控从报警生成到发送的时间，降低延迟影响。  
3. **通知失败率**  
   追踪通知失败比例，确保关键报警送达。  

---

## 四、报警系统性能
1. **系统吞吐量**  
   监控每秒可处理的报警量，防止高并发导致崩溃。  
2. **资源使用情况**  
   跟踪CPU、内存、磁盘等资源消耗，确保系统稳定。  
3. **队列长度**  
   检查消息队列堆积，避免处理瓶颈。  

---

## 五、系统健康状态
1. **组件运行状况**  
   定期检查采集、处理、通知等模块的健康状态，避免整体瘫痪。  
2. **日志监控**  
   监测报警系统日志中的错误关键字或流量异常，排查潜在问题。  
3. **依赖服务可用性**  
   确保数据库、消息队列等关键服务正常运行，避免系统停摆。  

# 监控系统故障应对

当报警系统自身出现问题时，应采取以下措施：

- **独立监控报警系统**：通过第三方工具监测其运行状态。  

- **冗余设计**：部署多套系统，确保故障切换。  

- **自动化恢复**：配置自愈策略，定时重启或重新部署服务。  

通过这些优化，报警系统将更加高效、稳定，保障业务连续性。

引入另一个维度，比如服务台人去观察服务是否正常。

------------------------------------------------------------------------------------------------------


# 监控系统自己挂了怎么办？

当报警系统本身出现故障甚至完全宕机时，如何及时发现并恢复是一个关键问题。

以下是常见的应对方案和设计原则，可以提高报警系统的可靠性，并确保即使系统本身挂掉，也能及时处理问题：

---

### 一、**多层次冗余设计**
1. **独立的备用报警系统**
   - **实现方式**：部署一个简化版的备用报警系统（Shadow Alarm System），仅监控主报警系统的状态，并在主系统不可用时接管报警功能。
   - **优点**：即使主系统宕机，备用系统仍能持续监控。
   - **注意事项**：备用系统应尽量简化，减少复杂性引入的潜在问题。

2. **分布式部署**
   - **实现方式**：在不同的地理位置或数据中心部署多实例的报警系统。
   - **优点**：避免单点故障，系统间可以互相监控。
   - **注意事项**：需要合理配置负载均衡和故障转移。

---

### 二、**系统外部监控**
1. **使用外部监控服务**
   - **实现方式**：借助第三方监控工具（如Prometheus、Zabbix、Pingdom）监控报警系统的健康状态。
   - **优点**：将监控逻辑外包，可以有效监控报警系统本身的可用性。
   - **监控项**：
     - 报警系统的服务端口是否可用。
     - 数据是否按预期流动（例如，检查报警数据是否持续写入数据库）。
     - 通知通道（如邮件服务器、短信网关）是否正常。

2. **健康探针机制**
   - **实现方式**：设置一个定时运行的外部探针服务，通过心跳检查报警系统的运行状态。
   - **优点**：能在报警系统挂掉时触发上层运维报警。

---

### 三、**自动化恢复机制**
1. **故障自愈**
   - **实现方式**：引入监控恢复脚本，当检测到报警系统挂掉时，自动重启服务或切换到备用实例。
   - **优点**：减少人工干预，提升系统可用性。
   - **工具支持**：可以使用Kubernetes的`livenessProbe`或`readinessProbe`，实现自动检测和容器重启。

2. **备用通知机制**
   - **实现方式**：在报警系统挂掉时，触发基础设施层的独立通知（如短信、电话通知）。
   - **优点**：确保关键人员能够第一时间得知系统故障。
   - **常见实现**：
     - 云厂商的监控（如AWS CloudWatch、阿里云监控）。
     - 简单脚本，定期检查报警系统状态。

---

### 四、**最低限度功能的设计**
1. **轻量级核心功能**
   - **实现方式**：为报警系统设计一个独立的最小化核心模块，负责：
     - 检测系统健康。
     - 转发关键报警信息。
   - **优点**：即使主系统挂掉，核心功能仍可运行，保证系统的最低可用性。

2. **报警缓冲**
   - **实现方式**：在报警系统不可用时，数据存储在可靠的缓冲（如Kafka、RabbitMQ）中，待系统恢复后重新处理。
   - **优点**：避免报警信息丢失。

---

### 五、**分级告警**
1. **监控报警系统的健康告警**
   - **实现方式**：将报警系统自身的健康状态设为最高优先级。
   - **优点**：及时响应报警系统的故障。
   - **具体监控**：
     - CPU、内存、网络等基础资源。
     - 报警队列长度、处理延迟。
     - 通知通道状态（如短信网关、邮件服务）。

2. **脱机告警**
   - **实现方式**：当检测到报警系统不可用时，触发其他独立渠道（如电话报警或手动通知）。
   - **优点**：确保系统完全挂掉时仍能及时响应。

---

### 六、**全面日志和审计**
1. **日志集中化**
   - **实现方式**：将报警系统的运行日志发送到独立的日志系统（如ELK、Loki）。
   - **优点**：即使报警系统挂掉，日志仍然可用以分析原因。

2. **操作审计**
   - **实现方式**：记录所有对报警系统的操作变更（如规则修改、配置变更）。
   - **优点**：在系统挂掉后，可以快速回溯原因。

---

### 七、**人力和流程支持**
1. **轮值监控**
   - **实现方式**：安排专人值班，定期检查报警系统的状态。
   - **优点**：作为技术解决方案的补充，确保系统在挂掉时及时响应。

2. **故障预案**
   - **实现方式**：设计详细的故障处理预案，包括重启步骤、切换流程和应急联系人。
   - **优点**：减少故障发生时的响应时间。

---

### 综合设计思路
1. **“系统监控系统”的概念**：报警系统不应该孤立，应该被更高一层的监控体系监控。
2. **多层次备份**：冗余设计和外部辅助监控结合，确保报警系统故障时不影响核心业务。
3. **自动化与人工结合**：在技术方案的基础上，辅以人员值守和流程管理。

通过以上策略，报警系统能够更高效地处理自身故障，保证整个监控体系的可靠性和稳定性。



# 参考资料

* any list
{:toc}