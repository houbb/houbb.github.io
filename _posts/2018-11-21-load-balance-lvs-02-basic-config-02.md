---
layout: post
title:  LVS-02-Basic Config
date: 2018-11-22 8:01:55 +0800
categories: [Web]
tags: [web-server, quisk-start, load-balance, network, sh]
published: true
---


# LVS 基本配置

图1.1“基本LVS配置”显示了由两层组成的简单LVS配置。 

在第一层是两个LVS路由器 - 一个活动路由器和一个备用路由器。 

每个LVS路由器都有两个网络接口，一个在Internet上，一个在专用网络上，使它们能够调节两个网络之间的流量。

 对于此示例，活动路由器使用网络地址转换或NAT将来自Internet的流量定向到第二层上的可变数量的真实服务器，这反过来提供必要的服务。 
 
 因此，此示例中的真实服务器连接到专用专用网段，并通过活动LVS路由器来回传递所有公共流量。 
 
 对于外部世界，服务器显示为一个实体。

![基本配置](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/4/html/Virtual_Server_Administration/images/lvs-two-tier.png)

到达LVS路由器的服务请求被发送到虚拟IP地址或VIP。这是一个可公开路由的地址，站点管理员与完全限定的域名（如www.example.com）关联，并分配给一个或多个虚拟服务器。虚拟服务器是配置为侦听特定虚拟IP的服务。有关使用Piranha Configuration Tool配置虚拟服务器的更多信息，请参见第4.6节“虚拟服务器”。在故障转移期间，VIP地址从一个LVS路由器迁移到另一个LVS路由器，从而保持在该IP地址处的存在（也称为浮动IP地址）。

VIP地址可以别名到将LVS路由器连接到Internet的同一设备。例如，如果eth0连接到Internet，则多个虚拟服务器可以别名为eth0：1。或者，每个虚拟服务器可以与每个服务的单独设备相关联。例如，可以在eth0：1上处理HTTP流量，并且可以在eth0：2上处理FTP流量。

一次只有一个LVS路由器处于活动状态。活动路由器的作用是将服务请求从虚拟IP地址重定向到真实服务器。重定向基于第1.3节“LVS调度概述”中进一步描述的八种支持的负载平衡算法之一。

活动路由器还通过简单的发送/期望脚本动态监视真实服务器上特定服务的整体运行状况。为了帮助检测需要动态数据的服务（例如HTTPS或SSL）的运行状况，管理员还可以调用外部可执行文件。如果真实服务器上的服务出现故障，则活动路由器会停止向该服务器发送作业，直到它恢复正常运行。

备份路由器执行备用系统的角色。 LVS路由器定期通过主外部公共接口交换心跳消息，并在故障转移情况下通过专用接口交换心跳消息。如果备份节点在预期的时间间隔内未能收到心跳消息，它将启动故障转移并承担活动路由器的角色。在故障转移期间，备份路由器使用称为ARP欺骗的技术接管由故障路由器服务的VIP地址 - 其中备用LVS路由器宣布自己为发往故障节点的IP数据包的目的地。当故障节点返回活动服务时，备份节点将再次承担其热备份角色。

图1.1中使用的简单的双层配置“基本LVS配置”最适合提供不经常变化的数据 - 例如静态网页 - 因为各个真实服务器不会在每个节点之间自动同步数据。

### 1.1.1。真实服务器之间的数据复制和数据共享

由于LVS中没有内置组件在真实服务器之间共享相同的数据，因此管理员有两个基本选项：
在真实服务器池中同步数据

将第三层添加到拓扑中以进行共享数据访问

对于不允许大量用户上传或更改真实服务器上的数据的服务器，首选选项。如果配置允许大量用户修改数据，例如电子商务网站，则最好添加第三层。

#### 1.1.1.1。配置Real Server以同步数据

管理员可以通过多种方式选择在真实服务器池中同步数据。

例如，可以使用shell脚本，以便在Web工程师更新页面时，页面将同时发布到所有服务器。此外，系统管理员可以使用rsync等程序以设定的间隔跨所有节点复制更改的数据。

但是，如果配置因用户不断上载文件或发出数据库事务而超载，则此类数据同步不会发挥最佳功能。

对于具有高负载的配置，三层拓扑是理想的解决方案。

# 参考资料

- key word

Linux Virtual Server

[入门教程](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/4/html/Virtual_Server_Administration/ch-lvs-overview-VSA.html)

* any list
{:toc}