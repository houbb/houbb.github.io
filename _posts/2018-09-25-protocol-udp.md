---
layout: post
title: UDP
date: 2018-09-25 16:42:47 +0800
categories: [Protocol]
tags: [tpc, ip, protocol, sh]
published: true
excerpt: UDP 协议入门介绍
---

# UDP

## 概念

用户数据报协议（英语：User Datagram Protocol，缩写为UDP），又称用户数据报文协议，是一个简单的面向数据报的传输层协议。

正式规范为 [RFC 768](https://tools.ietf.org/html/rfc768)。

在TCP/IP模型中，UDP为网络层以上和应用层以下提供了一个简单的接口。UDP只提供数据的不可靠传递，它一旦把应用程序发给网络层的数据发送出去，就不保留数据备份（所以UDP有时候也被认为是不可靠的数据报协议）。UDP在IP数据报的头部仅仅加入了复用和数据校验（字段）。

UDP首部字段由4个部分组成，其中两个是可选的。各16bit的来源端口和目的端口用来标记发送和接受的应用进程。因为UDP不需要应答，所以来源端口是可选的，如果来源端口不用，那么置为零。在目的端口后面是长度固定的以字节为单位的长度域，用来指定UDP数据报包括数据部分的长度，长度最小值为8byte。首部剩下地16bit是用来对首部和数据部分一起做校验和（Checksum）的，这部分是可选的，但在实际应用中一般都使用这一功能。

由于缺乏可靠性且属于非连接导向协议，UDP应用一般必须允许一定量的丢包、出错和复制粘贴。但有些应用，比如TFTP，如果需要则必须在应用层增加根本的可靠机制。但是绝大多数UDP应用都不需要可靠机制，甚至可能因为引入可靠机制而降低性能。流媒体（流技术）、即时多媒体游戏和IP电话（VoIP）一定就是典型的UDP应用。如果某个应用需要很高的可靠性，那么可以用传输控制协议（TCP协议）来代替UDP。

由于缺乏拥塞控制（congestion control），需要基于网络的机制来减少因失控和高速UDP流量负荷而导致的拥塞崩溃效应。换句话说，因为UDP发送者不能够检测拥塞，所以像使用包队列和丢弃技术的路由器这样的网络基本设备往往就成为降低UDP过大通信量的有效工具。数据报拥塞控制协议（DCCP）设计成通过在诸如流媒体类型的高速率UDP流中，增加主机拥塞控制，来减小这个潜在的问题。

典型网络上的众多使用UDP协议的关键应用一定程度上是相似的。这些应用包括域名系统（DNS）、简单网络管理协议（SNMP）、动态主机配置协议（DHCP）、路由信息协议（RIP）和某些影音流服务等等。

# UDP的分组结构

UDP报头包括4个字段，每个字段占用2个字节（即16个二进制位）。在IPv4中，“来源连接端口”和“校验和”是可选字段（以粉色背景标出）。在IPv6中，只有来源连接端口是可选字段。

## 报文长度

该字段指定UDP报头和数据总共占用的长度。可能的最小长度是8字节，因为UDP报头已经占用了8字节。

由于这个字段的存在，UDP报文总长不可能超过65535字节（包括8字节的报头，和65527字节的数据）。

实际上通过IPv4协议传输时，由于IPv4的头部信息要占用20字节，因此数据长度不可能超过65507字节（65,535 − 8字节UDP报头 − 20字节IP头部）。

在IPv6的jumbogram中，是有可能传输超过65535字节的UDP数据包的。依据RFC 2675，如果这种情况发生，报文长度应被填写为0。

## 校验和

校验和字段可以用于发现头部信息和数据中的传输错误。该字段在IPv4中是可选的，在IPv6中则是强制的。如果不使用校验和，该字段应被填充为全0。


# UDP 与 TCP 区别

## TCP与UDP基本区别

1. 基于连接与无连接

2. TCP要求系统资源较多，UDP较少； 

3. UDP程序结构较简单 

4. 流模式（TCP）与数据报模式(UDP); 

5. TCP保证数据正确性，UDP可能丢包 

6. TCP保证数据顺序，UDP不保证 

## 具体编程时的区别

1. socket()的参数不同 　　 

2. UDP Server不需要调用listen和accept 　　 

3. UDP收发数据用sendto/recvfrom函数 　　 

4. TCP：地址信息在connect/accept时确定 　　 

5. UDP：在sendto/recvfrom函数中每次均 需指定地址信息 　　 

6. UDP：shutdown函数无效 

# UDP应用场景

1. 面向数据报方式

2. 网络数据大多为短消息 

3. 拥有大量 Client

4. 对数据安全性无特殊要求

5. 网络负担非常重，但对响应速度要求高


# 参考资料

[用户数据报协议](https://zh.wikipedia.org/wiki/%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%8D%8F%E8%AE%AE)

https://blog.csdn.net/Li_Ning_/article/details/52117463

https://www.jianshu.com/p/43a25804b2e8

* any list
{:toc}