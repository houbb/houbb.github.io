---
layout: post
title: LTS
date: 2016-10-22 13:30:45 +0800
categories: [Tools]
tags: [light-task-scheduler]
published: true
---

* any list
{:toc}

# LTS

[LTS(light-task-scheduler)](https://github.com/ltsopensource/light-task-scheduler) 主要用于解决分布式任务调度问题，支持实时任务，定时任务和Cron任务



> 主要功能

1. 支持分布式，解决多点故障，支持动态扩容，容错重试等
2. Spring扩展支持，SpringBoot支持，Spring Quartz Cron任务的无缝接入支持
3. 节点监控支持，任务执行监控支持，JVM监控支持
4. 后台运维操作支持, 可以动态提交，更改，停止 任务

> 框架鸟瞰

LTS节点:

- JobClient：主要负责提交任务, 并接收任务执行反馈结果。
- JobTracker：负责接收并分配任务，任务调度。
- TaskTracker：负责执行任务，执行完反馈给JobTracker。
- LTS-Admin：（管理后台）主要负责节点管理，任务队列管理，监控管理等。

LTS支持任务类型：

- 实时任务：提交了之后立即就要执行的任务。
- 定时任务：在指定时间点执行的任务，譬如 今天3点执行（单次）。
- Cron任务：CronExpression，和quartz类似（但是不是使用quartz实现的）譬如 0 0/1 * * * ?

> 结构图

![lts]({{site.url}}/static/app/img/zookeeper/lts/2016-09-27-lts-struct.png)

# 概念说明

> 节点组

- 英文名称 NodeGroup,一个节点组等同于一个小的集群，同一个节点组中的各个节点是对等的，等效的，对外提供相同的服务。

- 每个节点组中都有一个master节点，这个master节点是由LTS动态选出来的，当一个master节点挂掉之后，LTS会立马选出另外一个master节点，
框架提供API监听接口给用户。

> FailStore

- 这个主要是用于失败了存储的，主要用于节点容错，当远程数据交互失败之后，存储在本地，等待远程通信恢复的时候，再将数据提交。
- FailStore主要用户JobClient的任务提交，TaskTracker的任务反馈，TaskTracker的业务日志传输的场景下。
- FailStore目前提供几种实现：leveldb,rocksdb,berkeleydb,mapdb,ltsdb，用于可以自由选择使用哪种,用户也可以采用SPI扩展使用自己的实现。

# Hello World

Try in ubuntu OS.

## download 

- download 

```
$   git clone https://github.com/ztajy/light-task-scheduler.git

root@iZuf60ahcky4k4nfv470juZ:~/code/light-task-scheduler# ls
build.cmd  build.sh  docs  lts  lts-admin  lts-core  lts-example  lts-jobclient  lts-jobtracker  lts-logger  lts-queue  lts-spring  lts-startup  lts-tasktracker  pom.xml  README.md
```

## JobTracker和LTS-Admin部署

1、运行根目录下的sh build.sh或build.cmd脚本，会在dist目录下生成lts-{version}-bin文件夹 

```
$   sh  build.sh

...
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 5.245 s
[INFO] Finished at: 2016-09-27T14:06:20+08:00
[INFO] Final Memory: 12M/30M
[INFO] ------------------------------------------------------------------------

root@iZuf60ahcky4k4nfv470juZ:~/code/light-task-scheduler/dist# pwd
/root/code/light-task-scheduler/dist
root@iZuf60ahcky4k4nfv470juZ:~/code/light-task-scheduler/dist# ls
lts-1.6.3-SNAPSHOT-bin
```



2、下面是其目录结构，其中bin目录主要是JobTracker和LTS-Admin的启动脚本。
jobtracker 中是 JobTracker的配置文件和需要使用到的jar包，lts-admin是LTS-Admin相关的war包和配置文件。 

> lts-{version}-bin的文件结构

```
├── bin
│   ├── jobtracker.cmd
│   ├── jobtracker.sh
│   ├── lts-admin.cmd
│   └── lts-admin.sh
├── jobtracker
│   ├── conf
│   │   └── zoo
│   │       ├── jobtracker.cfg
│   │       └── log4j.properties
│   └── lib
│       └── *.jar
├── lts-admin
│   ├── conf
│   │   ├── log4j.properties
│   │   └── lts-admin.cfg
│   ├── lib
│   │   └── *.jar
│   └── lts-admin.war
└── tasktracker
    ├── bin
    │   └── tasktracker.sh
    ├── conf
    │   ├── log4j.properties
    │   └── tasktracker.cfg
    └── lib
        └── *.jar
```

3、JobTracker启动。如果你想启动一个节点，直接修改下conf/zoo下的配置文件，然后运行 sh jobtracker.sh zoo start即可，
如果你想启动两个JobTracker节点，那么你需要拷贝一份zoo,譬如命名为zoo2,修改下zoo2下的配置文件，
然后运行sh jobtracker.sh zoo2 start即可。logs文件夹下生成jobtracker-zoo.out日志。

4、LTS-Admin启动.修改lts-admin/conf下的配置，然后运行bin下的sh lts-admin.sh或lts-admin.cmd脚本即可。
logs文件夹下会生成lts-admin.out日志，启动成功在日志中会打印出访问地址，用户可以通过这个访问地址访问了。





