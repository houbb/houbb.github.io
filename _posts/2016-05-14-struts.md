---
layout: post
title: struts2
date:  2016-5-14 11:58:26 +0800
categories: [apache]
tags: [struts]
---

* any list
{:toc}

## struts2

Apache Struts is a free, open-source, MVC framework for creating elegant, modern Java web applications.

> [struts](http://struts.apache.org/)

## hello world

My example is on the base of [maven](http://maven.apache.org/) and the [doc](http://struts.apache.org/docs/home.html) of struts2.
A recommended way to start with Struts2 archetypes is to work with the archetype catalog.

```
mvn archetype:generate -DarchetypeCatalog=http://struts.apache.org/
```

The Struts 2 Blank Archetype ("blank-archetype") provides a minimal, but complete, Struts 2 application.
It demonstrates some of the most basic Struts 2 concepts. It's my style, I choose this.

use

```
mvn clean install
```

to remove previous files and add jars into your repository.

use

```
mvn tomcat7:run
```

to start your project. Or put the war on the tomcat.

<label class="label label-danger">Error</label>

You may meet error like this.

```
 no plugin found for prefix 'tomcat 7' in the current project and in the plugin groups
```

<label class="label label-success">Tips</label>

Don't worry, here is the way to solve it. Open **pom.xml**, add code into **plugins** as following.

```
<plugin>
    <groupId>org.apache.tomcat.maven</groupId>
    <artifactId>tomcat7-maven-plugin</artifactId>
    <version>${plugin.tomcat.version}</version>
    <configuration>
        <port>8080</port>
        <path>/</path>
        <uriEncoding>${project.build.sourceEncoding}</uriEncoding>
    </configuration>
</plugin>
```

and add this into **properties**.

```
<plugin.tomcat.version>2.2</plugin.tomcat.version>
```

Okay, enjoy struts2 travel.

![struts2-architecture]({{ site.url }}/static/app/img/2016-05-15-struts-architecture.png)

## Configuration Files

> web.xml

In the web.xml file, Struts defines its FilterDispatcher, the Servlet Filter class that initializes the Struts framework
and handles all requests. As following...

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app id="struts_blank" version="2.4"
         xmlns="http://java.sun.com/xml/ns/j2ee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd">

  <filter>
    <filter-name>struts2</filter-name>
    <filter-class>
      org.apache.struts2.dispatcher.filter.StrutsPrepareAndExecuteFilter
    </filter-class>
  </filter>
  <filter-mapping>
    <filter-name>struts2</filter-name>
    <url-pattern>/*</url-pattern>
  </filter-mapping>

</web-app>
```

In the example above we've mapped the Struts 2 dispatcher to /*, so Struts 2 has a crack at all incoming requests.
This is because Struts 2 serves static content from its jar files, including Dojo JavaScript files (if using S2.0,
or the Dojo plugin in S2.1+) and FreeMarker templates for the Struts 2 tags that produce HTML.

Since Struts 2.1.7, you are able to provide a comma seperated list of patterns for which when matching against the
request URL the Filter will just pass by. This is done via the configuration option struts.action.excludePattern, for example in your struts.xml

```xml
<struts>
    <constant name="struts.action.excludePattern" value=".*unfiltered.*,.*\\.nofilter"/>
    ...
</struts>
````

You may ask, what is struts.xml?

> struts.xml

The core configuration file for the framework is the default (struts.xml) file and should reside on the classpath of
the webapp **(generally /WEB-INF/classes)**.

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE struts PUBLIC
        "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"
        "http://struts.apache.org/dtds/struts-2.3.dtd">
<struts>
</struts>
```

<label class="label label-info">dtd</label>

A DTD is a Document Type Definition, defines the structure and the legal elements and attributes of an XML document.

> [dtd](http://www.w3schools.com/xml/xml_dtd_intro.asp)

<label class="label label-info">include</label>

Can we break up a large struts.xml file into smaller pieces?

- You can use
```<include>```
elements in your struts.xml interchangeably with <package> elements. The configuration objects
will be loaded in the order of appearance. The framework reads the configuration from top to bottom and adds objects as they are referenced.

```xml
<struts>
    <include file="example.xml"/>
    ...
</struts>
```
<label class="label label-info">Constant</label>

You may find these int the struts.xml, it's constants.

```xml
<constant name="struts.enable.DynamicMethodInvocation" value="false"/>
<constant name="struts.devMode" value="true"/>
```
Constants provide a simple way to customize a Struts application by defining key settings that modify framework and plugin behavior.

<label class="label label-info">Packages</label>

```xml
<package name="default" namespace="/" extends="struts-default">

    <default-action-ref name="index"/>

    <action name="index">
        <result>/index.html</result>
    </action>

</package>
```

- The package element has one required attribute, **name**, which acts as the key for later reference to the package.

- The **namespace** attribute subdivides action configurations into logical modules, each with its own identifying prefix. Namespaces avoid conflicts between action names.

- The **extends** attribute is optional and allows one package to inherit the configuration of one or more previous packages.

- The **action** mapping can specify a set of result types, a set of exception handlers, and an interceptor stack.

> struts.properties

All properties can also be set using **Constant Configuration** in an XML configuration file.

The list of properties can be found in struts-default.properties (inside struts2.jar).

```
### Struts default properties
###(can be overridden by a struts.properties file in the root of the classpath)
###
### This can be used to set your default locale and encoding scheme
# struts.locale=en_US
struts.i18n.encoding=UTF-8
 
### Used by the DefaultActionMapper
### You may provide a comma separated list, e.g. struts.action.extension=action,jnlp,do
### The blank extension allows you to match directory listings as well as pure action names
### without interfering with static resources, which can be specified as an empty string
### prior to a comma e.g. struts.action.extension=, or struts.action.extension=x,y,z,,
struts.action.extension=action,,
 
### Set this to false if you wish to disable implicit dynamic method invocation
### via the URL request. This includes URLs like foo!bar.action, as well as params
### like method:bar (but not action:foo).
### An alternative to implicit dynamic method invocation is to use wildcard
### mappings, such as <action name="*/*" method="{2}" class="actions.{1}">
struts.enable.DynamicMethodInvocation = false
 
### when set to true, Struts will act much more friendly for developers. This
### includes:
### - struts.i18n.reload = true
### - struts.configuration.xml.reload = true
### - raising various debug or ignorable problems to errors
###   For example: normally a request to foo.action?someUnknownField=true should
###                be ignored (given that any value can come from the web and it
###                should not be trusted). However, during development, it may be
###                useful to know when these errors are happening and be told of
###                them right away.
struts.devMode = false
```


## Wildcards

As an application grows in size, so will the number of action mappings. Wildcards can be used to **combine similar mappings into one more generic mapping**.

The best way to explain wildcards is to show an example and walk through how it works.

- action in struts.xml

```xml
<action name="*_*" class="struts2.example.{1}" method="{2}">
    <result>
        /WEB-INF/example/{1}_{2}.jsp
    </result>
</action>
```

- HelloWorld.java

```java
public class HelloWorld extends ActionSupport {

    public String add() {
        return SUCCESS;
    }

    public String update() {
        return SUCCESS;
    }
}

```

- url

```
http://localhost:8080/HelloWorld_add
```

matches the class struts2.example.HelloWorld, method add. result is /WEB-INF/example/HellWorld_add.jsp

- url

```
http://localhost:8080/HelloWorld_update
```

matches the class struts2.example.HelloWorld, method update. result is /WEB-INF/example/HellWorld_update.jsp

## Action Default

Usually, if an action is requested, and the framework can't map the request to an action name, the result will be the usual "404 - Page not found" error.
But, if you would prefer that an omnibus action handle any unmatched requests, you can specify a default action.

- default action define in struts.xml

```xml
<package name="default" namespace="/" extends="struts-default">
    <default-action-ref name="index"></default-action-ref>

    <action name="index">
        <result>
            /index.html
        </result>
    </action>

</package>
```

- url

```
http://localhost:8080/xxx/yyy/zzz
```

If no other action matches, the default action is used instead.

## Accept arguments

the login.jsp

```xml
<body>
<s:form action="Login">
    <s:textfield key="username"/>
    <s:password key="password" />
    <s:submit/>
</s:form>
</body>
```

1. Use the properties.

```java
public class Login extends ActionSupport {

    public String execute() throws Exception {
        System.out.printf(getUsername());
        return SUCCESS;
    }

    private String username;

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }
}
```

2.









