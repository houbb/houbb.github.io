---
layout: post
title: Apache Doris-01-overview Doris 介绍
date: 2024-01-10 21:01:55 +0800
categories: [Database]
tags: [database, sql, apache, calcite, sh]
published: true
---


# Doris 介绍

Apache Doris 是一个基于 MPP 架构的高性能、实时的分析型数据库，以极速易用的特点被人们所熟知，仅需亚秒级响应时间即可返回海量数据下的查询结果，不仅可以支持高并发的点查询场景，也能支持高吞吐的复杂分析场景。基于此，Apache Doris 能够较好的满足报表分析、即席查询、统一数仓构建、数据湖联邦查询加速等使用场景，用户可以在此之上构建用户行为分析、AB 实验平台、日志检索分析、用户画像分析、订单分析等应用。

Apache Doris 最早是诞生于百度广告报表业务的 Palo 项目，2017 年正式对外开源，2018 年 7 月由百度捐赠给 Apache 基金会进行孵化，之后在 Apache 导师的指导下由孵化器项目管理委员会成员进行孵化和运营。目前 Apache Doris 社区已经聚集了来自不同行业数百家企业的 400 余位贡献者，并且每月活跃贡献者人数也超过 100 位。 2022 年 6 月，Apache Doris 成功从 Apache 孵化器毕业，正式成为 Apache 顶级项目（Top-Level Project，TLP）

Apache Doris 如今在中国乃至全球范围内都拥有着广泛的用户群体，截止目前， Apache Doris 已经在全球超过 2000 家企业的生产环境中得到应用，在中国市值或估值排行前 50 的互联网公司中，有超过 80% 长期使用 Apache Doris，包括百度、美团、小米、京东、字节跳动、腾讯、网易、快手、微博、贝壳等。同时在一些传统行业如金融、能源、制造、电信等领域也有着丰富的应用。

# 使用场景

如下图所示，数据源经过各种数据集成和加工处理后，通常会入库到实时数仓 Doris 和离线湖仓（Hive, Iceberg, Hudi 中），Apache Doris 被广泛应用在以下场景中。

![使用场景](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/sekvbs5ih5rb16wz6n9k.png)

1) 报表分析

实时看板 （Dashboards）
面向企业内部分析师和管理者的报表
面向用户或者客户的高并发报表分析（Customer Facing Analytics）。比如面向网站主的站点分析、面向广告主的广告报表，并发通常要求成千上万的 QPS ，查询延时要求毫秒级响应。著名的电商公司京东在广告报表中使用 Apache Doris ，每天写入 100 亿行数据，查询并发 QPS 上万，99 分位的查询延时 150ms。

2) 即席查询（Ad-hoc Query）：面向分析师的自助分析，查询模式不固定，要求较高的吞吐。小米公司基于 Doris 构建了增长分析平台（Growing Analytics，GA），利用用户行为数据对业务进行增长分析，平均查询延时 10s，95 分位的查询延时 30s 以内，每天的 SQL 查询量为数万条。

3) 统一数仓构建 ：一个平台满足统一的数据仓库建设需求，简化繁琐的大数据软件栈。海底捞基于 Doris 构建的统一数仓，替换了原来由 Spark、Hive、Kudu、Hbase、Phoenix 组成的旧架构，架构大大简化。

4) 数据湖联邦查询：通过外表的方式联邦分析位于 Hive、Iceberg、Hudi 中的数据，在避免数据拷贝的前提下，查询性能大幅提升。

# 技术概述

Doris整体架构如下图所示，Doris 架构非常简单，只有两类进程

Frontend（FE），主要负责用户请求的接入、查询解析规划、元数据的管理、节点管理相关工作。

Backend（BE），主要负责数据存储、查询计划的执行。

这两类进程都是可以横向扩展的，单集群可以支持到数百台机器，数十 PB 的存储容量。并且这两类进程通过一致性协议来保证服务的高可用和数据的高可靠。这种高度集成的架构设计极大的降低了一款分布式系统的运维成本。

![技术概述](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/mnz20ae3s23vv3e9ltmi.png)

在使用接口方面，Doris 采用 MySQL 协议，高度兼容 MySQL 语法，支持标准 SQL，用户可以通过各类客户端工具来访问 Doris，并支持与 BI 工具的无缝对接。Doris 当前支持多种主流的 BI 产品，包括不限于 SmartBI、DataEase、FineBI、Tableau、Power BI、SuperSet 等，只要支持 MySQL 协议的 BI 工具，Doris 就可以作为数据源提供查询支持。

在存储引擎方面，Doris 采用列式存储，按列进行数据的编码压缩和读取，能够实现极高的压缩比，同时减少大量非相关数据的扫描，从而更加有效利用 IO 和 CPU 资源。

Doris 也支持比较丰富的索引结构，来减少数据的扫描：

Sorted Compound Key Index，可以最多指定三个列组成复合排序键，通过该索引，能够有效进行数据裁剪，从而能够更好支持高并发的报表场景

Min/Max ：有效过滤数值类型的等值和范围查询

Bloom Filter ：对高基数列的等值过滤裁剪非常有效

Invert Index ：能够对任意字段实现快速检索

在存储模型方面，Doris 支持多种存储模型，针对不同的场景做了针对性的优化：

Aggregate Key 模型：相同 Key 的 Value 列合并，通过提前聚合大幅提升性能

Unique Key 模型：Key 唯一，相同 Key 的数据覆盖，实现行级别数据更新

Duplicate Key 模型：明细数据模型，满足事实表的明细存储

Doris 也支持强一致的物化视图，物化视图的更新和选择都在系统内自动进行，不需要用户手动选择，从而大幅减少了物化视图维护的代价。

在查询引擎方面，Doris 采用 MPP 的模型，节点间和节点内都并行执行，也支持多个大表的分布式 Shuffle Join，从而能够更好应对复杂查询。

![查询引擎](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/vjlmumwyx728uymsgcw0.png)

Doris 查询引擎是向量化的查询引擎，所有的内存结构能够按照列式布局，能够达到大幅减少虚函数调用、提升 Cache 命中率，高效利用 SIMD 指令的效果。

在宽表聚合场景下性能是非向量化引擎的 5-10 倍。

![引擎](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ck2m3kbnodn28t28vphp.png)

Doris 采用了 Adaptive Query Execution 技术， 可以根据 Runtime Statistics 来动态调整执行计划，比如通过 Runtime Filter 技术能够在运行时生成 Filter 推到 Probe 侧，并且能够将 Filter 自动穿透到 Probe 侧最底层的 Scan 节点，从而大幅减少 Probe 的数据量，加速 Join 性能。Doris 的 Runtime Filter 支持 In/Min/Max/Bloom Filter。

在优化器方面 Doris 使用 CBO 和 RBO 结合的优化策略，RBO 支持常量折叠、子查询改写、谓词下推等，CBO 支持 Join Reorder。

目前 CBO 还在持续优化中，主要集中在更加精准的统计信息收集和推导，更加精准的代价模型预估等方面。

# TODO

实际安装部署体验

# chat

## 详细介绍下 apache Doris

截至我知识截止日期（2022年1月），Apache Doris（以前称为Palo）是一个开源的分布式OLAP（在线分析处理）数据库系统，旨在支持快速、实时的大规模数据分析。

下面是对Apache Doris的一些详细介绍：

1. **分布式架构：** Apache Doris采用分布式架构，可以在多个节点上运行，以实现水平扩展。这有助于处理大规模数据集，并允许系统灵活地适应不断增长的数据量。

2. **OLAP数据库：** Doris是专为OLAP工作负载设计的数据库系统。它优化了对大规模数据集进行复杂查询和聚合操作的性能。OLAP系统通常用于支持数据仓库和实时分析。

3. **实时数据更新：** Doris支持实时数据更新，这意味着可以在运行查询的同时进行数据写入。这使得系统能够提供近实时的分析和报告，对于需要快速响应数据变化的场景非常有用。

4. **列式存储引擎：** Doris采用列式存储引擎，这种存储方式有助于提高查询性能，尤其是在聚合查询和复杂分析操作方面。

5. **支持多维数据模型：** Doris支持多维数据模型，可以轻松处理包含多个维度和度量的数据集。这使得用户能够通过不同的维度对数据进行切片和分析。

6. **易于使用的查询语言：** Doris提供了一个SQL-like的查询语言，使得用户可以使用熟悉的语法进行数据查询和分析。这使得使用Doris的开发人员和分析师能够更轻松地操作和提取有价值的信息。

7. **开源：** Apache Doris是一个开源项目，这意味着任何人都可以查看、使用和修改其源代码。它是Apache软件基金会的项目，因此遵循Apache许可证。

8. **生态系统整合：** Doris可以与其他大数据生态系统工具和框架集成，如Apache Hadoop、Apache Hive等，从而提供更全面的数据处理和分析解决方案。

请注意，随着时间的推移，可能会有新的版本和功能的发布，因此建议查阅最新的官方文档以获取更详细和最新的信息。

## apache Doris 主要的应用场景有哪些？为什么需要

Apache Doris的主要应用场景涵盖了各个需要进行实时大规模数据分析的领域。

以下是一些主要的应用场景：

1. **实时大数据分析：** Doris专为实时大数据分析而设计，能够高效地处理大规模数据集。这使得它非常适用于需要在数据不断生成的情况下进行实时分析和报告的场景，如电商实时数据分析、在线广告实时投放等。

2. **数据仓库：** Doris可作为数据仓库系统使用，支持多维数据模型，使用户能够以更高效的方式进行数据切片和分析。数据仓库通常用于存储和分析企业中的历史和实时数据，以支持决策制定和业务智能。

3. **业务智能和报表：** 由于Doris能够提供实时数据更新和快速查询的能力，它是业务智能和报表系统的理想选择。企业可以使用Doris来生成实时的业务报告和分析，以及支持决策过程。

4. **在线分析处理（OLAP）：** Doris是一种专为OLAP工作负载设计的数据库系统，支持复杂的在线分析和聚合操作。OLAP用于多维数据分析，使用户能够在不同的维度上对数据进行切片和钻取，以获取更深入的见解。

5. **日志分析：** 由于Doris支持实时数据更新和快速的查询性能，它也适用于日志分析场景。这包括服务器日志、应用程序日志等数据源，帮助企业了解其系统和应用程序的运行状况。

6. **金融分析：** 金融行业对实时数据分析的需求非常高，以支持交易监控、风险管理和实时报告。Doris的实时性和大规模数据处理能力使其成为金融分析的有力工具。

总的来说，Apache Doris适用于需要处理大规模实时数据并进行高效分析的各种场景。

它的优势在于支持实时数据更新、快速查询和多维分析，为用户提供了灵活而强大的分析工具。

## 类似 apache Doris 的开源数据库还有哪些？

在实时大数据分析和OLAP领域，有一些类似Apache Doris的开源数据库和数据仓库项目。以下是一些可能与Doris具有相似用途或特性的开源项目：

1. **Apache Kylin：** 一个开源的分布式分析引擎，专注于大数据OLAP。Kylin主要用于支持超大规模的数据集上的多维分析，具有高度可扩展性。

2. **Apache Impala：** 一个高性能、低延迟的分布式SQL查询引擎，专为在Hadoop生态系统中进行交互式分析而设计。Impala支持实时查询，适用于需要快速分析大规模数据的场景。

3. **PrestoDB：** 一个分布式SQL查询引擎，可以在大规模数据集上执行交互式分析。PrestoDB支持连接多种数据源，包括Hive、MySQL、PostgreSQL等。

4. **Druid：** 一个开源实时分析数据库，专注于快速查询和实时数据分析。Druid适用于处理大规模的事件数据，例如日志和实时事件流。

5. **ClickHouse：** 一个用于OLAP查询的列式数据库管理系统。ClickHouse以高性能而著称，支持快速的数据插入和查询，适用于大规模数据分析。

6. **Pinot：** 由LinkedIn开发的实时分析数据库，用于支持大规模数据集上的实时查询和分析。Pinot主要用于处理实时事件流数据。

请注意，这些项目可能在不同的方面具有优势或特点，具体选择取决于项目的具体需求和使用情境。

在选择数据库时，还需要考虑性能、可扩展性、易用性以及与其他系统的集成等因素。建议查看每个项目的文档和社区支持以获取详细信息。

## 详细对比一下这些数据库

以下是对一些开源数据库（Apache Doris、Apache Kylin、Apache Impala、PrestoDB、Druid、ClickHouse、Pinot）的简要对比。

请注意，数据库的选择应该根据具体的使用场景、性能需求和系统要求而定。

1. **Apache Doris:**
   - **定位：** 分布式OLAP数据库，适用于实时大数据分析。
   - **特点：** 实时数据更新、多维数据模型、支持复杂OLAP查询、列式存储引擎。
   - **适用场景：** 实时大数据分析、数据仓库、业务智能和报表。

2. **Apache Kylin:**
   - **定位：** 分布式OLAP引擎，专注于多维分析。
   - **特点：** Cube技术、预计算、适用于超大规模数据集。
   - **适用场景：** 针对需要超大规模数据集上的多维分析，如数据仓库。

3. **Apache Impala:**
   - **定位：** 分布式SQL查询引擎，适用于交互式分析。
   - **特点：** 实时查询、Hadoop生态系统集成、支持多数据源。
   - **适用场景：** 实时查询、交互式分析、Hadoop环境中的SQL查询。

4. **PrestoDB:**
   - **定位：** 分布式SQL查询引擎，支持多数据源。
   - **特点：** 高性能、可扩展、用于交互式分析。
   - **适用场景：** 多数据源查询、交互式分析。

5. **Druid:**
   - **定位：** 实时分析数据库，适用于大规模事件数据。
   - **特点：** 实时查询、列式存储、适用于事件流数据。
   - **适用场景：** 实时事件流数据分析、日志分析。

6. **ClickHouse:**
   - **定位：** 列式数据库管理系统，用于OLAP查询。
   - **特点：** 高性能、快速数据插入、适用于大规模数据分析。
   - **适用场景：** OLAP查询、大规模数据分析。

7. **Pinot:**
   - **定位：** 实时分析数据库，适用于大规模实时事件流数据。
   - **特点：** 实时查询、水平可扩展、用于实时事件流数据。
   - **适用场景：** 实时事件流数据分析。

在选择数据库时，需要根据具体需求考虑性能、可扩展性、支持的查询类型、数据一致性、易用性以及与其他系统的集成等因素。

此外，不同数据库的社区支持、文档质量以及维护活跃度也是重要的考虑因素。

## 详细介绍一下 doris 的核心组件

Apache Doris（以前称为Palo）的核心组件包括存储引擎、查询引擎、元数据存储和前端接口。

以下是这些核心组件的详细介绍：

1. **存储引擎（Storage Engine）：**
   - Doris的存储引擎负责实际数据的存储和管理。它采用了列式存储结构，将数据按列进行存储，这有助于提高查询性能，特别是在OLAP场景下。
   - 存储引擎支持实时数据更新，允许在查询执行的同时进行数据写入，从而满足实时分析的需求。
   - Doris的存储引擎是分布式的，可以水平扩展，通过添加更多的节点来处理大规模的数据集。

2. **查询引擎（Query Engine）：**
   - 查询引擎是Doris的核心执行引擎，负责解析和执行用户提交的查询请求。它支持复杂的OLAP查询，包括聚合、分组、过滤等操作。
   - 查询引擎通过与存储引擎的交互，有效地利用列式存储的优势，以提高查询性能。它还支持并行查询处理，使得在大规模数据集上执行复杂查询变得更加高效。

3. **元数据存储（Metadata Store）：**
   - 元数据存储负责存储Doris集群的元数据信息，包括表的结构、分区信息、副本分布、索引等。元数据存储对于Doris的正常运行非常关键，因为它提供了系统中所有表的信息，支持查询优化和元数据的事务性管理。
   - Doris的元数据存储是高可用和分布式的，以确保元数据的可靠性和系统的稳定性。

4. **前端接口（Frontend Interface）：**
   - 前端接口是Doris与用户和应用程序交互的入口，通常支持SQL查询语言。用户可以通过前端接口提交查询、更新和管理元数据。
   - Doris的前端接口可以通过多种方式进行访问，包括命令行工具、Web界面以及支持ODBC和JDBC的客户端工具。这使得用户可以选择最适合他们需求的方式来使用Doris。

5. **Feeder：**
   - Feeder是Doris的数据导入组件，负责将外部数据源的数据导入到Doris中。Feeder支持多种数据源，包括HDFS、Kafka、MySQL等，可以实现实时和离线数据加载。

这些核心组件协同工作，使得Doris能够处理大规模数据集上的实时OLAP分析，同时提供了灵活性和可扩展性，以适应不同的应用场景。

整个架构的设计使得Doris在大数据分析和实时数据处理方面具有优越的性能。

## 详细介绍一下 doris 的核心原理

Apache Doris的核心原理主要涉及存储引擎、查询引擎以及元数据管理，以下是对这些核心原理的详细介绍：

1. **存储引擎的核心原理：**
   - **列式存储结构：** Doris采用列式存储结构，将每一列的数据存储在一起，而不是按照行式存储。这样的存储结构有助于提高压缩比、减少I/O操作、提高查询性能，特别适用于OLAP场景，其中通常需要对大量列进行复杂的分析。
   - **副本和分片：** Doris的存储引擎将数据分为多个分片，并在多个节点上存储副本，以实现数据的高可用性和容错性。每个分片都是一个独立的存储单元，可以在集群中的不同节点上进行分布式存储。

2. **查询引擎的核心原理：**
   - **并行查询处理：** Doris的查询引擎支持并行查询处理，可以同时在多个节点上执行查询操作，从而提高查询性能。并行查询充分利用了分布式存储引擎和集群计算的优势。
   - **列存储的优化：** 查询引擎通过与存储引擎的紧密协作，有效利用列存储的优势，例如只读取必要的列、跳过不相关的数据等，从而减少IO操作和提高查询速度。
   - **计算下推：** Doris支持在存储引擎中进行部分计算（例如过滤条件）的优化，以减少数据的传输和减轻查询引擎的负担。

3. **元数据管理的核心原理：**
   - **分布式元数据存储：** Doris的元数据存储是分布式的，以确保元数据的可用性和容错性。这意味着每个节点都能够访问所有表的元数据信息，支持查询优化和元数据的事务性管理。
   - **元数据缓存：** Doris通过元数据缓存来减少对元数据存储的频繁访问，提高查询性能。元数据缓存包含了表的结构、分区信息、副本分布、索引等关键信息。

4. **Feeder的核心原理：**
   - **实时和离线数据加载：** Doris的Feeder组件支持实时和离线的数据加载。对于实时数据加载，Doris可以通过监听数据源的变化，实时将数据导入到Doris中。对于离线数据加载，Feeder支持从离线存储（如HDFS）导入数据。

5. **分布式事务管理：**
   - Doris支持分布式事务管理，确保在多节点的环境下保持数据的一致性和可靠性。

这些核心原理共同构成了Doris的分布式、高性能、实时大数据分析的基础。

通过这些原理的实现，Doris能够适应各种复杂的分析场景，提供强大的OLAP能力。

## 详细介绍一下 doris 的最佳实践

Doris的最佳实践涵盖了集群规划、数据建模、查询优化、性能调优等多个方面。

以下是一些Doris的最佳实践：

1. **集群规划与部署：**
   - **硬件规划：** 根据数据量和查询负载合理规划硬件资源。考虑节点间的通信性能、存储性能以及网络带宽等因素。
   - **节点部署：** 尽量在可靠性较高的物理机器或虚拟机上部署Doris节点。确保良好的网络连接，减少节点之间的通信延迟。

2. **数据建模与表设计：**
   - **选择合适的数据类型：** 选择最适合数据特性的数据类型，减小数据存储和查询的开销。
   - **分区设计：** 合理设计分区，以支持更高效的数据加载和查询。根据查询模式选择范围分区或哈希分区。
   - **合理选择索引：** 根据查询需求选择合适的索引，以提高查询性能。避免在大表上创建过多的索引，以避免过多的维护开销。

3. **数据加载与实时同步：**
   - **实时同步：** 对于需要实时数据的场景，使用Doris的Feeder组件实现数据的实时同步。考虑数据源的变化，及时将变更引入Doris中。
   - **合理调整导入参数：** 在使用Feeder进行数据导入时，调整导入参数，例如并发度、批次大小等，以获得最佳导入性能。

4. **查询优化：**
   - **分区裁剪：** 利用分区裁剪，仅查询涉及的分区，减小扫描范围，提高查询性能。
   - **适当使用索引：** 根据查询的具体情况，合理使用索引。在复杂查询场景下，确保索引的维护开销不会超过查询性能的提升。

5. **性能调优：**
   - **调整查询并发度：** 根据集群规模和硬件资源，调整查询引擎的并发度参数，以充分利用集群资源。
   - **监控与调整配置：** 使用Doris的监控系统，监控集群的运行状况，根据实际情况调整配置参数，以优化性能。

6. **安全性与权限管理：**
   - **启用安全认证：** 在生产环境中，建议启用Doris的安全认证机制，以确保集群的安全性。
   - **合理设置权限：** 根据用户角色和需求，合理设置权限，确保用户只能访问其有权限的数据和操作。

7. **版本管理与升级：**
   - **定期升级：** 关注Doris的最新版本，定期升级以获取新功能、性能改进和安全更新。

以上建议可以根据具体场景和需求进行调整，Doris提供了丰富的文档和社区支持，建议查阅最新的官方文档以获取更详细和最新的信息。


## 详细介绍一下 doris 的分布式架构？如何保障高可用的？

Doris的分布式架构是为了提供高性能和高可用性而设计的。

以下是Doris的主要分布式架构组件以及保障高可用性的机制：

### 1. 分布式存储引擎：

Doris的数据存储采用分布式存储引擎，数据被分为多个分片，每个分片都有多个副本。这种设计确保了数据的高可用性和容错性。每个节点上存储了数据的一个或多个分片的一个副本，当某个节点发生故障时，其他节点上的副本可以继续提供服务。

### 2. 元数据存储：

Doris的元数据存储是分布式的，包含了所有表的结构、分区信息、副本分布等元数据。元数据存储的分布式设计保证了元数据的高可用性。元数据存储使用了Raft协议来保证分布式事务的一致性，确保元数据的准确和稳定。

### 3. 负载均衡与节点管理：

Doris的Master节点负责集群中的元数据管理、负载均衡和节点管理。Master节点会监控各个节点的状态，并根据负载情况进行动态调整。这确保了集群中各个节点的资源得到充分利用，同时避免了节点的过载或资源浪费。

### 4. 查询引擎：

Doris的查询引擎是分布式的，支持并行查询。查询任务可以在集群中的多个节点上并行执行，从而提高查询性能。同时，Doris的查询引擎能够智能地优化查询计划，以适应不同查询的特点，提高查询效率。

### 5. 分布式事务管理：

Doris使用分布式事务管理来保证数据的一致性和可靠性。元数据存储和存储引擎的交互使用了Raft协议，确保在分布式环境下的事务操作具有原子性和一致性。

### 6. 高可用性机制：

为了确保高可用性，Doris实现了以下机制：

- **故障检测与自动恢复：** Doris的Master节点会监控各个节点的状态，一旦检测到某个节点不可用，会触发自动的故障转移和数据迁移，确保系统持续可用。

- **节点复制与副本管理：** 数据存储引擎会在多个节点上存储相同的数据副本，确保在某个节点不可用时，可以从其他节点获取相同的数据。

- **分片和分区的策略：** 数据的分片和分区设计有助于将负载分散到多个节点上，防止某个节点的过载，提高系统整体的可用性。

- **集群监控与报警：** Doris提供了集群监控和报警功能，管理员可以监测集群的健康状况，并及时采取措施来应对潜在的问题。

- **数据恢复与一致性：** 在发生节点故障时，Doris能够自动进行数据的迁移和复制，保障数据的一致性。

综合来看，Doris的分布式架构通过节点复制、负载均衡、故障检测与自动恢复等机制，为系统提供了高可用性和容错性，确保了在大规模数据分析场景下的稳定运行。

## 详细介绍一下 doris 的深入学习资料，包含网址

截至我的知识截止日期（2022年1月），以下是Doris深入学习的一些资源。

请注意，由于技术生态的不断演进，建议查阅最新的官方文档和社区资源以获取最新的信息。

1. **官方文档：**
   - [Doris 官方文档](https://doris.apache.org/)：Doris的官方文档包含了全面的技术细节、配置说明和使用指南。可以从官方网站获取最新的文档。

2. **GitHub 仓库：**
   - [Doris GitHub 仓库](https://github.com/apache/doris)：Doris的官方GitHub仓库包含源代码、问题跟踪和贡献者信息。你可以在这里找到最新的代码和版本信息。

3. **邮件列表和社区讨论：**
   - [Doris 邮件列表](https://lists.apache.org/list.html?dev@doris.apache.org)：通过邮件列表可以参与Doris社区的讨论，了解最新的技术问题、解决方案和发展方向。

4. **博客和文章：**
   - [Doris 博客](https://doris.apache.org/blog/)：Doris官方博客可能包含一些深入的技术文章、用例分析和最佳实践。检查博客页面以获取更多信息。

5. **技术会议和研讨会：**
   - 查看Doris开发者或社区组织的技术会议、研讨会和在线活动。这些活动通常提供深入的技术洞察、案例研究和最佳实践分享。

6. **相关书籍和学术论文：**
   - 检查学术数据库和在线图书商，以查找关于分布式数据库、OLAP系统以及大数据技术的书籍和学术论文。

7. **在线社区平台：**
   - 在社交媒体、技术论坛或知识分享平台上搜索Doris相关的讨论。这包括但不限于Stack Overflow、Reddit、CSDN等。

请注意，Doris是一个开源项目，其生态系统和学习资源可能会随时间而变化。因此，建议查看最新的官方资源和社区讨论以获取最准确的信息。

# 如果让你深入学习 doris，你会问哪10个问题？为什么

深入学习Doris时，你可能会关注以下10个问题，这些问题涵盖了Doris的架构、性能、使用场景和最佳实践等方面：

## 1. **Doris的核心架构是什么样的？**

   - **为什么重要：** 了解Doris的架构可以帮助你理解系统是如何处理数据、执行查询和维护元数据的。

Doris的核心架构是一个分布式、列式存储的OLAP数据库系统。

以下是Doris核心架构的主要组成部分：

1. **Master节点：**
   - Doris集群中通常有一个Master节点，负责元数据的管理、负载均衡、节点管理和整个集群的协调。Master节点通过与存储节点和查询节点的协作，确保数据的一致性和系统的稳定运行。

2. **存储引擎（Storage Engine）：**
   - Doris的存储引擎是分布式的，负责实际数据的存储和管理。数据被划分为多个分片，每个分片有多个副本存储在不同的节点上，以提高数据的可用性和容错性。存储引擎支持实时数据更新，允许在查询执行的同时进行数据写入。

3. **查询引擎（Query Engine）：**
   - Doris的查询引擎负责解析和执行用户提交的查询请求。查询引擎支持并行查询处理，可以同时在多个节点上执行查询操作，从而提高查询性能。它与存储引擎协同工作，有效地利用列式存储结构的优势，以快速响应复杂的OLAP查询。

4. **元数据存储（Metadata Store）：**
   - 元数据存储是Doris的元数据管理组件，存储了集群中所有表的结构、分区信息、副本分布、索引等元数据。元数据存储使用了Raft协议来保证元数据的一致性，确保在分布式环境下的事务操作具有原子性和一致性。

5. **Frontend接口：**
   - 前端接口是Doris与用户和应用程序交互的入口，支持SQL查询语言。用户可以通过前端接口提交查询、更新和管理元数据。Doris的前端接口可以通过多种方式进行访问，包括命令行工具、Web界面以及支持ODBC和JDBC的客户端工具。

整体架构图如下所示：

```
         +-------------+
         |    Master   |
         +------+------+
                |
         +------v------+
         |  Metadata  |
         |   Store    |
         +------+------+
                |
         +------v------+
         |  Storage   |
         |  Engine    |
         +------+------+   +-------------+
                |         |             |
         +------v------+  |             |
         |  Query   |  |  |             |
         |  Engine  |  |  |             |
         +-------------+  +-------------+
                |
         +------v------+
         | Frontend    |
         | Interface   |
         +-------------+
```

这个架构允许Doris在大规模数据集上提供实时大数据分析的能力，同时通过分布式存储和查询引擎的设计，实现了高性能和高可用性。

## 2. **Doris的存储引擎是如何工作的？**
   - **为什么重要：** 理解存储引擎的工作原理有助于你了解Doris如何有效地存储和管理数据。

Doris的存储引擎是一个关键组件，负责实际数据的存储、管理和提供高性能的查询。

以下是Doris存储引擎的工作原理的主要方面：

1. **列式存储结构：**
   - Doris采用列式存储结构，将每一列的数据分别存储在一起。相比于行式存储，列式存储有助于提高压缩比、减少I/O操作，以及提高查询性能。这种存储结构特别适用于OLAP场景，其中通常需要对大量列进行复杂的分析。

2. **分布式存储：**
   - 存储引擎是分布式的，数据被分为多个分片，每个分片都有多个副本存储在不同的节点上。这确保了数据的高可用性和容错性。每个分片都是一个独立的存储单元，可以在集群中的不同节点上进行分布式存储。

3. **实时数据更新：**
   - 存储引擎支持实时数据更新，允许在查询执行的同时进行数据写入。这使得Doris适用于实时数据分析场景，其中需要及时获取最新的数据。

4. **副本管理：**
   - 存储引擎负责管理每个分片的多个副本。副本的存在保证了数据的冗余存储，当某个节点发生故障时，可以从其他节点获取相同的数据。Doris存储引擎会自动进行副本的分布和调整，以保证高可用性和数据的一致性。

5. **分片和分区策略：**
   - 存储引擎支持按照分片和分区的策略进行数据存储。分片和分区的设计有助于将负载分散到多个节点上，防止某个节点的过载，提高系统整体的可用性。分区的策略可以根据具体的查询模式进行优化，以支持更高效的数据加载和查询。

6. **数据压缩：**
   - Doris存储引擎支持对数据进行压缩，以减小存储空间占用，提高查询性能。采用列式存储的结构，以及对数据进行压缩，可以在一定程度上减少磁盘IO的需求，从而提高数据读取速度。

7. **数据归档和清理：**
   - 存储引擎支持数据的归档和清理，以及对历史数据的管理。这对于数据仓库中的数据生命周期管理非常重要，可以有效地清理不再需要的数据，释放存储资源。

8. **索引管理：**
   - 存储引擎支持索引，以提高特定查询条件下的查询性能。合理选择和管理索引是数据仓库设计中的关键因素。

Doris的存储引擎通过这些机制，结合列式存储和分布式存储的优势，实现了高性能和高可用性，适用于实时大数据分析的场景。

## 3. **Doris的查询引擎是如何优化查询的？**
   - **为什么重要：** 查询引擎的优化直接关系到系统的查询性能，了解其工作原理可以帮助你编写更有效的查询。

Doris的查询引擎通过一系列优化策略和技术来提高查询性能。

以下是一些Doris查询引擎优化查询的关键方面：

1. **并行查询处理：**
   - Doris的查询引擎支持并行查询处理，可以同时在多个节点上执行查询操作。通过将查询任务分解为多个子任务，并在不同的节点上并行执行，可以显著提高查询性能。并行查询充分利用了分布式存储引擎和集群计算的优势。

2. **列存储的优化：**
   - Doris采用列式存储结构，查询引擎有效地利用了这一结构的优势。查询时只读取必要的列，跳过不相关的数据，从而减少IO操作和提高查询速度。列存储结构特别适用于OLAP场景，其中通常需要对大量列进行复杂的分析。

3. **计算下推（Predicate Pushdown）：**
   - Doris支持在存储引擎中进行部分计算的优化，例如过滤条件的计算。这样的计算下推可以减少查询时需要传输的数据量，降低网络开销，从而提高查询性能。

4. **分区裁剪（Partition Pruning）：**
   - Doris通过分区裁剪来优化查询性能。分区裁剪是指在执行查询时，仅查询涉及的分区，跳过不相关的分区，从而减小扫描范围，提高查询速度。

5. **智能优化器：**
   - Doris的查询引擎具有智能优化器，能够根据查询的具体特点和数据分布情况生成最优的查询计划。优化器会考虑查询中的过滤条件、连接操作、排序需求等因素，以生成最有效的执行计划。

6. **索引的有效利用：**
   - 合理选择和使用索引是查询性能优化的关键。Doris的查询引擎能够根据查询需求选择合适的索引，并有效利用索引进行查询，以加速检索过程。

7. **负载均衡的查询执行：**
   - Doris的查询引擎通过负载均衡机制，确保查询任务在整个集群中分布均匀。这有助于充分利用集群资源，避免某个节点的过载，提高系统整体的查询性能。

8. **分布式查询执行：**
   - Doris的查询引擎能够在分布式环境中执行查询，充分利用集群中多个节点的计算资源。并行执行和分布式查询执行是Doris实现高性能查询的关键。

这些优化策略和技术共同作用，使得Doris的查询引擎能够在大规模数据集上提供高性能的实时查询服务，适用于复杂的OLAP场景。

## 4. **Doris的分布式事务管理是如何实现的？**
   - **为什么重要：** 理解分布式事务管理是确保数据一致性和可靠性的关键，对于系统的稳定运行至关重要。

Doris的分布式事务管理是通过Raft协议来实现的。Raft是一种一致性协议，用于分布式系统中的元数据管理，确保分布式系统在发生故障或节点变更时，能够保持一致性。

以下是Doris分布式事务管理的关键方面：

1. **Raft协议：**
   - Doris的元数据存储和存储引擎之间的交互采用了Raft协议，用于实现分布式事务管理。Raft协议是一种强一致性的协议，通过选举Leader、复制日志、应用日志等机制，确保系统的元数据存储在所有节点上保持一致。

2. **元数据一致性：**
   - 在Doris中，元数据存储负责存储集群中所有表的结构、分区信息、副本分布等元数据。元数据存储通过Raft协议确保元数据的一致性。当发生元数据变更（例如表结构的修改、分区的增加等）时，这些变更会以日志的形式被复制到集群中的所有节点上，确保所有节点的元数据保持一致。

3. **分布式事务的原子性和一致性：**
   - 当用户执行一条涉及到元数据变更的SQL语句时，Doris的分布式事务管理会保证这些变更操作的原子性和一致性。这意味着这些变更要么全部执行成功，要么全部失败，从而确保系统在任何情况下都能保持一致的状态。

4. **事务的提交与回滚：**
   - 在Doris中，一次分布式事务涉及到多个节点的操作。一旦所有相关的节点都确认了变更操作，事务就可以被提交。如果任何一个节点发生故障或者某些节点的确认出现问题，事务将被回滚，以确保数据的一致性。

5. **事务的持久化和恢复：**
   - 通过Raft协议，Doris将事务相关的操作日志进行持久化存储。这样即使在节点故障、重启或者其他异常情况下，系统能够从存储的日志中恢复，保障事务的一致性。

通过使用Raft协议，Doris能够有效地管理分布式事务，确保元数据的一致性和系统的稳定性。这为Doris在大规模数据分析场景下提供了可靠的基础，支持用户执行复杂的SQL查询和管理操作。

## 5. **Doris的元数据存储和管理是如何工作的？**
   - **为什么重要：** 元数据存储对于Doris的正常运行至关重要，了解元数据存储的机制有助于你理解系统的元数据管理和事务操作。

Doris的元数据存储和管理是通过专门的元数据存储组件实现的，它负责维护集群中所有表的结构、分区信息、副本分布、索引等元数据。

以下是Doris元数据存储和管理的主要工作原理：

1. **Raft协议的使用：**
   - Doris的元数据存储采用了Raft协议，这是一种分布式一致性协议。Raft协议通过选举Leader、复制日志、应用日志等机制，确保元数据在集群中的所有节点上保持一致。

2. **Leader-Follower模型：**
   - 在Raft协议中，集群的每个节点可以是Leader、Follower或Candidate。Leader是负责处理客户端请求和复制日志的节点，而Follower则按照Leader的指示执行相同的操作。Leader-Follower模型保证了集群的高可用性和一致性。

3. **元数据的持久化：**
   - 元数据存储在每个节点上，并通过Raft协议的机制进行持久化。持久化的元数据包括表的结构、分区信息、副本分布、索引定义等。这样，即使在节点故障或重启的情况下，系统可以通过读取持久化的元数据来保持一致性。

4. **元数据变更的原子性和一致性：**
   - 当用户执行一条SQL语句导致元数据的变更时，这些变更会以日志的形式被复制到集群中的所有节点。Raft协议确保了这些变更的原子性和一致性，即这些变更要么全部执行成功，要么全部失败，从而保持元数据的一致性。

5. **分布式事务管理：**
   - 元数据存储在Doris中充当了分布式事务的角色。在元数据变更的过程中，Raft协议确保了分布式事务的原子性和一致性。当所有相关的节点确认了元数据的变更，分布式事务就能够提交，从而确保系统在任何情况下都能保持一致的状态。

6. **查询优化信息的存储：**
   - 除了表的结构和元数据，Doris的元数据存储还负责存储查询优化所需的信息。这些信息可能包括统计信息、索引信息以及其他执行计划优化所需的元数据。

总体而言，Doris的元数据存储和管理通过Raft协议实现了分布式一致性，保证了元数据的可靠性和一致性。这为Doris的高性能和高可用性提供了坚实的基础。

## 6. **Doris的数据模型和表设计有哪些最佳实践？**
   - **为什么重要：** 合理的数据模型和表设计直接影响到查询性能和系统的可维护性，了解最佳实践可以帮助你在实际应用中做出明智的设计决策。

Doris的数据模型和表设计在实际应用中涉及到一些最佳实践，这些实践有助于优化查询性能、提高系统的可维护性和灵活性。以下是一些Doris数据模型和表设计的最佳实践：

1. **合理选择分区键：**
   - 选择合适的分区键对于分布式数据库系统非常重要。分区键的选择应该基于查询的模式，以及分析和过滤数据的需求。合理的分区键可以提高查询性能，减少扫描的数据量。

2. **避免过度分区：**
   - 尽管分区有助于提高查询性能，但过度分区也可能导致额外的管理开销和性能损失。选择适当数量的分区，使之能够满足查询需求的同时，避免过度细分。

3. **考虑数据的压缩：**
   - 利用Doris的列式存储结构，考虑对适当的列进行压缩。数据压缩可以减小存储空间占用，同时提高查询性能，尤其是在大规模数据集上。

4. **使用合适的数据类型：**
   - 选择合适的数据类型能够减小存储空间占用，并且有助于提高查询性能。根据实际需求，选择精准且经济的数据类型，避免使用过大或不必要的数据类型。

5. **适当使用索引：**
   - 根据查询需求，使用合适的索引。索引可以加速特定查询条件下的检索，但过多或不必要的索引可能会导致写入性能下降。选择在最频繁查询的列上创建索引。

6. **分布式事务设计：**
   - 在设计表结构时，考虑是否需要进行分布式事务。分布式事务通常涉及到多个表的操作，需要谨慎设计表之间的关联关系，以确保事务的原子性和一致性。

7. **考虑查询的并发性和复杂性：**
   - 根据实际查询需求，合理设计表结构以支持并发查询和复杂的分析操作。优化表结构和索引以满足典型查询的性能要求，确保系统能够高效地执行查询。

8. **分布式系统的水平扩展：**
   - 在设计数据模型时，考虑系统的水平扩展性。避免使用单一节点过多的数据存储负载，合理划分数据，以便能够方便地水平扩展集群规模。

9. **定期维护和优化：**
   - 定期进行表的维护和优化，包括数据清理、碎片整理、统计信息更新等操作，以确保系统的高性能和可维护性。

10. **使用分区键列进行过滤：**
    - 在查询中尽可能使用分区键列进行过滤，以减小扫描的数据量，提高查询性能。

这些最佳实践提供了一些指导原则，但具体的设计取决于应用的特定需求。在设计数据模型和表结构时，需要权衡不同因素，根据实际场景做出明智的决策。

## 7. **Doris的负载均衡和节点管理是如何实现的？**
   - **为什么重要：** 了解负载均衡和节点管理有助于你在维护和扩展集群时做出明智的决策，以确保系统的高效运行。

Doris通过负载均衡和节点管理来确保集群的高效运行。

以下是Doris负载均衡和节点管理的主要实现方式：

1. **负载均衡：**
   - Doris的负载均衡主要涉及到查询的任务分配和数据的分片。Doris会根据集群中各个节点的负载情况，将查询任务和数据分片均匀地分配给各个节点。这确保了集群中每个节点的负载相对均衡，避免了单个节点过度负载而影响系统性能。

2. **任务分发和执行：**
   - Doris的Master节点负责协调和管理查询任务的分发。Master会将查询任务分配给适当的存储节点，存储节点再根据具体的表结构和数据分片信息执行查询。负载均衡机制确保了查询任务在集群中均匀分布，提高了整体查询性能。

3. **数据分片和分布：**
   - Doris将数据分为多个分片，每个分片有多个副本存储在不同的节点上。数据的分片和分布策略有助于负载均衡，同时提高了系统的可用性和容错性。Doris通过监控各个节点的负载情况，动态调整数据的分布，以适应集群的变化。

4. **节点管理：**
   - Doris的Master节点负责集群中各个节点的管理和维护。节点管理涉及到节点的加入、退出、故障恢复等操作。当有新节点加入集群时，Master负责将数据分配给新节点，确保新节点参与到负载均衡中。当节点发生故障或退出时，Master会相应地重新分配数据和任务，以保证系统的正常运行。

5. **自动副本调整：**
   - Doris支持自动副本调整机制，当节点发生故障或新节点加入时，系统会自动调整各个分片的副本分布，以保证数据的可用性和一致性。这有助于集群在节点变更时自动适应新的拓扑结构。

6. **节点状态监控：**
   - Doris的Master节点会监控集群中各个节点的状态。通过定期检测节点的健康状况，Master能够及时发现并处理故障节点，确保集群的稳定性和可用性。

这些机制使得Doris能够在大规模数据集上实现负载均衡和节点管理，确保系统在各种情况下都能够高效运行。

在系统运行过程中，Doris会根据集群的动态变化进行自适应调整，从而保持负载均衡和节点管理的效果。

## 8. **Doris的安全性和权限管理是如何实现的？**
   - **为什么重要：** 安全性是任何数据库系统都必须考虑的重要问题，了解Doris的安全机制可以帮助你确保系统的数据安全。

Doris实现安全性和权限管理的方式主要涉及身份验证、访问控制和数据加密等方面。以下是Doris的安全性和权限管理的主要实现方式：

1. **身份验证（Authentication）：**
   - Doris支持用户名和密码的身份验证机制，确保只有经过授权的用户能够访问系统。用户需要提供有效的身份验证信息，包括用户名和密码，才能登录到Doris系统。

2. **访问控制（Authorization）：**
   - Doris通过访问控制列表（ACL）来控制用户对数据库、表和列族的访问权限。管理员可以配置ACL，明确规定哪些用户或用户组有权执行特定的操作，如查询、插入、更新或删除数据。这样可以确保只有授权用户才能执行敏感操作。

3. **角色管理（Role Management）：**
   - Doris支持角色的概念，可以通过角色来集中管理用户的权限。管理员可以将一组权限分配给角色，然后将用户添加到这些角色中，简化权限管理过程。这有助于提高系统的可维护性和灵活性。

4. **SSL/TLS加密：**
   - Doris支持使用SSL/TLS协议对数据传输进行加密，以保护数据在传输过程中的安全。通过启用SSL/TLS，可以防止恶意用户通过网络拦截或窃听数据。

5. **密码策略：**
   - Doris支持管理员配置密码策略，包括密码复杂性、过期时间和锁定策略等。这有助于提高系统的安全性，防止使用弱密码、长期不更改密码或者进行暴力破解的行为。

6. **安全审计（Audit）：**
   - Doris提供安全审计功能，记录用户登录、操作和权限变更等关键事件。安全审计日志可以用于追踪和分析系统的安全状况，以及检测潜在的安全威胁。

7. **Kerberos认证：**
   - Doris支持使用Kerberos认证，通过与Kerberos集成，提供更强大的身份验证机制。Kerberos认证可以增强Doris在大规模企业环境中的安全性。

8. **IP白名单：**
   - Doris支持配置IP白名单，限制只有特定IP地址的客户端可以访问系统。这增加了对系统访问的控制，确保只有经过授权的客户端可以连接到Doris。

通过这些安全性和权限管理的实现方式，Doris能够提供一定级别的安全性，保护系统免受未经授权的访问和恶意攻击。管理员可以根据实际需求进行配置，以满足不同安全性要求的场景。

## 9. **Doris在实时大数据分析场景中的应用有哪些成功案例？**
   - **为什么重要：** 了解Doris在实际应用中的成功案例可以帮助你更好地理解系统的实际应用场景和性能表现。

截至我知识截止日期（2022年1月），Doris在实时大数据分析场景中已经取得了一些成功的应用案例。以下是一些Doris的应用案例：

1. **美团点评：**
   - 美团点评作为中国领先的生活服务平台，曾经在其技术博客中分享过使用Doris进行数据实时分析的经验。在美团点评的场景中，Doris被用于处理大规模的实时业务数据，以支持实时查询和分析，从而帮助业务快速做出决策。

2. **菜鸟网络：**
   - 菜鸟网络是阿里巴巴集团旗下的物流平台，据报道，菜鸟网络也在其数据仓库中使用Doris进行实时大数据分析。Doris的实时查询和分析能力有助于菜鸟网络在物流运营中进行实时监控和决策。

3. **中兴通讯：**
   - 中兴通讯是中国的通信设备和解决方案提供商，据报道，中兴通讯在其数据平台中采用了Doris进行实时数据分析。Doris的高性能和分布式架构使其成为处理通信行业大量数据的可行选择。

请注意，实际应用案例可能会发生变化，而且可能有其他未被公开报道的使用Doris的组织。为获取最新的信息，建议查阅Doris官方网站、技术博客以及相关企业的技术分享和案例研究。

## 10. **Doris的社区活跃度如何？**
    - **为什么重要：** 了解Doris的社区活跃度可以帮助你评估系统的发展动力、问题解决速度和可持续性。一个活跃的社区通常意味着更好的支持和更新。

这些问题涵盖了Doris的核心方面，从基础架构到应用场景，有助于你全面了解这个分布式数据库系统。在深入学习过程中，你可以通过查阅文档、参与社区讨论和实践来进一步加深理解。

截至我知识截止日期（2022年1月），Apache Doris是一个开源项目，其社区活跃度通常可以通过查看项目的GitHub仓库、邮件列表、讨论论坛、贡献者情况等方式来评估。

请注意，社区活跃度是一个动态的指标，可能随时间而变化。

以下是一些了解Doris社区活跃度的方法：

1. **GitHub仓库：**
   - 查看Doris的GitHub仓库，了解项目的最近更新情况、提交记录、分支情况等。一个活跃的开源项目通常会有持续的代码更新和社区参与。

2. **邮件列表和讨论论坛：**
   - 参与或观察Doris的邮件列表、讨论论坛，这是社区成员进行技术讨论、提问、回答问题的地方。活跃的社区通常会有丰富的技术交流。

3. **贡献者信息：**
   - 查看Doris项目的贡献者信息，了解有多少人参与了项目的开发。多样性和数量较多的贡献者通常是一个健康社区的标志。

4. **社区活动：**
   - 关注Doris社区的活动，如线上或线下的技术分享会、研讨会等。这些活动可以反映社区的活跃程度和技术氛围。

5. **社区文档和博客：**
   - 查阅Doris的官方文档、技术博客等，了解社区的技术积累和分享情况。

6. **社交媒体：**
   - 查看Doris在社交媒体上的活动，如Twitter、LinkedIn等。社交媒体通常是项目宣传、分享最新动态的渠道。

请注意，社区活跃度的评估需要考虑多个因素，并建议通过多种途径来获取综合的了解。对于最新的社区活动和动态，建议查阅Doris的官方网站和相关社区平台。

# 参考资料


* any list
{:toc}