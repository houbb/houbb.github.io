---
layout: post
title: IM å³æ—¶é€šè®¯ç³»ç»Ÿ-45-merua0oo0 IM  åˆ†å¸ƒå¼èŠå¤©ç³»ç»Ÿ
date: 2024-11-02 21:01:55 +0800
categories: [IM]
tags: [im, opensource, sh]
published: true
---

# IM å¼€æºç³»åˆ—

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-41-å¼€æº é‡ç«IM ä¸“æ³¨äºå³æ—¶é€šè®¯å®æ—¶éŸ³è§†é¢‘æŠ€æœ¯ï¼Œæä¾›ä¼˜è´¨å¯æ§çš„IM+RTCèƒ½åŠ›](https://houbb.github.io/2024/11/02/im-41-opensouce-yehuo-overview)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-42-åŸºäºnettyå®ç°çš„IMæœåŠ¡ç«¯,æä¾›å®¢æˆ·ç«¯jaråŒ…,å¯é›†æˆè‡ªå·±çš„ç™»å½•ç³»ç»Ÿ](https://houbb.github.io/2024/11/02/im-42-opensouce-yuanrw-im-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-43-ç®€å•çš„ä»¿QQèŠå¤©å®‰å“APP](https://houbb.github.io/2024/11/02/im-43-opensouce-xiuweikang-im)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-44-ä»¿QQå³æ—¶é€šè®¯ç³»ç»ŸæœåŠ¡ç«¯](https://houbb.github.io/2024/11/02/im-44-opensouce-kingston-csj-im)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-45-merua0oo0 IM åˆ†å¸ƒå¼èŠå¤©ç³»ç»Ÿ](https://houbb.github.io/2024/11/02/im-45-opensouce-merua0oo0-im)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-46-OpenIM æä¾›äº†ä¸“ä¸ºå¼€å‘è€…è®¾è®¡çš„å¼€æºå³æ—¶é€šè®¯è§£å†³æ–¹æ¡ˆ](https://houbb.github.io/2024/11/02/im-46-opensouce-open-im-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-47-beardlessCat IM ä½¿ç”¨nettyå¼€å‘åˆ†å¸ƒå¼Imï¼Œæä¾›åˆ†å¸ƒnettyé›†ç¾¤è§£å†³æ–¹æ¡ˆ](https://houbb.github.io/2024/11/02/im-47-opensouce-beardlessCat-im-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-48-aurora-imui æ˜¯ä¸ªé€šç”¨çš„å³æ—¶é€šè®¯ï¼ˆIMï¼‰UI åº“ï¼Œä¸ç‰¹å®šäºä»»ä½• IM SDK](https://houbb.github.io/2024/11/02/im-48-opensouce-aurora-imui-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-49-äº‘ä¿¡ IM UIKit æ˜¯åŸºäº NIM SDKï¼ˆç½‘æ˜“äº‘ä¿¡ IM SDKï¼‰å¼€å‘çš„ä¸€æ¬¾å³æ—¶é€šè®¯ UI ç»„ä»¶åº“ï¼ŒåŒ…æ‹¬èŠå¤©ã€ä¼šè¯ã€åœˆç»„ã€æœç´¢ã€ç¾¤ç®¡ç†ç­‰ç»„ä»¶](https://houbb.github.io/2024/11/02/im-49-opensouce-nim-uikit-android-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-50-ğŸ“²cim(cross IM) é€‚ç”¨äºå¼€å‘è€…çš„åˆ†å¸ƒå¼å³æ—¶é€šè®¯ç³»ç»Ÿ](https://houbb.github.io/2024/11/02/im-50-opensouce-cim-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-51-MPushå¼€æºå®æ—¶æ¶ˆæ¯æ¨é€ç³»ç»Ÿ](https://houbb.github.io/2024/11/02/im-51-opensouce-mpush-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-52-leo-im æœåŠ¡ç«¯](https://houbb.github.io/2024/11/02/im-52-opensouce-leo-im-intro)

[IM å³æ—¶é€šè®¯ç³»ç»Ÿ-53-im system server](https://houbb.github.io/2024/11/02/im-53-opensouce-linyu-intro)


# IM

https://github.com/merua0oo0/im


#### é¡¹ç›®ä»‹ç»
1. IMæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼èŠå¤©ç³»ç»Ÿï¼Œç›®å‰å®Œå…¨å¼€æºï¼Œä»…ç”¨äºå­¦ä¹ å’Œäº¤æµã€‚
1. æ”¯æŒç§èŠã€ç¾¤èŠã€ç¦»çº¿æ¶ˆæ¯ã€å‘é€å›¾ç‰‡ã€æ–‡ä»¶ã€å¥½å‹åœ¨çº¿çŠ¶æ€æ˜¾ç¤ºç­‰åŠŸèƒ½ã€‚
1. åç«¯é‡‡ç”¨springboot+nettyå®ç°ï¼Œå‰ç«¯ä½¿ç”¨vueã€‚
1. æœåŠ¡å™¨æ”¯æŒé›†ç¾¤åŒ–éƒ¨ç½²ï¼Œæ¯ä¸ªim-serverä»…å¤„ç†è‡ªèº«è¿æ¥ç”¨æˆ·çš„æ¶ˆæ¯



#### é¡¹ç›®ç»“æ„
|  æ¨¡å—  |     åŠŸèƒ½ |
|-------------|------------|
| im-platform | ä¸é¡µé¢è¿›è¡Œäº¤äº’ï¼Œå¤„ç†ä¸šåŠ¡è¯·æ±‚ |
| im-server   | æ¨é€èŠå¤©æ¶ˆæ¯|
| im-client   | æ¶ˆæ¯æ¨é€sdk|
| im-common   | å…¬å…±åŒ…  |

#### æ¶ˆæ¯æ¨é€æ–¹æ¡ˆï¼ˆæ¨æ–¹æ¡ˆï¼‰

![è¾“å…¥å›¾ç‰‡è¯´æ˜](https://github.com/merua0oo0/im/raw/master/pic/im_push.png)

- imé€šè¿‡é•¿è¿æ¥å®ç°æ¶ˆæ¯æ¨é€ï¼Œå•æœºæƒ…å†µä¸‹ä¸åŒç”¨æˆ·çš„channelæ˜¯åœ¨åŒä¸€å°æœºå™¨ä¸Šå¯ä»¥æ‰¾åˆ°å¹¶ä¸”æŠ•é€’ï¼Œå½“åœºæ™¯è½¬æ¢ä¸ºåˆ†å¸ƒå¼åï¼Œä¸åŒçš„ç”¨æˆ·channelå¯èƒ½æ˜¯ä¸åŒçš„serveråœ¨ç»´æŠ¤ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å¦‚ä½•å°†æ¶ˆæ¯è·¨serverè¿›è¡ŒæŠ•é€’

- åˆ©ç”¨äº†redisçš„listæ•°æ®å®ç°æ¶ˆæ¯æ¨é€ï¼Œå…¶ä¸­keyä¸ºim:unread:${serverid},æ¯ä¸ªkeyçš„æ•°æ®å¯ä»¥çœ‹åšä¸€ä¸ªmessageQueue,æ¯ä¸ªserveræ ¹æ®è‡ªèº«çš„serverIdåªæ¶ˆè´¹å±äºè‡ªå·±çš„queue

- åŒæ—¶ä½¿ç”¨ä¸€ä¸ªä¸­å¿ƒåŒ–å­˜å‚¨è®°å½•äº†æ¯ä¸ªç”¨æˆ·çš„websocketè¿æ¥çš„serverId,å½“ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œplatformå°†æ ¹æ®receIdæ‰€è¿æ¥çš„serverçš„id,å†³å®šå°†æ¶ˆæ¯æ¨å‘å“ªä¸ªqueue
- æ¯ä¸ªserverä¼šç»´æŠ¤æœ¬åœ°çš„channelï¼Œæ”¶åˆ°messageQueueä¸­çš„æ¶ˆæ¯åæ‰¾åˆ°å¯¹åº”çš„Queueè¿›è¡ŒæŠ•é€’

#### çƒ­ç‚¹ç¾¤èŠä¼˜åŒ–æ–¹æ¡ˆï¼ˆæ¨æ‹‰ç»“åˆï¼‰

![è¾“å…¥å›¾ç‰‡è¯´æ˜](https://github.com/merua0oo0/im/raw/master/pic/im_pull.png)

- åœ¨å®¢æˆ·ç«¯ä¼šç»´æŠ¤çƒ­ç‚¹ç¾¤èŠçš„å·²è¯»offsetï¼Œç”¨æˆ·å‘é€çƒ­ç‚¹ç¾¤èŠæ¶ˆæ¯ç»™server

- serverç»Ÿä¸€å°†æ¶ˆæ¯é€šè¿‡MQä¸TSæœåŠ¡è¿›è¡Œè§£è€¦ï¼ŒTSæœåŠ¡è´Ÿè´£å°†æ¶ˆæ¯è¿›è¡Œå…¥åº“ï¼ŒåŒæ—¶å¯¹æ¯”ç”¨æˆ·å­˜åœ¨redisä¸­çš„å·²è¯»æ¶ˆæ¯çš„å­˜æ ¹æ˜¯å¦æœ‰å¿…è¦å°†messageæŠ•é€’åˆ°receIdå¯¹åº”çš„messageQueue

- è‹¥æŠ•é€’åˆ°messageQueueåï¼Œserveræ¶ˆè´¹åæŠ•é€’ç»™clientæ— çŠ¶æ€çš„å¯ä»¥æ‹‰å–è¯·æ±‚

- clientæ”¶åˆ°è¯·æ±‚åè¿›è¡Œæ‰¹é‡æ‹‰å–ï¼Œæ‹‰å–æ˜¯éœ€è¦ä»DBä¸­æ‹‰å–ï¼Œé˜²æ­¢DBå‹åŠ›è¿‡å¤§ï¼Œç”¨å­˜æ ¹offsetä¸groupæœ€æ–°æ¶ˆæ¯è¿›è¡Œåˆ¤æ–­æ˜¯å¦æœ‰å¿…è¦æ‹‰å–ã€‚

- æ‹‰å–æ“ä½œåŠ¡å¿…ä½¿ç”¨å¼‚æ­¥ï¼Œå¯ä»¥ä½¿ç”¨MQï¼Œæ–¹ä¾¿å¯ä»¥ä½¿ç”¨ä¸šåŠ¡çº¿ç¨‹ï¼Œé˜²æ­¢å•ä¸ªæ‹‰å–åŠ¨ä½œè¿‡æ…¢å¯¼è‡´workçº¿ç¨‹é˜»å¡è¿›è€Œå½±å“ç”¨æˆ·çš„å¿ƒè·³æ£€æµ‹ã€‚



# å‚è€ƒèµ„æ–™

* any list
{:toc}