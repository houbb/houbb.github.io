---
layout: post
title: Log4net
date:  2017-03-15 20:32:15 +0800
categories: [Log]
tags: [log, log4net, .net]
header-img: "static/app/res/img/kon-bg.jpeg"
published: true
---


# Log4net

The Apache [log4net](http://logging.apache.org/log4net/) library is a tool to help the programmer output log statements to a variety of output targets.
 
log4net is a port of the excellent Apache log4j™ framework to the Microsoft® .NET runtime. We have kept the framework similar in spirit to the original
 
log4j while taking advantage of new features in the .NET runtime. For more information on log4net see the features document.


> [详细说明](http://www.cnblogs.com/jiajinyi/p/5884930.html)

# Hello World

- Install Log4net.DLL

项目解决方案-》引用-》(右键)管理NuGet程序包-》Apache log4net

![install]({{ site.url }}/static/app/img/log/2017-03-21-log4net-install.png)


- HelloWorld.cs

注意：

1. `[assembly: log4net.Config.XmlConfigurator(Watch=true)]` 在需要使用的Namespace上添加这一段。
 
不加这个标记的话则log无法生效，如果类较多则比较麻烦，此时可以把这个配置放在 `AssemblyInfo.cs` 中，针对整个程序集生效。


```c#
using log4net;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;
using System.Text;
using System.Threading.Tasks;

[assembly: log4net.Config.XmlConfigurator(Watch=true)]
namespace Log4net
{
    class Program
    {
        static void Main(string[] args)
        {
            ILog log = log4net.LogManager.GetLogger(MethodBase.GetCurrentMethod().DeclaringType);
            log.Error("error", new Exception("发生了一个异常"));
            log.Fatal("fatal", new Exception("发生了一个致命错误"));
            log.Info("info");
            log.Debug("debug");
            log.Warn("warn");
            Console.WriteLine("日志记录完毕。");
            Console.ReadKey();
        }
    }
}
```

- App.config

输出配置放在 `App.config` 中，如下：

```xml
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <configSections>
    <section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, log4net"/>
  </configSections>
  
  <log4net>
    <appender name="RollingLogFileAppender" type="log4net.Appender.RollingFileAppender">
      <!--日志路径-->
      <param name= "File" value= "D:\App_Log\"/>
      <!--是否是向文件中追加日志-->
      <param name= "AppendToFile" value= "true"/>
      <!--log保留天数-->
      <param name= "MaxSizeRollBackups" value= "10"/>
      <!--日志文件名是否是固定不变的-->
      <param name= "StaticLogFileName" value= "false"/>
      <!--日志文件名格式为:2008-08-31.log-->
      <param name= "DatePattern" value= "yyyy-MM-dd&quot;.log&quot;"/>
      <!--日志根据日期滚动-->
      <param name= "RollingStyle" value= "Date"/>
      <layout type="log4net.Layout.PatternLayout">
        <param name="ConversionPattern" value="%d [%t] %-5p %c - %m%n %loggername" />
      </layout>
    </appender>
    
    <!-- 控制台前台显示日志 -->
    <appender name="ColoredConsoleAppender" type="log4net.Appender.ColoredConsoleAppender">
      <mapping>
        <level value="ERROR" />
        <foreColor value="Red, HighIntensity" />
      </mapping>
      <mapping>
        <level value="Info" />
        <foreColor value="Green" />
      </mapping>
      <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%n%date{HH:mm:ss,fff} [%-5level] %m" />
      </layout>

      <filter type="log4net.Filter.LevelRangeFilter">
        <param name="LevelMin" value="Info" />
        <param name="LevelMax" value="Fatal" />
      </filter>
    </appender>

    <root>
      <!--(高) OFF > FATAL > ERROR > WARN > INFO > DEBUG > ALL (低) -->
      <level value="all" />
      <appender-ref ref="ColoredConsoleAppender"/>
      <appender-ref ref="RollingLogFileAppender"/>
    </root>
  </log4net>
</configuration>
```

- result

运行程序后：

1、命令行打印对应日志信息


2、`D:\App_Log\2017-07-31.log` 文件内容如下：

```
2017-03-21 10:06:44,713 [9] FATAL Log4net.Program - fatal
 Log4net.ProgramnameSystem.Exception: 发生了一个致命错误
2017-03-21 10:06:44,716 [9] INFO  Log4net.Program - info
 Log4net.Programname2017-03-21 10:06:44,718 [9] DEBUG Log4net.Program - debug
 Log4net.Programname2017-03-21 10:06:44,718 [9] WARN  Log4net.Program - warn
 Log4net.Programname2017-03-21 10:07:07,479 [10] ERROR Log4net.Program - error
 Log4net.ProgramnameSystem.Exception: 发生了一个异常
2017-03-21 10:07:07,516 [10] FATAL Log4net.Program - fatal
 Log4net.ProgramnameSystem.Exception: 发生了一个致命错误
2017-03-21 10:07:07,519 [10] INFO  Log4net.Program - info
 Log4net.Programname2017-03-21 10:07:07,521 [10] DEBUG Log4net.Program - debug
 Log4net.Programname2017-03-21 10:07:07,521 [10] WARN  Log4net.Program - warn
 Log4net.Programname
```

