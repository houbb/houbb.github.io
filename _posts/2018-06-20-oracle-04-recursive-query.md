---
layout: post
title:  Oracle 系统学习-04-oracle 递归查询 start with connect by prior
date:  2018-06-20 10:46:06 +0800
categories: [Oracle]
tags: [oracle, sql, ex]
published: true
---

# 应用场景

有时候我们需要查询一些有层级关系的数据，需要一层一层的向上(下)查询出对应的数据信息。

oracle 提供的递归查询就可以比较方便的实现。

# 递归查询

oracle树状结构查询即层次递归查询，是sql语句经常用到的，在实际开发中组织结构实现及其层次化实现功能也是经常遇到的。

概要：树状结构通常由根节点、父节点、子节点和叶节点组成，简单来说，一张表中存在两个字段，dept_id,par_dept_id,那么通过找到每一条记录的父级id即可形成一个树状结构，也就是par_dept_id（子）=dept_id（父），通俗的说就是这条记录的par_dept_id是另外一条记录也就是父级的dept_id。

## 基本语法

其树状结构层级查询的基本语法是：

```
SELECT [LEVEL],*
FEOM table_name
START WITH 条件1
CONNECT BY PRIOR 条件2
WHERE 条件3
ORDER　BY　排序字段
```

说明：

LEVEL---伪列，用于表示树的层次

条件1---根节点的限定条件，当然也可以放宽权限，以获得多个根节点，也就是获取多个树

条件2---连接条件，目的就是给出父子之间的关系是什么，根据这个关系进行递归查询

条件3---过滤条件，对所有返回的记录进行过滤。

排序字段---对所有返回记录进行排序

## 对 prior 说明

要的时候有两种写法：connect by prior dept_id=par_dept_id 或 connect by dept_id=prior par_dept_id，前一种写法表示采用自上而下的搜索方式（先找父节点然后找子节点），后一种写法表示采用自下而上的搜索方式（先找叶子节点然后找父节点）。

## 遍历步骤

树状结构层次化查询需要对树结构的每一个节点进行访问并且不能重复，其访问步骤为：

大致意思就是扫描整个树结构的过程即遍历树的过程，其用语言描述就是：

步骤一：从根节点开始；

步骤二：访问该节点；

步骤三：判断该节点有无未被访问的子节点，若有，则转向它最左侧的未被访问的子节，并执行第二步，否则执行第四步；

步骤四：若该节点为根节点，则访问完毕，否则执行第五步；

步骤五：返回到该节点的父节点，并执行第三步骤。

除此之外，sys_connect_by_path函数是和connect by 一起使用的，在实战中具体带目的具体介绍！

实战：最近做项目的组织结构，对于部门的各级层次显示，由于这部分掌握不牢固，用最笨的like模糊查询解决了，虽然功能实现了，但是问题很多，如扩展性不好，稍微改下需求就要进行大改，不满意最后对其进行了优化。

# mysql 实现类似的递归查询


# 查考资料

[Oracle 递归查询](https://www.cnblogs.com/Soprano/p/10659127.html)

[Oracle 递归树形结构查询功能](https://www.jb51.net/article/170486.htm)

* any list
{:toc}