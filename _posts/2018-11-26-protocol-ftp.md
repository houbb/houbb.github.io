---
layout: post
title:  FTP
date:  2018-11-26 21:17:01 +0800
categories: [Protocol]
tags: [protocol, sh]
published: false
excerpt: FTP 文件传输协议
---


# FTP

文件传输协议（英文：File Transfer Protocol，缩写：FTP）是用于在网络上进行文件传输的一套标准协议，使用客户/服务器模式。

它属于网络传输协议的应用层。

文件传送（file transfer）和文件访问（file access）之间的区别在于：前者由FTP提供，后者由如NFS等应用系统提供。

参考文献 [RFC959](https://www.ietf.org/rfc/rfc959.txt) 定义了此规范。

FTP是一个8位的客户端-服务器协议，能操作任何类型的文件而不需要进一步处理，就像MIME或Unicode一样。

但是，FTP有着极高的延时，这意味着，从开始请求到第一次接收需求数据之间的时间，会非常长；并且不时的必须执行一些冗长的登录进程。

# 概述

FTP服务一般运行在20和21两个端口。

端口20用于在客户端和服务器之间传输数据流，而端口21用于传输控制流，并且是命令通向ftp服务器的进口。当数据通过数据流传输时，控制流处于空闲状态。而当控制流空闲很长时间后，客户端的防火墙会将其会话置为超时，这样当大量数据通过防火墙时，会产生一些问题。此时，虽然文件可以成功的传输，但因为控制会话，会被防火墙断开；传输会产生一些错误。

FTP虽然可以被终端用户直接使用，但是它是设计成被FTP客户端程序所控制。

运行FTP服务的许多站点都开放匿名服务，在这种设置下，用户不需要帐号就可以登录服务器，默认情况下，匿名用户的用户名是：“anonymous”。这个帐号不需要密码，虽然通常要求输入用户的邮件地址作为认证密码，但这只是一些细节或者此邮件地址根本不被确定，而是依赖于FTP服务器的配置情况。

可以被发送到FTP服务器的FTP命令列表，包含由IETF在RFC 959中标准化的所有命令。

需要注意的是，大多数命令行FTP客户端都给用户提供了额外的命令集。

例如，GET是一个常见的用来下载文件的用户命令，用来替代原始的RETR命令。

## FTP 实现的目标

- 促进文件的共享（计算机程序或数据）

- 鼓励间接或者隐式的使用远程计算机

- 向用户屏蔽不同主机中各种文件存储系统（File system）的细节

- 可靠和高效的传输数据

## 缺点

- 密码和文件内容都使用明文传输，可能发生窃听。

- 因为必须开放一个随机的端口以创建连接，当防火墙存在时，客户端很难过滤处于主动模式下的FTP流量。这个问题，通过使用被动模式的FTP，得到了很大解决。

- 服务器可能会被告知连接一个第三方计算机的保留端口。

- 此方式在需要传输文件数量很多的小文件时，性能不好

# 主动和被动模式

FTP有两种使用模式：主动和被动。

主动模式要求客户端和服务器端同时打开并且监听一个端口以创建连接。在这种情况下，客户端由于安装了防火墙会产生一些问题。所以，创立了被动模式。被动模式只要求服务器端产生一个监听相应端口的进程，这样就可以绕过客户端安装了防火墙的问题。

一个主动模式的FTP连接创建要遵循以下步骤：

1. 客户端打开一个随机的端口（端口号大于1024，在这里，我们称它为x），同时一个FTP进程连接至服务器的21号命令端口。此时，该tcp连接的来源地端口为客户端指定的随机端口x，目的地端口（远程端口）为服务器上的21号端口。

2. 客户端开始监听端口（x+1），同时向服务器发送一个端口命令（通过服务器的21号命令端口），此命令告诉服务器客户端正在监听的端口号并且已准备好从此端口接收数据。这个端口就是我们所知的数据端口。

3. 服务器打开20号源端口并且创建和客户端数据端口的连接。此时，来源地的端口为20，远程数据(目的地)端口为（x+1）。

4. 客户端通过本地的数据端口创建一个和服务器20号端口的连接，然后向服务器发送一个应答，告诉服务器它已经创建好了一个连接。

# 拓展阅读

[Windows 下 FTP 的搭建和使用](https://houbb.github.io/2017/05/06/windows-ftp)

[Ubuntu 搭建 FTP 服务器及 Java 代码访问](https://houbb.github.io/2016/12/31/ftp)

[filezilla-ftp 的开源工具](https://filezilla-project.org/)

# 参考资料

[文件传输协议](https://zh.wikipedia.org/wiki/%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE)

* any list
{:toc}