---
layout: post
title: schedule-00-任务调度整体概览
date: 2024-01-10 21:01:55 +0800
categories: [Schedule]
tags: [schedule, apache, distribued, work-flow, sh]
published: true
---

# 调度系列

## Quartz 入门

[Quartz 入门系列教程-00-序章](https://blog.csdn.net/ryo1060732496/article/details/79794802)

[Quartz 入门系列教程-01-入门案例](https://blog.csdn.net/ryo1060732496/article/details/79794843)

[Quartz 入门系列教程-02-Jobs 和 Trigger](https://blog.csdn.net/ryo1060732496/article/details/79794877)

[Quartz 入门系列教程-03-Jobs 深入学习](https://blog.csdn.net/ryo1060732496/article/details/79853320)

[Quartz 入门系列教程-04-Triggers 深入学习](https://blog.csdn.net/ryo1060732496/article/details/79794895)

[Quartz 入门系列教程-05-SimpleTrigger](https://blog.csdn.net/ryo1060732496/article/details/79854164)

[Quartz 入门系列教程-06-CronTrigger](https://blog.csdn.net/ryo1060732496/article/details/79854194)

[Quartz 入门系列教程-07-TriggerListeners-JobListeners](https://blog.csdn.net/ryo1060732496/article/details/79854238)

[Quartz 入门系列教程-08-SchedulerListeners](https://blog.csdn.net/ryo1060732496/article/details/79854258)

[Quartz 入门系列教程-09-Job Stores](https://blog.csdn.net/ryo1060732496/article/details/79854286)

[Quartz 入门系列教程-10-Configuration](https://blog.csdn.net/ryo1060732496/article/details/79854313)

[Quartz 入门系列教程-11-高级特性](https://blog.csdn.net/ryo1060732496/article/details/79854345)

[Quartz 入门系列教程-12-其他特性](https://blog.csdn.net/ryo1060732496/article/details/79854370)

[Quartz 15-JDBCJobStore 模式介绍](https://houbb.github.io/2017/12/19/quartz-15-jdbc-hello)

[Quartz 16-spring 整合使用](https://houbb.github.io/2017/12/19/quartz-16-spring)

[Quartz 17-springboot+vue+mybatis+mysql](https://houbb.github.io/2017/12/19/quartz-17-spring-boot)

[Quartz 18-分布式任务调度框架 xxl-job elastic-job saturn 对比](https://houbb.github.io/2017/12/19/quartz-18-distributed-job)

[Quartz 19-quartz 分布式任务调度详解](https://houbb.github.io/2017/12/19/quartz-19-distributed-quartz)

[Quartz 19-quartz 实现原理](https://houbb.github.io/2017/12/19/quartz-19-quartz-why)

[Quartz 20-misfire 详解](https://houbb.github.io/2017/12/19/quartz-20-misfire)

## 其他

[Timer 实现任务调度](https://houbb.github.io/2019/01/18/jcip-24-executor-timer)

[ScheduledThreadPoolExecutor 实现任务调度](https://houbb.github.io/2019/01/18/jcip-25-executor-scheduledThreadPoolExecutor)

[cron-utils 用于解析、验证和人类可读描述以及日期/时间互操作性的 Cron 实用程序。](https://houbb.github.io/2021/09/01/cron-utils)

[Cron 表达式测试](https://houbb.github.io/2020/05/06/cron)

[利用有向无环图（DAG）进行任务调度](https://houbb.github.io/2020/01/23/data-struct-learn-03-dag-schedule)

[Quartz 00-quartz 概览](https://houbb.github.io/2017/12/19/quartz-00-overview)

## 分布式调度

[schedule-00-任务调度整体概览](https://houbb.github.io/2024/01/10/schedule-00-overview)

[schedule-01-Apache DolphinScheduler 定时任务调度平台](https://houbb.github.io/2024/01/10/schedule-01-apache-dolphinscheduler-01-overview)

[schedule-02-powerjob 入门介绍](https://houbb.github.io/2024/01/10/schedule-02-powerjob-overview)

[schedule-03-shardingsphere-elasticjob 分布式调度作业框架](https://houbb.github.io/2024/01/10/schedule-03-elasticjob-shardingsphere)

[schedule-04-xxl-job 入门介绍](https://houbb.github.io/2024/01/10/schedule-04-xxl-job-intro)

[schedule-05-Spring Cloud Data Flow 入门介绍](https://houbb.github.io/2024/01/10/schedule-05-spring-data-work-flow-intro)

[schedule-05-Spring Schedule 入门介绍 @Scheduled 注解和 @EnableScheduling 注解](https://houbb.github.io/2024/01/10/schedule-05-spring-schedule-01-intro)

[schedule-05-Spring Schedule 官方文档翻译](https://houbb.github.io/2024/01/10/schedule-05-spring-schedule-02-doc)

[schedule-06-vipshop saturn 唯品会分布式任务调度平台](https://houbb.github.io/2024/01/10/schedule-06-vipshop-saturn-intro)

[schedule-07-任务调度 jobrunr 介绍](https://houbb.github.io/2024/01/10/schedule-07-jobrunr-intro)

[schedule-08-分布式任务调度流批 hazelcast-jet 开源的、内存中的、分布式的批处理和流处理引擎](https://houbb.github.io/2024/01/10/schedule-08-hazelcast-jet-intro)

[schedule-09-分布式任务调度框架 LTS light-task-scheduler 安装笔记](https://houbb.github.io/2024/01/10/schedule-09-LTS-install)

[schedule-09-分布式任务调度框架 LTS light-task-scheduler 入门介绍](https://houbb.github.io/2024/01/10/schedule-09-LTS-intro)

[schedule-10-java 调度基础 scheduleAtFixedRate 和 scheduleWithFixedDelay](https://houbb.github.io/2024/01/10/schedule-10-java-schedule)

[schedule-11-时间轮算法（Time Wheel Algorithm） 入门介绍](https://houbb.github.io/2024/01/10/schedule-11-timewheel-intro)



# chat

## java 分布式任务调度系统开源组件有哪些？

Java 中有许多开源的分布式任务调度系统组件，它们可以帮助你实现分布式的任务调度和管理。

以下是一些常见的开源组件：

1. **Quartz：**
   - **官方网站：** [Quartz Scheduler](http://www.quartz-scheduler.org/)
   - **简介：** Quartz 是一个强大且广泛使用的开源任务调度框架。它支持分布式调度，可用于管理作业的触发、调度和执行。

2. **Elastic Job：**
   - **GitHub：** [elasticjob/elastic-job-lite](https://github.com/elasticjob/elastic-job-lite)
   - **简介：** Elastic Job 是一个分布式调度解决方案，适用于互联网企业级的分布式任务调度。它提供了轻量级的分布式任务调度和分布式数据流处理服务。

3. **xxl-job：**
   - **GitHub：** [xingoo/xxl-job](https://github.com/xingoo/xxl-job)
   - **简介：** xxl-job 是一个分布式任务调度平台，支持动态添加、修改、删除任务，并提供了任务执行日志、运行状态监控等功能。

4. **Spring Cloud Data Flow：**
   - **官方网站：** [Spring Cloud Data Flow](https://spring.io/projects/spring-cloud-dataflow)
   - **简介：** Spring Cloud Data Flow 是一个用于构建和部署分布式数据驱动应用程序的框架。它包括任务调度和流处理的功能。

5. **Saturn：**
   - **GitHub：** [vipshop/Saturn](https://github.com/vipshop/Saturn)
   - **简介：** Saturn 是美团点评开源的分布式任务调度平台，具有高可用、高性能、易扩展等特点。它支持分片广播、作业依赖、流量调度等功能。

6. **JobRunr：**
   - **GitHub：** [jobrunr/jobrunr](https://github.com/jobrunr/jobrunr)
   - **简介：** JobRunr 是一个开源的分布式作业调度库，它建立在 Java 上并使用 Java 8+ 的功能。它支持后台作业的调度和执行。

7. **DistributedScheduler：**
   - **GitHub：** [hazelcast/hazelcast-jet](https://github.com/hazelcast/hazelcast-jet)
   - **简介：** DistributedScheduler 是 Hazelcast Jet 的一部分，它提供了分布式的调度器，适用于各种分布式计算和任务调度的场景。

请注意，选择适合你项目需求的任务调度系统取决于具体的使用场景和功能需求。

这些组件都有各自的特点和优势，你可以根据项目的具体需求来选择最适合的。

## 给出上述分布式任务调度系统的详细对比表格

以下是一些常见的分布式任务调度系统的对比表格。请注意，这只是一个概述，并不详尽无遗。根据实际需求，你可能需要深入研究每个系统的文档和特性。

| 特性/组件                   | Quartz           | Elastic Job      | xxl-job         | Spring Cloud Data Flow | Saturn           | JobRunr           | DistributedScheduler (Hazelcast Jet) |
| --------------------------- | ---------------- | ---------------- | --------------- | ------------------------ | ---------------- | ----------------- | ------------------------------------ |
| **调度策略**                | 触发器           | 分片            | 分片            | 任务流程定义             | 分片            | 无分片            | 无分片                               |
| **分布式支持**              | 是               | 是               | 是              | 是                       | 是               | 是                | 是                                   |
| **动态任务添加/删除**       | 是               | 是               | 是              | 是                       | 是               | 是                | 是                                   |
| **任务依赖性**              | 是               | 是               | 是              | 是                       | 是               | 有限的依赖支持   | 无依赖支持                           |
| **任务执行日志**            | 是               | 是               | 是              | 是                       | 是               | 是                | 无                                 |
| **监控和管理界面**          | 是               | 是               | 是              | 是                       | 是               | 是                | 无                                 |
| **运维性能监控**            | 是               | 是               | 是              | 是                       | 是               | 有限的监控支持   | 无                                 |
| **Java 版本**               | Java 6+          | Java 1.6+        | Java 1.7+       | Java 8+                 | Java 8+          | Java 8+           | Java 8+                             |
| **社区活跃度**              | 高               | 中高             | 高              | 中                       | 高               | 中高              | 高                                 |
| **开发公司/团队支持**       | Quartz Scheduler | 当当网           | 微店           | Pivotal (VMware)        | 美团点评        | 薪资宝            | Hazelcast                           |

这个对比表格只是一个起点，你可能需要根据你的具体需求和系统架构进一步评估这些系统。在选择时，也要考虑项目的规模、可维护性、性能需求以及社区的支持和活跃度。

## Q: 谈一谈任务调度

任务调度是计算机系统中的一个关键概念，它涉及到按照预定的时间表或触发条件执行任务的过程。

任务调度在各种系统中都有广泛的应用，包括操作系统、分布式系统、企业应用等。

以下是关于任务调度的一些重要方面：

1. **定义：** 任务调度是指按照一定的规则和条件，安排和执行计算机系统中的各种任务或作业。这些任务可能包括批处理作业、定时任务、周期性任务等。

2. **任务调度的需求：**
   - **提高效率：** 通过合理的任务调度，可以最大限度地提高计算机系统的资源利用率，确保任务在合适的时间和资源条件下执行。
   - **自动化：** 任务调度可以自动化执行重复性的任务，减轻人工干预的工作负担。
   - **实时性：** 一些任务需要在特定的时间点或在特定的条件下立即执行，任务调度可以确保这些要求得到满足。

3. **调度策略：** 不同的任务调度系统可能采用不同的调度策略，如先来先服务（FCFS）、最短作业优先（SJF）、优先级调度、轮转调度等。在分布式系统中，还涉及到任务的分片调度、负载均衡等问题。

4. **任务类型：**
   - **定时任务：** 基于时间触发的任务，按照预定的时间执行。
   - **事件触发任务：** 根据特定的事件或条件触发执行，如文件创建、消息到达等。
   - **周期性任务：** 在固定时间间隔内循环执行的任务。

5. **分布式任务调度：** 在分布式系统中，任务调度面临更复杂的挑战，包括任务的分布式管理、节点故障恢复、任务依赖关系的处理等问题。分布式任务调度系统通常需要支持任务的动态添加和删除，保证任务的高可用性和容错性。

6. **任务调度系统的组成部分：**
   - **调度器（Scheduler）：** 管理任务的调度，决定任务何时执行。
   - **触发器（Trigger）：** 触发任务执行的条件，可以基于时间、事件等。
   - **任务执行器（Job Executor）：** 负责执行具体的任务逻辑。
   - **监控和管理界面：** 提供任务执行情况、性能监控、日志查看等功能。

7. **开源任务调度框架：** 如前文提到的 Quartz、Elastic Job、xxl-job 等，这些框架提供了通用的任务调度解决方案，可用于各种场景。

总体而言，任务调度是计算机系统中的一项关键技术，能够提高系统的效率、可靠性和自动化水平。

在设计和选择任务调度系统时，需要根据具体的需求和场景来权衡各种因素，以确保系统能够满足预期的性能和可维护性要求。

## Q: 分布式任务调度时如何保证一次只有一个任务执行？

在分布式任务调度中，确保一次只有一个任务执行是非常关键的，以避免潜在的竞态条件、数据不一致或其他问题。

以下是一些常见的方法来实现这个目标：

1. **分布式锁：** 使用分布式锁是一种常见的方法，它能确保在同一时间只有一个节点能够获得锁，从而执行相应的任务。常见的分布式锁实现包括基于数据库的实现（如使用数据库行锁）、基于缓存的实现（如使用Redis或ZooKeeper实现分布式锁）等。

2. **Leader Election：** 使用 Leader Election（领导者选举）机制，确保只有一个节点被选举为领导者，而其他节点则遵循领导者的指令执行任务。Apache ZooKeeper是一个常用的工具，用于实现分布式系统中的 Leader Election。

3. **分布式队列：** 将任务放入分布式队列中，确保只有一个消费者能够从队列中取出并执行任务。常见的分布式队列包括 Apache Kafka、RabbitMQ 等。

4. **数据库乐观锁：** 在任务执行前，先在数据库中更新一个标志字段，并使用乐观锁机制确保只有一个节点能够成功更新。其他节点会检测更新是否成功，如果失败则等待重试。

5. **分布式协调服务：** 使用分布式协调服务，如Apache ZooKeeper或etcd，来协调任务的执行。通过在这些服务中创建临时节点或使用租约机制，可以实现只有一个节点获得执行权限。

6. **分布式事务：** 使用分布式事务机制，确保任务的执行是原子的，要么全部执行成功，要么全部回滚。这可以通过两阶段提交（Two-Phase Commit，2PC）等协议来实现。

选择哪种方法取决于系统的具体需求和架构，以及对一致性、可用性和性能的不同权衡。

需要注意的是，分布式任务调度的实现通常需要处理网络分区、节点故障等情况，因此要考虑系统的容错性和可靠性。

## Q: 分布式队列确实可以实现调度的功能，但是如果想要每一次任务执行的耗时，是否成功等应该怎么设计？

确实，分布式队列可以用于任务的调度和分发，但是在实际场景中，通常还需要考虑任务执行的耗时、执行结果等信息。以下是一些常见的方法来设计处理这些方面的需求：

1. **任务状态信息：** 在任务的元数据中包含状态信息，例如任务的执行状态（等待、运行、完成、失败等）。这样，可以随时查询任务的状态，了解任务的执行进度。

2. **任务执行时间记录：** 在任务开始执行和完成执行的时候记录时间戳，并将这些时间信息存储在任务元数据中。这可以用于计算任务的执行耗时。

3. **回调机制：** 允许任务执行完成后，触发一个回调机制，通知系统或其他模块任务已经完成。这样可以及时处理任务的结果或执行下一步操作。

4. **异步通知：** 使用异步通知机制，将任务执行的结果通过消息或通知方式发送给相关的订阅者。这可以通过消息队列实现，如在任务完成时发布一个消息，订阅者接收并处理。

5. **任务日志：** 记录任务的执行日志，包括任务的输入、输出、执行时间等信息。这有助于排查问题、性能调优以及后续的分析和监控。

6. **数据库存储：** 将任务的执行结果、状态等信息存储在数据库中。这样可以通过查询数据库来获取任务的详细信息。

7. **任务监控系统：** 集成任务监控系统，通过监控界面查看任务的执行情况、耗时统计等信息。一些开源任务调度框架通常提供了任务执行监控的功能。

8. **消息队列中的扩展属性：** 一些消息队列系统允许在消息中携带自定义的扩展属性。你可以在消息中添加诸如任务ID、执行时间、结果等信息，以便更好地跟踪和分析。

选择适当的方法取决于具体的业务需求和系统设计。

在设计任务调度系统时，考虑到任务的执行结果、执行时间等信息是至关重要的，以便实现更全面的监控、管理和分析。






# 参考资料

https://github.com/apache/dolphinscheduler

* any list
{:toc}