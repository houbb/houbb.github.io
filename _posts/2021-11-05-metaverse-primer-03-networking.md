---
layout: post
title: Metaverse 元宇宙入门-03-networking 网络与元宇宙
date: 2021-11-02 21:01:55 +0800
categories: [Metaverse]
tags: [Metaverse, sh]
published: true
---

# 网络与元宇宙

这是“元界入门”的第三部分，重点介绍网络在“元界”中的作用。 

在这里，网络被定义为“由骨干供应商、网络、交换中心和在它们之间路由的服务以及管理'最后一英里'的服务提供持久的、实时的连接、高带宽和分散的数据传输。 向消费者提供数据。”

网络的三个核心领域——带宽、延迟和可靠性——可能是大多数读者最不感兴趣的元节支持者。 

然而，它们的限制和增长塑造了我们设计元界产品和服务的方式，何时可以使用它们，以及我们可以（并且可能永远不能）做什么。

# 带宽

带宽通常被认为是“速度”，但实际上是单位时间内可以传输的数据量。 

Metaverse 的要求远高于大多数互联网应用程序和游戏，并且超出了许多现代连接。

了解这一点的最佳方式是通过 Microsoft Flight Simulator。

Microsoft Flight Simulator 是历史上最真实和最广泛的消费者模拟。它包括 2 万亿棵单独渲染的树木、15 亿座建筑物以及全球几乎所有的道路、山脉、城市和机场……所有这些看起来都像“真实的东西”，因为它们基于对真实事物的高质量扫描。但要实现这一目标，Microsoft Flight Simulator 需要超过 2.5 PB 的数据 — 或 2,500,000 GB。消费者设备（或大多数企业设备）无法存储如此大量的数据。

即使可以，Microsoft Flight Simulator 也是一项实时服务，可以更新以反映真实世界的天气（包括准确的风速和风向、温度、湿度、突袭和照明）和空中交通。您可以从字面上飞入现实世界的飓风和风暴，同时在 IRL 商业客机的确切飞行路径上尾随其后。

Microsoft Flight Simulator 通过在本地设备上存储大量核心数据来工作（它也运行游戏，就像任何控制台游戏一样，而不像 Stadia 等基于云的游戏流服务）。 

但是，当用户在线时，Microsoft 会根据需要将大量数据流式传输到本地玩家的设备。 

把它想象成现实世界的飞行员。 

当他们翻过一座山或绕过一个弯道时，新的光信息会流入他们的视网膜，第一次揭示并澄清那里的东西。 

在此之前，他们一无所有，但知道会有什么东西存在。

许多游戏玩家认为这是所有在线多人视频游戏中都会发生的情况。 

但是，实际上，大多数游戏服务仅向单个玩家发送位置数据、玩家输入数据（例如射击、投掷炸弹）和摘要级别数据（例如玩家留在大逃杀中）。 

所有资产和渲染数据都已经在您的本地设备上，因此下载和安装时间很长，加上硬盘驱动器的使用。

通过根据需要发送渲染数据，游戏可以拥有更加多样化的物品、资产和环境。 

他们无需延迟下载和安装游戏、更新批处理或庞大的用户硬盘驱动器即可完成此操作。 

因此，许多游戏现在都采用这种本地存储信息和数据流的混合模型。 

但是，这种方法对于以 Metaverse 为重点的平台最为重要。 

例如，与《马里奥赛车》或《使命召唤》等游戏相比，Roblox 需要（并从中受益更多）资产、物品和环境的多样性。

随着虚拟仿真的复杂性和重要性的增加，需要流式传输的数据量也会增加。至少就目前而言，Roblox 受益于许多底层预制件和资产被广泛重新利用和轻松定制的事实。鉴于此，Roblox 主要是流式传输有关如何调整以前下载的项目的数据。但最终虚拟平台将需要近乎无限数量的排列和创造（几乎所有这些都无法完全预测）。

虚拟孪生平台（也称为“镜像世界”），例如 Microsoft Flight Simulator，已经需要重建现实世界中几乎无限（且可证明）的多样性。这意味着发送的数据比“这里的乌云”或“95% 的乌云 C-95”要多得多（即更重）。相反，它是一团与此完全相同的乌云。至关重要的是，这些数据正在实时变化。

最后一点是关键。

**如果我们想在一个大型、实时、共享和持久的虚拟环境中进行交互，我们将需要接收大量的云流数据。**

将“现实世界”与 Fortnite 的地图进行比较。地球上的每个人都同时处于同一个“模拟”中，并且完全持久。如果我砍倒一棵树，那棵树对每个人来说都无可挽回地消失了。

当您玩 Fortnite 时，只能通过地图的固定时间点版本。您在该地图中所做的一切只会与少数用户共享，并且会在重置之前的短时间内共享。砍树？它将在 1 到 25 分钟内重置，并且最初只有多达 99 个其他用户消失。只有当 Epic Games 发布新版本时，地图才会真正改变。如果 Epic Games 想要将您的世界发送给其他所有人，他们会选择您的世界，无视他们的世界，并在特定时间点修复您的世界。对于许多虚拟体验来说，这很好。它也适用于许多 Metaverse 特定的体验。但是某些（如果不是最重要的）体验需要在所有用户之间始终保持持久性。

如果我们想在不同的虚拟世界之间无缝跳转，云数据流也是必不可少的。 Fortnite 的 Travis Scott 音乐会将玩家从游戏的核心地图无缝运送到前所未见的海洋深处，然后到达前所未见的星球，然后深入外太空。为了实现这一目标，Epic 在活动开始前几天到几小时通过标准的 Fortnite 补丁将所有这些游戏世界发送给用户（当然，这意味着如果用户在活动开始前没有下载并安装更新，他们将无法参与其中）。然后，在每个定位球期间，每个球员的设备都会在后台加载下一个定位球。这个系统运行得非常好，但它需要发布者提前知道用户接下来会去哪个世界。如果您想选择并从广泛的目的地中进行选择，您必须下载所有潜在选项的全部内容（这是不可能的），或者云流式传输它们。

除了增加的环境数据外，还有增加的玩家数据。当您今天在 Fortnite 中看到您的朋友时，Fortnite 服务器只需要向您发送有关您的朋友在哪里以及他们正在尝试做什么的信息；动画（例如重新加载突击步枪或坠落）已经加载到您的设备上，只需运行即可。但是，当您将实时动作捕捉映射到朋友的头像时，也需要发送这些详细信息。和其他人一起。如果你想在这个游戏中观看视频文件，就像 Fortnite 有时提供的那样，那么这也需要在虚拟世界中进行流式传输。听到人群的空间音频？相同的。感觉路人擦过你的触觉紧身连衣裤的肩部？相同的。

对于只需要位置和输入数据的在线游戏，许多玩家已经在为带宽和网络拥塞而苦苦挣扎。 

Metaverse 只会强化这些需求。好消息是宽带普及率和带宽在全球范围内不断提高。计算（将在第 3 节中详细讨论）也在改进，并且可以通过预测在“真实”数据可以被替代的点之前应该发生什么来帮助替代受约束的数据传输。

# 延迟（Latency）

网络中最大的挑战也是它最不为人所知的：延迟。

延迟是指数据从一个点传输到另一个点并返回所需的时间。与网络带宽（上）和可靠性（下）相比，延迟通常被认为是最不重要的 KPI。这是因为大多数互联网流量是单向或异步的。发送 WhatsApp 消息和接收已读回执之间是否需要 100 毫秒或 200 毫秒甚至两秒的延迟并不重要。单击 YouTube 的暂停按钮直到视频停止需要 20 毫秒、150 毫秒或 300 毫秒也无关紧要。观看 Netflix 时，连续播放流比立即播放更为重要。为此，Netflix 人为地延迟了视频流的开始，以便您的设备可以在您观看的那一刻之前下载。这样，如果您的网络出现一两分钟的崩溃或打嗝，您将永远不会注意到。

即使是同步和持久连接的视频通话，对延迟的容忍度也相对较高。视频是通话中最不重要的元素，因此音频是“最轻”的数据，如果出现网络问题，视频通话软件通常会优先考虑。如果您的延迟暂时增加 - 甚至到几秒，而不是几毫秒 - 软件可以通过提高音频积压的播放速度并快速编辑停顿来节省您的时间。此外，参与者很容易管理延迟——你只需学会等待。

然而，最具沉浸感的 AAA 在线多人游戏需要低延迟。这是因为延迟决定了玩家接收信息的速度（例如玩家在哪里，是否投掷了手榴弹或足球）以及他们的响应传输给其他玩家的速度。换句话说，延迟决定了你是赢还是输，是杀还是最终被杀。这就是为什么大多数现代游戏的播放速度是视频平均帧率的 2-4 倍，以及我们迅速接受这些提高的原因，即使我们抵制传统视频的更高帧率。它是性能所必需的。

在视频游戏中，人为延迟的门槛非常低，尤其是与其他媒体相比。

例如，考虑传统视频与视频游戏。一般人甚至不会注意到音频是否与视频不同步，除非它早到超过 45 毫秒，或者晚到超过 125 毫秒（总共 170 毫秒）。可接受性阈值甚至更宽，早 90 毫秒和晚 185 毫秒（275 毫秒）。对于数字按钮，例如 YouTube 暂停按钮，如果我们在 200-250 毫秒后没有看到响应，我们只会认为我们的点击失败。在 AAA 游戏中，狂热的游戏玩家在 50 毫秒时感到沮丧，即使是非游戏玩家也会在 110 毫秒时感到受阻。游戏在 150 毫秒内无法播放。 

Subspace 发现，平均而言，延迟增加或减少 10 毫秒，每周播放时间会减少或增加 6%。这是一次非同寻常的曝光——这是其他企业所没有的。

考虑到上述频段，让我们看看全球的平均延迟。 

在美国，数据从一个城市发送到另一个城市并返回的平均往返时间为 35 毫秒。 

许多配对都超过了这一点，尤其是高密度和需求高峰的城市（例如晚上从旧金山到纽约）。 

然后是“城市到用户”的运输时间，特别容易出现减速。 

密集的城市、社区或公寓很容易拥挤。 

如果您通过移动设备玩游戏，今天的 4G 技术平均需要 40 毫秒。 如果您住在主要城市中心以外，您的数据可能需要再传输 100 英里，并且使用陈旧、维护不良的有线基础设施。 

在全球范围内，城市之间的中位交付延迟范围为 100-200 毫秒。

为了管理延迟，在线游戏行业开发了许多部分解决方案和技巧。然而，没有一个规模特别好。

例如，大多数高保真多人游戏都是围绕服务器区域进行“匹配”。通过尽量减少居住在美国东北部、西欧或东南亚的玩家名单，游戏发行商能够在地理基础上最大限度地减少延迟。由于游戏是一种休闲活动，通常与一到三个朋友一起玩，因此这种聚类效果很好。毕竟，您不太可能与几个时区之外的人一起玩游戏。无论如何，你并不真正关心你不知名的对手（你通常甚至无法与之交谈）住在哪里。尽管如此，Subspace 发现中东地区大约四分之三的互联网连接超出了动态多人游戏的可玩延迟水平，而在美国和欧洲，四分之一是。这主要反映了宽带基础设施的局限性，而不是服务器放置。

多人在线游戏也使用“netcode”解决方案来确保同步和一致性并保持玩家的游戏乐趣。基于延迟的网络代码会告诉玩家的设备（例如 PlayStation 5）人为地延迟其所有者输入的渲染，直到更潜在的玩家（即他们的对手）的输入到达。这会惹恼肌肉记忆适应低延迟的玩家，但它确实有效。回滚网络代码更复杂。如果对手的输入被延迟，玩家的设备将根据预期发生的情况继续进行。如果事实证明对手做了不同的事情，设备将尝试展开正在进行的动画，然后“正确地”重播它们。

这些解决方案适用于 1v1 游戏（例如 2D 战斗机）、小延迟打嗝（例如 ±40 毫秒）以及具有有限范围的高度可预测动作的游戏（例如驾驶游戏、2D 战斗机）。但随着我们扩展到更多以元界为中心的体验，有更多的玩家、更大的延迟变化和更多的动态场景，这些解决方案会降级。很难连贯且正确地预测十几个玩家，并以非破坏性的方式“回滚”他们。相反，简单地断开延迟播放器的连接更有意义。虽然视频通话有很多参与者，但一次只有一个真正重要，因此存在“核心”延迟。在游戏中，从所有玩家那里获取正确的信息很重要，而延迟则很复杂。

对于大多数游戏来说，低延迟不是问题。诸如《炉石传说》或《与朋友们的对话》之类的游戏要么是回合制的，要么是异步的，而其他热门游戏，例如《王者荣耀》或《糖果粉碎传奇》既不需要像素完美也不需要毫秒级精确输入。它实际上只是像 Fortnite、Call of Duty 和 Forza 这样需要低延迟的快节奏游戏。这些类型的游戏利润丰厚，但它们仅占游戏总市场的一小部分，在总游戏时间中所占的份额甚至更小。

然而，虽然 Metaverse 不是一款快节奏的 AAA 游戏，但其社交性质和所需的重要性意味着它需要低延迟。

**轻微的面部动作对于人类对话非常重要——我们对轻微的错误和同步问题非常敏感（因此出现了 CGI 中的恐怖谷问题）。**

社交产品也依赖于它们的普遍性。试想一下，除非您的朋友或家人在 500 英里内，否则 FaceTime 或 Facebook 无法正常工作。或者只有当你在家的时候。如果我们想在虚拟世界中利用外国或远程劳动力，我们需要的不仅仅是多余的带宽。

不幸的是，延迟是所有网络属性中修复最难和最慢的。部分问题源于，如上所述，很少有服务和应用程序需要超低延迟交付。这限制了任何网络运营商或以延迟为中心的内容交付网络 (CDN) 的业务案例——这里的业务案例已经受到挑战，并且与基本物理定律相冲突。

在 11,000-12,500 公里的距离内，从纽约市到东京或孟买需要 40-45 毫秒的光。这满足所有低延迟阈值。然而，虽然大多数互联网主干是光纤，但光纤电缆的速度比光速低约 30%，因为它很少在真空中（+ 损耗通常为 3.5 dB/km）。铜缆和同轴电缆在远距离的延迟下降更严重，带宽更有限，这意味着拥塞和延迟交付的风险更大。这些电缆仍然占住宅和商业建筑内部以及社区中发现的电缆的较大部分。

此外，这些电缆都没有像乌鸦一样铺设。我们通常认为的“互联网骨干网”实际上是一个松散的私有网络联盟，没有一个可以完全传输数据包（或者有动力与具有一两个更快段的竞争对手进行权衡）。因此，一对服务器或服务器和客户端之间的网络距离可能远大于它们的地理距离。此外，网络拥塞可能导致流量路由更不直接，以确保可靠和持续的交付，而不是最小化延迟。这就是为什么从纽约市到东京的平均延迟是两个城市之间光传输时间的 4 倍以上，而从纽约市到孟买的平均延迟是 4-6 倍。

升级或中继任何基于电缆的基础设施是非常昂贵和困难的，特别是如果目标是最小化地理距离。它还需要大量的监管/政府批准，通常在多个级别。当然，修复无线网络更容易。 5G 肯定有帮助，因为它平均比 4G 减少 20-40 毫秒（并承诺低至 1 毫秒的延迟）。但是，这仅有助于最后几百米的数据传输。一旦您的数据到达塔，您就返回到传统的主干。

SpaceX 的卫星互联网星座公司 Starlink 承诺在美国乃至世界其他地区提供高带宽、低延迟的互联网服务。但这并不能解决超低延迟的问题，尤其是在远距离时。虽然 Starlink 实现了从您家到卫星再返回 18-35 毫秒的旅行时间，但当数据必须从纽约到洛杉矶再返回时，这一时间会延长。毕竟，这需要跨多颗卫星进行中继。在某些情况下，Starlink 甚至会加剧旅行距离。纽约到费城的直线距离约为 100 英里，电缆可能为 125 英里，但在前往低轨道卫星并返回时超过 700 英里。此外，光纤电缆的损耗远低于通过大气传输的光，尤其是在阴天。密集的城市地区也很嘈杂，因此容易受到干扰。 

2020 年，埃隆·马斯克强调，Starlink 专注于“最难服务的客户，[电信公司] 否则难以触及。”从这个意义上说，它为 Metaverse 带来了更多，而不是促进那些已经参与的人。

正在开发全新的技术、业务线和服务，以满足对实时带宽应用不断增长的需求。

例如，Subspace（披露：投资组合公司）在数百个城市部署硬件以开发用于低延迟网络寻路的“天气图”，运营一个网络堆栈，然后协调低延迟应用程序的需求与许多第三方 -组成这条路径的各方，甚至建立了一个光纤网络，将各种光纤网络拼接起来，以进一步缩短服务器之间的距离，并最大限度地减少非光纤布线的使用。

同时，Fastly 提供针对低延迟应用程序优化的 CDN，而不仅仅是交付可靠性和带宽。该公司使用“基础设施即代码”方法，允许客户定制公司边缘计算集群的几乎所有方面，并承诺软件应用程序可以在 150 毫秒内在全球范围内清除和替换所有这些集群中的所有缓存内容，并且它可以实时缓存和加速单个区块链交易。

# 可靠性

可靠性是相当明显的。我们转向虚拟劳动力和教育的能力直接取决于可靠的服务质量。这包括整体正常运行时间以及下载/上传带宽和延迟等其他属性的一致性。对于今天“在线生活”的许多人来说，以上大部分内容似乎都是危言耸听。大多数情况下，Netflix 以 1080p 甚至 4K 完美播放！但是，Netflix 等服务利用的可靠性解决方案不适用于游戏或 Metaverse 特定应用程序。

Netflix 等非直播视频服务会在向观众提供之前数小时到数月接收所有视频文件。

这允许他们执行广泛的分析，以便通过分析帧数据来确定可以丢弃哪些信息来缩小（或“压缩”）文件大小。 

Netflix 的算法将“观看”一个蓝天场景，并决定如果观众的互联网速度下降，500 种不同深浅的蓝色可以简化为 200、50 或 25。流媒体的分析甚至根据上下文进行分析——认识到对话场景比快节奏动作可以承受更多的压缩。

这是多通道编码。如前所述，Netflix 还使用空闲带宽在用户需要之前将视频发送到用户设备——因此，如果连接暂时下降或延迟增加，最终用户不会体验到任何变化。

此外，Netflix 会在本地节点预加载内容；因此，当您询问 Stranger Things 的最新一集时，实际上只有几个街区之遥。

这对于实时创建的视频或数据是不可能的，如上所述，它们也需要更快地到达。这就是为什么云流 1GB Stadia 比 1GB Netflix 更难的原因。

因此，即使它的目标本质上不一定具有竞争力，但我们应该将 Metaverse 视为将网络的所有方面的要求——延迟、可靠性/弹性和带宽——提高到 AAA 多人游戏的要求。如果您的设备无法及时接收所需的所有信息，那么您的设备有多强大（请参阅硬件和计算）都没有关系。

这是九部分“METAVERSE PRIMER”的第三部分。

马修·鲍尔 (@ballmatthew)

# 参考资料

https://www.matthewball.vc/all/networkingmetaverse

* any list
{:toc}