---
layout: post
title: 权限体系之-90-OAuth 2.0 入门介绍
date: 2025-11-20 14:12:33 +0800
categories: [plateform]
tags: [plateform, sh]
published: true
---

# chat

## 一、OAuth 2.0 的概念

**OAuth 2.0** 是一种开放标准的 **授权协议**，用于让用户授权第三方应用访问自己在某服务上的资源，而无需直接把用户名和密码提供给第三方。
它强调的是 **授权**（Authorization），而不是 **认证**（Authentication）。

* **授权（Authorization）**：允许第三方应用访问用户资源（例如访问用户的邮箱、照片等）。
* **认证（Authentication）**：确认用户身份（例如登录系统）。

OAuth 2.0 是 OAuth 1.0 的升级版本，更简化、灵活，广泛用于 Web、移动端和 API 授权。

---

## 二、OAuth 2.0 的核心角色

OAuth 2.0 定义了四个主要角色：

1. **资源拥有者（Resource Owner）**

   * 通常是最终用户。
   * 拥有受保护资源，如邮箱、照片、文件等。

2. **资源服务器（Resource Server）**

   * 存储受保护资源的服务器。
   * 根据访问令牌（Access Token）判断请求是否有权限访问资源。

3. **客户端（Client）**

   * 需要访问资源的应用或服务。
   * 必须先获得资源拥有者的授权。

4. **授权服务器（Authorization Server）**

   * 负责颁发访问令牌（Access Token）。
   * 验证客户端身份和用户授权。

---

## 三、OAuth 2.0 的核心概念

1. **访问令牌（Access Token）**

   * 客户端使用它访问资源服务器的受保护资源。
   * 通常是短期有效的字符串。

2. **刷新令牌（Refresh Token）**

   * 用于在访问令牌过期后获取新的访问令牌。
   * 允许长时间访问而无需再次让用户授权。

3. **授权码（Authorization Code）**

   * 一次性代码，用于换取访问令牌。
   * 用于授权码模式，增加安全性。

4. **作用域（Scope）**

   * 定义客户端请求的权限范围，例如读取用户邮箱、写入文件等。

---

## 四、OAuth 2.0 的授权流程

OAuth 2.0 支持多种授权模式（Grant Type），主要有以下四种：

### 1. 授权码模式（Authorization Code Grant）

最安全、最常用，适合服务端 Web 应用。

流程概览：

1. 客户端引导用户访问授权服务器的授权页面。
2. 用户登录并同意授权。
3. 授权服务器返回 **授权码** 给客户端。
4. 客户端用授权码向授权服务器换取 **访问令牌**。
5. 客户端使用访问令牌访问资源服务器。

> 特点：客户端不会直接接触用户密码，授权码可以增加安全性。

---

### 2. 简化模式 / 隐式授权（Implicit Grant）

适用于纯前端应用（SPA），不经过服务器端。

流程概览：

1. 客户端直接向授权服务器请求访问令牌。
2. 授权服务器在浏览器重定向时返回访问令牌。

> 特点：快捷，但安全性较低，因为令牌直接暴露在前端。

---

### 3. 密码模式（Resource Owner Password Credentials Grant）

客户端直接收集用户用户名和密码，用于换取访问令牌。

> 特点：不推荐，只有在用户高度信任客户端时使用（例如官方应用），安全性较低。

---

### 4. 客户端模式（Client Credentials Grant）

客户端自己代表自己访问资源，不涉及用户授权。

> 适用于服务之间调用 API，例如微服务之间访问配置服务。

---

## 五、OAuth 2.0 的典型流程图

```
+--------+                               +---------------+
|        |--(A)- Authorization Request ->|               |
|        |                               | Authorization |
| Client |<-(B)-- Authorization Code ----|     Server    |
|        |                               |               |
|        |--(C)-- Access Token Request ->|               |
|        |                               +---------------+
|        |<-(D)----- Access Token -------|
|        |
|        |--(E)----- API Request w/Token -> Resource Server
|        |<-(F)------- Protected Resource
+--------+
```

* A/B: 用户授权
* C/D: 客户端换取访问令牌
* E/F: 客户端使用访问令牌访问资源

---

## 六、常见应用场景

1. **第三方登录（Login with Google/Facebook/GitHub）**

   * 使用 OAuth 2.0 授权获取用户基本信息。
2. **API 访问**

   * 第三方应用访问用户存储在云服务上的数据（例如 Google Drive、Dropbox）。
3. **移动应用授权**

   * 用户允许应用访问特定功能或数据，无需分享密码。

---

## 七、OAuth 2.0 安全注意点

1. **避免令牌泄露**

   * 使用 HTTPS，确保访问令牌在传输中安全。
2. **访问令牌过期策略**

   * 设置短期有效的访问令牌，使用刷新令牌延长访问。
3. **使用授权码模式**

   * 尤其是 Web 应用，避免隐式模式。
4. **限制作用域**

   * 最小权限原则，只申请必要的权限。
5. **防止 CSRF**

   * 在授权请求中使用 `state` 参数，防止跨站请求伪造。

---

## 八、总结

* **OAuth 2.0** 是授权标准，而非认证协议。
* 核心角色：用户、客户端、资源服务器、授权服务器。
* 核心概念：访问令牌、刷新令牌、授权码、作用域。
* 授权模式多样：授权码模式最安全，客户端模式用于服务间调用。
* 安全重点：HTTPS、令牌过期策略、最小权限原则、防 CSRF。


## 这个和 RBAC 有什么区别？

很好，这两个概念经常被混淆，但实际上 **OAuth 2.0** 和 **RBAC（基于角色的访问控制）** 是完全不同层面的东西，虽然都涉及“权限”。我帮你梳理一下它们的区别和联系。

---

## 一、定义区别

| 特性   | OAuth 2.0            | RBAC                     |
| ---- | -------------------- | ------------------------ |
| 核心概念 | 授权协议，用于安全地让第三方应用访问资源 | 访问控制模型，用于定义谁可以访问系统中的哪些资源 |
| 关注点  | “谁可以代表用户访问资源”        | “用户可以做什么操作”              |
| 层面   | 授权流程层（协议级）           | 权限管理层（策略级）               |
| 典型用途 | 第三方登录、API 授权、移动应用授权  | 系统内部用户管理、权限分配、功能控制       |

---

## 二、工作方式区别

1. **OAuth 2.0**

   * 强调 **令牌**（Access Token、Refresh Token）和 **授权流程**。
   * 用于 **跨系统授权**，即一个系统允许另一个系统访问用户资源，而不暴露密码。
   * 授权是 **临时的**，按作用域和时间控制。

2. **RBAC**

   * 强调 **角色和权限映射**：

     * 用户 → 角色 → 权限 → 资源操作
   * 用于 **系统内部访问控制**，决定用户能执行哪些操作。
   * 权限通常是 **长期配置的**，根据角色变化。

---

## 三、举例说明

### 场景 1：OAuth 2.0

你在一个网站上使用 **“登录 GitHub”**：

* 网站（客户端）想读取你的邮箱。
* OAuth 2.0 流程让你授权网站访问你的邮箱，但你不需要把 GitHub 密码告诉它。
* GitHub 发给网站一个访问令牌，网站用它访问你的邮箱。

> 这里关注的是 **授权第三方访问**。

---

### 场景 2：RBAC

在企业内部系统：

* Alice 是“经理”，Bob 是“普通员工”。
* 系统规定：

  * 经理可以审批报销单
  * 员工只能提交报销单
* 当 Alice 登录系统时，她能看到审批按钮，Bob 看不到。

> 这里关注的是 **系统内部用户权限控制**。

---

## 四、关系和结合点

实际上，OAuth 2.0 和 RBAC 可以结合使用：

1. **OAuth 控制访问的入口**

   * 第三方应用通过 OAuth 获取访问令牌。
2. **RBAC 决定访问令牌可以访问的资源或操作**

   * 资源服务器在收到令牌后，使用 RBAC 判断令牌对应用户能执行的具体操作。

例如：

* 一个 API 通过 OAuth 授权访问用户数据。
* API 内部通过 RBAC 判断用户角色，限制访问某些敏感接口。

---

**总结一句话**：

* **OAuth 2.0 = 授权协议 → 谁能访问资源**
* **RBAC = 权限模型 → 用户能做什么操作**

它们属于不同层次，但可以结合使用，形成安全完整的访问控制体系。

* any list
{:toc}