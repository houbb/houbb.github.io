---
layout: post
title: leetcode è¿›é˜¶æ•°æ®ç»“æ„ç¯‡ä¸“é¢˜ä¹‹çº¿æ®µæ ‘ segment-tree 01-å…¥é—¨ä»‹ç»
date:  2020-6-8 15:13:08 +0800
categories: [Algorithm]
tags: [algorithm, data-struct, topics, leetcode, segment-tree, sf]
published: true
---


# æ•°ç»„

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯è€é©¬ã€‚

ä»Šå¤©æˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹ ä¸€ä¸‹æ•°ç»„è¿™ç§æ•°æ®ç»“æ„ã€‚

## ä¸»è¦çŸ¥è¯†

æ•°ç»„éœ€è¦æ‹†åˆ†ä¸‹é¢å‡ ä¸ªéƒ¨åˆ†ï¼š

1. ç†è®ºä»‹ç»

2. æºç åˆ†æ

3. æ•°æ®ç»“æ„å®ç°ï¼Ÿ

4. é¢˜ç›®ç»ƒä¹ ï¼ˆæŒ‰ç…§ç®—æ³•æ€æƒ³åˆ†ç±»ï¼‰

5. æ¢³ç†å¯¹åº”çš„ sdk åŒ…

6. åº”ç”¨å®æˆ˜

å› ä¸ºè¿™ä¸ªæ˜¯ leetcode ç³»åˆ—ï¼Œæ‰€ä»¥é‡ç‚¹æ˜¯ 4ã€5(å¯¹4å†ä¸€æ¬¡æ€»ç»“)ã€‚

ä¸ºäº†ç…§é¡¾æ²¡æœ‰åŸºç¡€çš„å°ä¼™ä¼´ï¼Œä¼šç®€å•ä»‹ç»ä¸€ä¸‹1çš„åŸºç¡€ç†è®ºã€‚

ç®€å•ä»‹ç»1ï¼Œé‡ç‚¹ä¸º4ã€‚å…¶ä»–ä¸æ˜¯æœ¬ç³»åˆ—çš„é‡ç‚¹ã€‚

# æ•°æ®ç»“æ„ç¯‡

## é€šç”¨åŸºç¡€

é“¾è¡¨ 

æ ‘

å“ˆå¸Œè¡¨

stack æ ˆ

queue é˜Ÿåˆ—

ordered set æœ‰åºé›†åˆ

heap  å †

graph å›¾


## è¿›é˜¶

å¹¶æŸ¥é›†

å­—å…¸æ ‘

çº¿æ®µæ ‘

æ ‘çŠ¶æ•°ç»„

åç¼€æ•°ç»„

# chat

https://leetcode.cn/studyplan/top-100-liked/

## è¯¦ç»†ä»‹ç»ä¸€ä¸‹åŠ›æ‰£æ•°æ®ç»“æ„ä¹‹çº¿æ®µæ ‘

**çº¿æ®µæ ‘ï¼ˆSegment Treeï¼‰** æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„é«˜çº§æ•°æ®ç»“æ„ï¼Œåœ¨ LeetCode å’Œå„ç§ç®—æ³•ç«èµ›ä¸­å¸¸ç”¨äºå¤„ç†ï¼š

> âœ… åŒºé—´æŸ¥è¯¢ï¼ˆå¦‚æœ€å¤§å€¼ã€æœ€å°å€¼ã€åŒºé—´å’Œï¼‰+ âœ… åŒºé—´æ›´æ–°

---

## ğŸ¯ ä¸€ã€çº¿æ®µæ ‘æ˜¯ä»€ä¹ˆï¼Ÿ

**çº¿æ®µæ ‘æ˜¯ä¸€æ£µäºŒå‰æ ‘**ï¼Œæ¯ä¸ªèŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªæ•°ç»„åŒºé—´ `[l, r]` ä¸Šçš„ä¿¡æ¯ï¼ˆå¦‚åŒºé—´å’Œã€åŒºé—´æœ€å°å€¼ç­‰ï¼‰ï¼Œæ”¯æŒï¼š

* **ä¿®æ”¹å•ä¸ªå…ƒç´ /åŒºé—´å…ƒç´ **
* **æŸ¥è¯¢æŸä¸€æ®µåŒºé—´çš„ç»Ÿè®¡ä¿¡æ¯**

### å¯¹æ¯”å…¶ä»–æ–¹æ³•ï¼š

| æ–¹æ³•                 | æ’å…¥/ä¿®æ”¹    | åŒºé—´æŸ¥è¯¢     | æ”¯æŒåŒºé—´ä¿®æ”¹    |
| ------------------ | -------- | -------- | --------- |
| æš´åŠ›æ•°ç»„               | O(1)     | O(n)     | âŒ         |
| å‰ç¼€å’Œ                | O(1)     | O(1)ï¼ˆé™æ€ï¼‰ | âŒ         |
| çº¿æ®µæ ‘                | O(log n) | O(log n) | âœ…         |
| æ ‘çŠ¶æ•°ç»„ï¼ˆFenwick Treeï¼‰ | O(log n) | O(log n) | âŒï¼ˆåŒºé—´æ›´æ–°è¾ƒéš¾ï¼‰ |

---

## ğŸ“¦ äºŒã€çº¿æ®µæ ‘ç»“æ„ï¼ˆä»¥æ±‚åŒºé—´å’Œä¸ºä¾‹ï¼‰

ä¸€ä¸ªå¤§å°ä¸º `n` çš„æ•°ç»„ï¼Œå¯ä»¥æ„å»ºä¸€æ£µçº¿æ®µæ ‘ï¼Œæ€»èŠ‚ç‚¹æ•°é‡å¤§çº¦ä¸º `4 * n`ã€‚

æ¯ä¸ªèŠ‚ç‚¹è¡¨ç¤ºæ•°ç»„æŸä¸ªåŒºé—´ `[start, end]` çš„å’Œï¼Œå¦‚ï¼š

```
build(0, 7):
            [0,7]
         /        \
     [0,3]        [4,7]
    /    \        /   \
[0,1]  [2,3]   [4,5] [6,7]
...
```

---

## ğŸ§° ä¸‰ã€çº¿æ®µæ ‘æ”¯æŒçš„æ“ä½œ

| æ“ä½œ               | å«ä¹‰               | æ—¶é—´å¤æ‚åº¦    |
| ---------------- | ---------------- | -------- |
| `build()`        | æ„å»ºçº¿æ®µæ ‘            | O(n)     |
| `update(i, val)` | æ›´æ–°ä¸‹æ ‡ä¸º i çš„å€¼       | O(log n) |
| `query(l, r)`    | æŸ¥è¯¢åŒºé—´ `[l, r]` çš„å€¼ | O(log n) |

---

## âœ… å››ã€çº¿æ®µæ ‘çš„æ ¸å¿ƒå®ç°ï¼ˆä»¥åŒºé—´æ±‚å’Œä¸ºä¾‹ï¼‰

### Java ç‰ˆæœ¬ï¼ˆæ•°ç»„å®ç°ï¼‰

```java
class SegmentTree {
    int[] tree;
    int n;

    public SegmentTree(int[] nums) {
        n = nums.length;
        tree = new int[4 * n];
        build(nums, 0, 0, n - 1);
    }

    // æ„å»ºçº¿æ®µæ ‘
    void build(int[] nums, int node, int l, int r) {
        if (l == r) {
            tree[node] = nums[l];
            return;
        }
        int mid = l + (r - l) / 2;
        build(nums, 2 * node + 1, l, mid);
        build(nums, 2 * node + 2, mid + 1, r);
        tree[node] = tree[2 * node + 1] + tree[2 * node + 2];
    }

    // åŒºé—´æŸ¥è¯¢
    int query(int ql, int qr) {
        return query(0, 0, n - 1, ql, qr);
    }

    int query(int node, int l, int r, int ql, int qr) {
        if (qr < l || r < ql) return 0; // æ— äº¤é›†
        if (ql <= l && r <= qr) return tree[node]; // å®Œå…¨è¦†ç›–
        int mid = l + (r - l) / 2;
        return query(2 * node + 1, l, mid, ql, qr) +
               query(2 * node + 2, mid + 1, r, ql, qr);
    }

    // æ›´æ–°æŸä¸ªä½ç½®
    void update(int index, int val) {
        update(0, 0, n - 1, index, val);
    }

    void update(int node, int l, int r, int index, int val) {
        if (l == r) {
            tree[node] = val;
            return;
        }
        int mid = l + (r - l) / 2;
        if (index <= mid) update(2 * node + 1, l, mid, index, val);
        else update(2 * node + 2, mid + 1, r, index, val);
        tree[node] = tree[2 * node + 1] + tree[2 * node + 2];
    }
}
```

---

## ğŸ§  äº”ã€LeetCode å¸¸è§é¢˜å‹å’Œåº”ç”¨

| é¢˜ç›®                                                                            | ç±»å‹     | è§£æ³•è¯´æ˜           |
| ----------------------------------------------------------------------------- | ------ | -------------- |
| [307. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹](https://leetcode.cn/problems/range-sum-query-mutable/)   | åŒºé—´æ±‚å’Œ   | æ„å»ºçº¿æ®µæ ‘æ”¯æŒæ›´æ–°      |
| [303. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„ä¸å¯å˜](https://leetcode.cn/problems/range-sum-query-immutable/) | å‰ç¼€å’Œå³å¯  | ä¸éœ€è¦çº¿æ®µæ ‘         |
| [699. æ‰è½çš„æ–¹å—](https://leetcode.cn/problems/falling-squares/)                   | åŒºé—´æœ€å¤§é«˜åº¦ | ç¦»æ•£åŒ– + çº¿æ®µæ ‘ç»´æŠ¤æœ€å¤§å€¼ |
| [327. åŒºé—´å’Œçš„ä¸ªæ•°](https://leetcode.cn/problems/count-of-range-sum/)               | åŒºé—´ç»Ÿè®¡   | å¯ç”¨æ ‘çŠ¶æ•°ç»„/çº¿æ®µæ ‘/å½’å¹¶  |
| [732. æˆ‘çš„æ—¥ç¨‹å®‰æ’è¡¨ III](https://leetcode.cn/problems/my-calendar-iii/)             | çº¿æ®µé‡å æ¬¡æ•° | ç”¨åŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘ç»´æŠ¤é‡å æ•°é‡ |

---

## ğŸ” å…­ã€çº¿æ®µæ ‘é€‚åˆè§£å†³çš„é—®é¢˜

| é—®é¢˜ç±»å‹     | ç¤ºä¾‹                       |
| -------- | ------------------------ |
| åŒºé—´æ±‚å’Œ     | æŸ¥è¯¢ `[i, j]` çš„å’Œ           |
| åŒºé—´æœ€å¤§/æœ€å°å€¼ | ç»´æŠ¤æŸä¸€æ®µåŒºé—´çš„æœ€å¤§/æœ€å°å€¼           |
| åŒºé—´é¢‘ç‡ç»Ÿè®¡   | æŸä¸ªæ•°å­—åœ¨åŒºé—´ä¸­å‡ºç°æ¬¡æ•°             |
| åŒºé—´æ›´æ–°     | æŠŠ `[i, j]` æ‰€æœ‰å€¼éƒ½åŠ ä¸Š xï¼ˆæ‡’æ ‡è®°ï¼‰ |
| ç¦»çº¿æŸ¥è¯¢     | åŒºé—´ç±»ç»Ÿè®¡é…åˆæ’åºä½¿ç”¨ï¼ˆå¦‚æ•°å¯¹ä¸ªæ•°ï¼‰       |

---

## ğŸ’ ä¸ƒã€è¿›é˜¶åŠŸèƒ½ï¼šæ‡’æ ‡è®°ï¼ˆLazy Propagationï¼‰

ç”¨äº **åŒºé—´ä¿®æ”¹ + åŒºé—´æŸ¥è¯¢** çš„åœºæ™¯ï¼Œé¿å…æ¯æ¬¡ä¿®æ”¹éƒ½é€’å½’åˆ°åº•ã€‚

ä¾‹å¦‚é¢˜ç›®ï¼šç»™åŒºé—´ `[l, r]` æ‰€æœ‰å€¼éƒ½åŠ ä¸Š xï¼ŒæŸ¥è¯¢ `[a, b]` çš„å’Œã€‚

### å…³é”®ç‚¹ï¼š

* ç”¨ `lazy[]` æ•°ç»„è®°å½•æ¯ä¸ªèŠ‚ç‚¹å»¶è¿Ÿä¿®æ”¹çš„å€¼
* æŸ¥è¯¢æ—¶å†ä¸‹ä¼ ä¿®æ”¹ï¼Œç¡®ä¿ç»“æœæ­£ç¡®

---

## âœ¨ å…«ã€å¸¸è§æŠ€å·§

| æŠ€å·§        | è¯´æ˜                      |
| --------- | ----------------------- |
| åŠ¨æ€å¼€ç‚¹      | å½“æ•°æ®èŒƒå›´å¤§ï¼ˆå¦‚ `1e9`ï¼‰æ—¶ï¼Œåªå¼€å¿…è¦èŠ‚ç‚¹ |
| ç¦»æ•£åŒ– + çº¿æ®µæ ‘ | ç”¨äºå¤„ç†å¤§èŒƒå›´ä½†ç¨€ç–çš„æ•°å­—é›†åˆ         |
| æ ‘çŠ¶æ•°ç»„å¯¹æ¯”    | æ ‘çŠ¶æ•°ç»„åªæ”¯æŒåŒºé—´æ±‚å’Œã€ä¸æ”¯æŒåŒºé—´æ›´æ–°     |

---

## ğŸ“Œ ä¹ã€å’Œå…¶ä»–æ•°æ®ç»“æ„æ¯”è¾ƒ

| ç‰¹æ€§               | å‰ç¼€å’Œ  | æ ‘çŠ¶æ•°ç»„     | çº¿æ®µæ ‘      |
| ---------------- | ---- | -------- | -------- |
| åŠ¨æ€ä¿®æ”¹             | âŒ    | âœ…        | âœ…        |
| åŒºé—´æŸ¥è¯¢             | âœ…    | âœ…        | âœ…        |
| åŒºé—´æ›´æ–°             | âŒ    | âŒï¼ˆéœ€æŠ€å·§ï¼‰   | âœ…        |
| æ”¯æŒè‡ªå®šä¹‰æ“ä½œï¼ˆmax/minï¼‰ | âŒ    | âŒ        | âœ…        |
| æŸ¥è¯¢æ•ˆç‡             | O(1) | O(log n) | O(log n) |

---

## âœ… åã€æ€»ç»“

| ç‰¹æ€§             | æè¿°              |
| -------------- | --------------- |
| æ”¯æŒåŒºé—´æŸ¥è¯¢ã€å•ç‚¹å’ŒåŒºé—´æ›´æ–° | âœ”ï¸              |
| æ—¶é—´å¤æ‚åº¦          | O(log n)        |
| é€‚ç”¨åœºæ™¯           | åŠ¨æ€åŒºé—´é—®é¢˜ï¼Œæ•°å€¼èŒƒå›´å¤§ä½†ç¨€ç– |
| å¿…å­¦æŠ€å·§           | æ‡’æ ‡è®°ã€ç¦»æ•£åŒ–ã€åŠ¨æ€å¼€ç‚¹    |



* any list
{:toc}