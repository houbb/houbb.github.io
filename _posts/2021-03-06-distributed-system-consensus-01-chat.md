---
layout: post
title: 分布式共识机制/一致性协议 consensus-01-一致性协议 chat
date:  2021-3-06 16:52:15 +0800
categories: [Distributed]
tags: [algorithm, distributed, consensus, java, sh]
published: true
---


# chat

## 有哪些一致性协议？

除了 **Raft** 和 **Paxos**，确实还有其他一致性协议，它们在分布式系统中起着类似的作用，确保系统的高可用性、数据一致性和容错性。

以下是一些常见的 **一致性协议**，它们各自有不同的特点和应用场景：

### 1. **ZAB (Zookeeper Atomic Broadcast)**
   - **简介**: **ZAB** 是 Zookeeper 中使用的一致性协议，用于提供高可用性的分布式系统。ZAB 协议主要是为了处理 **数据广播** 和 **领导者选举**。它保证了在 Zookeeper 中的所有节点一致地应用操作，并且提供了可靠的故障恢复机制。
   - **特点**:
     - ZAB 协议首先选举出一个 **Leader** 节点，并由 Leader 节点协调操作的顺序。
     - 当 Leader 崩溃时，ZAB 会重新进行 Leader 选举，保证系统的高可用性。
     - ZAB 在广播日志和恢复一致性时具有 **原子性**，即保证所有节点的操作顺序一致。
   - **适用场景**: Zookeeper 使用 ZAB 协议来保持高效的 **分布式协调** 和 **一致性**，特别适用于需要强一致性的分布式协调系统，如分布式锁、配置管理等。

### 2. **Viewstamped Replication (VR)**
   - **简介**: **Viewstamped Replication** 是一种分布式一致性协议，它类似于 Paxos，但有一些不同的设计。它在解决 **状态机复制** 时比 Paxos 更加高效。VR 协议的核心思想是使用 **视图**（view）来实现节点的更新和选举。
   - **特点**:
     - VR 协议中有一个 **视图管理器**，它负责维护当前视图的版本，并且协调主备节点的切换。
     - 节点在每次加入或故障时都会通过 **视图更新** 来重新选举一个 Leader。
     - 与 Paxos 相比，VR 协议提供了更简单的协议设计，减少了对网络消息的需求。
   - **适用场景**: VR 协议主要用于需要状态机复制和一致性保障的分布式系统，如数据库和分布式日志系统。

### 3. **Quorum-based Replication**
   - **简介**: **Quorum-based Replication** 是一种简单的基于 **多数投票（quorum）** 的一致性协议。它通常用于分布式数据库和存储系统中，依赖于多个节点之间的一致性投票来保证数据一致性。
   - **特点**:
     - 在 Quorum 协议中，节点分为多个组，每个组的大小是动态的，通常会定义一个 "写 Quorum" 和 "读 Quorum"。
     - **写操作**：只有在一定数量的节点（写 Quorum）确认后，才会提交写操作。
     - **读操作**：读取时，需要从一定数量的节点（读 Quorum）获取数据，以保证读取的是最新的。
     - 该协议相对简单，但在某些情况下可能会降低性能，特别是在高并发的系统中。
   - **适用场景**: 主要用于分布式数据库和存储系统，如 Cassandra、Riak 等，能够保证强一致性和容错性。

### 4. **EPaxos (Egalitarian Paxos)**
   - **简介**: **EPaxos** 是 **Paxos** 的一种扩展，旨在提高多主副本架构中的一致性。与传统的 Paxos 协议不同，EPaxos 允许多个节点并行处理请求，这对于高可用性和高性能系统非常重要。
   - **特点**:
     - 允许多个节点同时进行操作，无需先获得 Leader 节点的许可。
     - 在操作的并行化方面，EPaxos 相比 Paxos 更高效，尤其是在多主模式下。
     - 它通过保证 **多主一致性**，减少了 **瓶颈效应**，使得分布式系统可以更高效地处理并发请求。
   - **适用场景**: 适用于 **高并发** 的分布式系统，尤其是要求较高的 **吞吐量** 和 **低延迟** 的应用场景，如分布式数据库、消息队列等。

### 5. **VRRP (Virtual Router Redundancy Protocol)**
   - **简介**: **VRRP** 主要用于实现 **虚拟路由器冗余协议**，它在分布式系统中并不直接用于一致性，但提供了节点 **故障切换** 和 **冗余** 的机制，确保系统的 **高可用性**。
   - **特点**:
     - 主要用于网络路由器的冗余和故障切换，确保网络中存在的虚拟路由器始终能够正常工作。
     - 在 VRRP 协议中，多个路由器共享同一个虚拟 IP 地址，并且通过选举机制来选定一个路由器作为主路由器。
   - **适用场景**: 主要用于网络设备和 **高可用性** 的场景，而不是直接用于分布式数据一致性。

### 6. **CRDTs (Conflict-free Replicated Data Types)**
   - **简介**: **CRDT** 是一种不依赖传统一致性协议（如 Paxos 和 Raft）来保持一致性的分布式数据结构。CRDTs 允许分布式系统中的节点 **独立更新** 数据，并且能够通过合并不同节点的数据来解决冲突。
   - **特点**:
     - **无冲突**：CRDTs 设计上是冲突无关的，能够自动解决分布式节点之间的数据冲突。
     - 可以处理 **最终一致性**，不需要强一致性保障，适用于高可用性和低延迟的应用。
     - 常见的 CRDT 类型包括 **计数器、集合、映射** 等。
   - **适用场景**: 适用于需要 **最终一致性** 的分布式应用，如 **分布式缓存、实时协作工具**、 **社交媒体系统** 等。

### 7. **Two-Phase Commit (2PC)**
   - **简介**: **两阶段提交协议 (2PC)** 是一种经典的分布式一致性协议，用于确保分布式事务的一致性。它通常在 **分布式数据库** 和 **分布式事务系统** 中使用，以确保所有参与者都能在提交事务前达成一致。
   - **特点**:
     - **准备阶段**：协调者询问所有参与者是否可以提交事务。
     - **提交阶段**：所有参与者确认提交事务或取消事务。
     - 2PC 确保了 **原子性** 和 **一致性**，但是当出现 **协调者崩溃** 时，系统可能会处于不一致状态。
   - **适用场景**: 适用于分布式事务管理，尤其是在要求原子性和一致性的系统中，如银行系统、支付系统等。

### 总结
除了 **Raft** 和 **Paxos**，这些一致性协议也广泛应用于分布式系统中，针对不同的场景和需求提供了不同的方案：
- **ZAB** 和 **Viewstamped Replication** 都是更侧重于状态机复制和协调服务的协议，适用于分布式系统中的高可用性要求。
- **Quorum-based Replication** 和 **CRDTs** 提供了不同层次的一致性保障，前者侧重于读写操作的协调，后者则强调冲突解决和最终一致性。
- **EPaxos** 是 Paxos 的高效扩展，适用于高并发系统。
- **Two-Phase Commit** 适合分布式事务场景。

选择合适的一致性协议通常依赖于 **应用场景**（如强一致性 vs. 最终一致性）、**容忍延迟**、**容错需求** 等因素。

## 其他

除了之前提到的 **Raft**、**Paxos**、**ZAB**、**Viewstamped Replication (VR)**、**Quorum-based Replication**、**EPaxos**、**CRDTs** 和 **Two-Phase Commit (2PC)**，还有其他几种分布式一致性协议，尽管它们在应用中相对较少，但仍然具有独特的设计思想和应用场景。以下是一些其他的分布式一致性协议：

### 1. **Three-Phase Commit (3PC)**
   - **简介**: **三阶段提交协议 (3PC)** 是一种对 **两阶段提交协议 (2PC)** 的改进。2PC 存在的问题是，在协调者崩溃的情况下，参与者会进入不一致的状态。3PC 引入了一个额外的阶段来保证在协调者故障的情况下，系统能够更早地做出决策，减少等待时间，从而避免不一致的状态。
   - **特点**:
     - 与 2PC 不同，3PC 增加了一个 **准备阶段** 来确认所有参与者都已准备好提交事务。
     - **准备阶段**：所有参与者确认是否可以提交事务。
     - **提交阶段**：协调者决定是否提交事务。
     - 3PC 增加了一个 **完成阶段**，如果协调者崩溃，参与者能够通过这个阶段进行恢复。
   - **适用场景**: 3PC 主要用于分布式事务，尤其在要求高可用性的情况下比 2PC 更有优势，但它仍然没有完全解决协调者崩溃后的问题。

### 2. **Chain Replication**
   - **简介**: **链式复制 (Chain Replication)** 是一种用于高可用和强一致性的分布式一致性协议。它通过将多个节点组织成一个链状结构，使得每个写操作都通过链中的节点进行顺序传递，确保所有节点都能够看到相同的写入。
   - **特点**:
     - 写操作必须依次通过链中的所有节点，从 **头节点** 到 **尾节点**。
     - 读操作则从尾节点读取数据，保证数据的一致性。
     - Chain Replication 的写操作具有 **严格的顺序一致性**，并确保每个写入操作都会被所有节点按顺序处理。
   - **适用场景**: 适用于需要 **强一致性** 和 **顺序一致性** 的分布式数据存储，如日志系统、分布式文件系统等。

### 3. **Gossip Protocol**
   - **简介**: **Gossip 协议**（也称为 **传播协议**）是一种在分布式系统中用于信息传播和一致性保障的协议。它通过节点之间的随机通信将信息传播到整个系统中，类似于现实中的 **口耳相传**。
   - **特点**:
     - 各个节点周期性地向其他节点发送更新，逐步将数据同步到所有节点。
     - Gossip 协议能够 **容忍节点故障**，因为每个节点在多个不同节点之间进行通信，最终可以达到一致。
     - 主要用于 **最终一致性** 的场景，在系统容忍一定的不一致性延迟的情况下非常有效。
   - **适用场景**: 适用于 **最终一致性** 的系统，如 **分布式数据库**（Cassandra、Riak）、**分布式缓存** 等。

### 4. **MVP (Multi-Version Concurrency Control)**
   - **简介**: **多版本并发控制（MVP）** 是一种用于分布式数据库和存储系统中的一致性协议，旨在控制并发事务对数据的访问。它允许系统在同一时刻保存多个版本的对象，以支持高并发的读写操作。
   - **特点**:
     - 通过保存多个数据版本，允许多个事务并行执行，而不会产生冲突。
     - 每个事务访问和修改的数据是一个 **快照**（snapshot），从而避免了阻塞。
     - 适用于需要 **高并发** 的应用，同时支持 **一致性** 的读写操作。
   - **适用场景**: 多版本控制常用于 **分布式数据库** 和 **事务系统**，如 **Amazon DynamoDB**、**Google Spanner** 等。

### 5. **BFT (Byzantine Fault Tolerance)**
   - **简介**: **拜占庭容错协议（BFT）** 解决了拜占庭将军问题，确保分布式系统在部分节点遭到恶意攻击或不可靠的情况下依然能够正常运行。BFT 协议特别强调在节点故障或恶意行为的情况下，如何保持一致性和正确性。
   - **特点**:
     - BFT 协议能够容忍最多 **f** 个节点故障，其中 **f** 为系统总节点数的三分之一。
     - 即使存在恶意节点，协议仍能保证 **正确性** 和 **一致性**，因此特别适合于 **去中心化** 系统，如区块链。
   - **适用场景**: BFT 协议广泛用于 **区块链** 技术（如 **PBFT**）、**去中心化** 系统和 **金融系统**，特别是在需要保证系统在恶意节点存在时仍能保证一致性的场景。

### 6. **Sharding and Distributed Consensus**
   - **简介**: **分片（Sharding）** 和 **分布式共识协议** 结合使用，用于将数据分布到不同的节点或分片中，并确保各个分片之间的 **一致性**。每个分片可以独立运行，共享全局一致性。
   - **特点**:
     - 每个分片通常使用自己的分布式一致性协议（如 Raft、Paxos）来保证局部一致性。
     - 通过 **全局共识** 来保证跨分片操作的一致性。
   - **适用场景**: 适用于 **大规模数据库系统** 和 **分布式存储系统**，如 **Google Spanner** 和 **MongoDB**，用于支持 **水平扩展** 和 **高可用性**。

### 7. **Chain-Replicated State Machine (CRSM)**
   - **简介**: **链式复制状态机（CRSM）** 是一种结合了链式复制和状态机复制的协议。它通过将多个副本节点组织成链式结构，确保所有节点按照特定顺序应用操作，从而保证数据一致性。
   - **特点**:
     - 每个节点处理所有请求，操作的顺序由链中的前后节点协调，确保没有任何操作被遗漏或发生冲突。
     - 强调 **状态机一致性** 和 **顺序一致性**，适用于需要保证操作顺序的场景。
   - **适用场景**: 常用于 **分布式事务管理** 和 **分布式日志系统**，例如，适用于 **高一致性要求** 的系统。

### 总结：
除了常见的 **Raft**、**Paxos**、**ZAB** 等协议，还有许多其他的分布式一致性协议，如 **三阶段提交（3PC）**、**链式复制（Chain Replication）**、**Gossip 协议**、**拜占庭容错（BFT）** 等。这些协议有各自的优势和应用场景，适合解决不同类型的分布式一致性问题，尤其是在高可用性、容错性以及强一致性和最终一致性等要求下。

选择合适的一致性协议时，通常需要根据系统的 **容错能力**、**性能需求**、**一致性要求** 和 **扩展性** 来做出决策。



# 参考资料

[分布式共识(Consensus)：Viewstamped Replication、Raft以及Paxos](http://blog.kongfy.com/2016/05/%E5%88%86%E5%B8%83%E5%BC%8F%E5%85%B1%E8%AF%86consensus%EF%BC%9Aviewstamped%E3%80%81raft%E5%8F%8Apaxos/)

https://nan01ab.github.io/2017/08/Viewstamped-Replication.html

https://github.com/coilhq/viewstamped-replication-made-famous

[《ViewStamped replication revisited》解读](https://zhuanlan.zhihu.com/p/66984202)

* any list
{:toc}