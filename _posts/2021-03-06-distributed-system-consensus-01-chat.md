---
layout: post
title: 分布式共识机制/一致性协议 consensus-01-一致性协议 chat
date:  2021-3-06 16:52:15 +0800
categories: [Distributed]
tags: [algorithm, distributed, consensus, java, sh]
published: true
---


# chat

## 有哪些一致性协议？

除了 Raft 和 Paxos，确实还有其他一致性协议，它们在分布式系统中起着类似的作用，确保系统的高可用性、数据一致性和容错性。

以下是一些常见的 一致性协议，它们各自有不同的特点和应用场景：

### 1. ZAB (Zookeeper Atomic Broadcast)
   - 简介: ZAB 是 Zookeeper 中使用的一致性协议，用于提供高可用性的分布式系统。ZAB 协议主要是为了处理 数据广播 和 领导者选举。它保证了在 Zookeeper 中的所有节点一致地应用操作，并且提供了可靠的故障恢复机制。
   - 特点:
     - ZAB 协议首先选举出一个 Leader 节点，并由 Leader 节点协调操作的顺序。
     - 当 Leader 崩溃时，ZAB 会重新进行 Leader 选举，保证系统的高可用性。
     - ZAB 在广播日志和恢复一致性时具有 原子性，即保证所有节点的操作顺序一致。
   - 适用场景: Zookeeper 使用 ZAB 协议来保持高效的 分布式协调 和 一致性，特别适用于需要强一致性的分布式协调系统，如分布式锁、配置管理等。

### 2. Viewstamped Replication (VR)
   - 简介: Viewstamped Replication 是一种分布式一致性协议，它类似于 Paxos，但有一些不同的设计。它在解决 状态机复制 时比 Paxos 更加高效。VR 协议的核心思想是使用 视图（view）来实现节点的更新和选举。
   - 特点:
     - VR 协议中有一个 视图管理器，它负责维护当前视图的版本，并且协调主备节点的切换。
     - 节点在每次加入或故障时都会通过 视图更新 来重新选举一个 Leader。
     - 与 Paxos 相比，VR 协议提供了更简单的协议设计，减少了对网络消息的需求。
   - 适用场景: VR 协议主要用于需要状态机复制和一致性保障的分布式系统，如数据库和分布式日志系统。

### 3. Quorum-based Replication
   - 简介: Quorum-based Replication 是一种简单的基于 多数投票（quorum） 的一致性协议。它通常用于分布式数据库和存储系统中，依赖于多个节点之间的一致性投票来保证数据一致性。
   - 特点:
     - 在 Quorum 协议中，节点分为多个组，每个组的大小是动态的，通常会定义一个 "写 Quorum" 和 "读 Quorum"。
     - 写操作：只有在一定数量的节点（写 Quorum）确认后，才会提交写操作。
     - 读操作：读取时，需要从一定数量的节点（读 Quorum）获取数据，以保证读取的是最新的。
     - 该协议相对简单，但在某些情况下可能会降低性能，特别是在高并发的系统中。
   - 适用场景: 主要用于分布式数据库和存储系统，如 Cassandra、Riak 等，能够保证强一致性和容错性。

### 4. EPaxos (Egalitarian Paxos)
   - 简介: EPaxos 是 Paxos 的一种扩展，旨在提高多主副本架构中的一致性。与传统的 Paxos 协议不同，EPaxos 允许多个节点并行处理请求，这对于高可用性和高性能系统非常重要。
   - 特点:
     - 允许多个节点同时进行操作，无需先获得 Leader 节点的许可。
     - 在操作的并行化方面，EPaxos 相比 Paxos 更高效，尤其是在多主模式下。
     - 它通过保证 多主一致性，减少了 瓶颈效应，使得分布式系统可以更高效地处理并发请求。
   - 适用场景: 适用于 高并发 的分布式系统，尤其是要求较高的 吞吐量 和 低延迟 的应用场景，如分布式数据库、消息队列等。

### 5. VRRP (Virtual Router Redundancy Protocol)
   - 简介: VRRP 主要用于实现 虚拟路由器冗余协议，它在分布式系统中并不直接用于一致性，但提供了节点 故障切换 和 冗余 的机制，确保系统的 高可用性。
   - 特点:
     - 主要用于网络路由器的冗余和故障切换，确保网络中存在的虚拟路由器始终能够正常工作。
     - 在 VRRP 协议中，多个路由器共享同一个虚拟 IP 地址，并且通过选举机制来选定一个路由器作为主路由器。
   - 适用场景: 主要用于网络设备和 高可用性 的场景，而不是直接用于分布式数据一致性。

### 6. CRDTs (Conflict-free Replicated Data Types)
   - 简介: CRDT 是一种不依赖传统一致性协议（如 Paxos 和 Raft）来保持一致性的分布式数据结构。CRDTs 允许分布式系统中的节点 独立更新 数据，并且能够通过合并不同节点的数据来解决冲突。
   - 特点:
     - 无冲突：CRDTs 设计上是冲突无关的，能够自动解决分布式节点之间的数据冲突。
     - 可以处理 最终一致性，不需要强一致性保障，适用于高可用性和低延迟的应用。
     - 常见的 CRDT 类型包括 计数器、集合、映射 等。
   - 适用场景: 适用于需要 最终一致性 的分布式应用，如 分布式缓存、实时协作工具、 社交媒体系统 等。

### 7. Two-Phase Commit (2PC)
   - 简介: 两阶段提交协议 (2PC) 是一种经典的分布式一致性协议，用于确保分布式事务的一致性。它通常在 分布式数据库 和 分布式事务系统 中使用，以确保所有参与者都能在提交事务前达成一致。
   - 特点:
     - 准备阶段：协调者询问所有参与者是否可以提交事务。
     - 提交阶段：所有参与者确认提交事务或取消事务。
     - 2PC 确保了 原子性 和 一致性，但是当出现 协调者崩溃 时，系统可能会处于不一致状态。
   - 适用场景: 适用于分布式事务管理，尤其是在要求原子性和一致性的系统中，如银行系统、支付系统等。

### 总结
除了 Raft 和 Paxos，这些一致性协议也广泛应用于分布式系统中，针对不同的场景和需求提供了不同的方案：
- ZAB 和 Viewstamped Replication 都是更侧重于状态机复制和协调服务的协议，适用于分布式系统中的高可用性要求。
- Quorum-based Replication 和 CRDTs 提供了不同层次的一致性保障，前者侧重于读写操作的协调，后者则强调冲突解决和最终一致性。
- EPaxos 是 Paxos 的高效扩展，适用于高并发系统。
- Two-Phase Commit 适合分布式事务场景。

选择合适的一致性协议通常依赖于 应用场景（如强一致性 vs. 最终一致性）、容忍延迟、容错需求 等因素。

## 其他

除了之前提到的 Raft、Paxos、ZAB、Viewstamped Replication (VR)、Quorum-based Replication、EPaxos、CRDTs 和 Two-Phase Commit (2PC)，还有其他几种分布式一致性协议，尽管它们在应用中相对较少，但仍然具有独特的设计思想和应用场景。以下是一些其他的分布式一致性协议：

### 1. Three-Phase Commit (3PC)
   - 简介: 三阶段提交协议 (3PC) 是一种对 两阶段提交协议 (2PC) 的改进。2PC 存在的问题是，在协调者崩溃的情况下，参与者会进入不一致的状态。3PC 引入了一个额外的阶段来保证在协调者故障的情况下，系统能够更早地做出决策，减少等待时间，从而避免不一致的状态。
   - 特点:
     - 与 2PC 不同，3PC 增加了一个 准备阶段 来确认所有参与者都已准备好提交事务。
     - 准备阶段：所有参与者确认是否可以提交事务。
     - 提交阶段：协调者决定是否提交事务。
     - 3PC 增加了一个 完成阶段，如果协调者崩溃，参与者能够通过这个阶段进行恢复。
   - 适用场景: 3PC 主要用于分布式事务，尤其在要求高可用性的情况下比 2PC 更有优势，但它仍然没有完全解决协调者崩溃后的问题。

### 2. Chain Replication
   - 简介: 链式复制 (Chain Replication) 是一种用于高可用和强一致性的分布式一致性协议。它通过将多个节点组织成一个链状结构，使得每个写操作都通过链中的节点进行顺序传递，确保所有节点都能够看到相同的写入。
   - 特点:
     - 写操作必须依次通过链中的所有节点，从 头节点 到 尾节点。
     - 读操作则从尾节点读取数据，保证数据的一致性。
     - Chain Replication 的写操作具有 严格的顺序一致性，并确保每个写入操作都会被所有节点按顺序处理。
   - 适用场景: 适用于需要 强一致性 和 顺序一致性 的分布式数据存储，如日志系统、分布式文件系统等。

### 3. Gossip Protocol
   - 简介: Gossip 协议（也称为 传播协议）是一种在分布式系统中用于信息传播和一致性保障的协议。它通过节点之间的随机通信将信息传播到整个系统中，类似于现实中的 口耳相传。
   - 特点:
     - 各个节点周期性地向其他节点发送更新，逐步将数据同步到所有节点。
     - Gossip 协议能够 容忍节点故障，因为每个节点在多个不同节点之间进行通信，最终可以达到一致。
     - 主要用于 最终一致性 的场景，在系统容忍一定的不一致性延迟的情况下非常有效。
   - 适用场景: 适用于 最终一致性 的系统，如 分布式数据库（Cassandra、Riak）、分布式缓存 等。

### 4. MVP (Multi-Version Concurrency Control)
   - 简介: 多版本并发控制（MVP） 是一种用于分布式数据库和存储系统中的一致性协议，旨在控制并发事务对数据的访问。它允许系统在同一时刻保存多个版本的对象，以支持高并发的读写操作。
   - 特点:
     - 通过保存多个数据版本，允许多个事务并行执行，而不会产生冲突。
     - 每个事务访问和修改的数据是一个 快照（snapshot），从而避免了阻塞。
     - 适用于需要 高并发 的应用，同时支持 一致性 的读写操作。
   - 适用场景: 多版本控制常用于 分布式数据库 和 事务系统，如 Amazon DynamoDB、Google Spanner 等。

### 5. BFT (Byzantine Fault Tolerance)
   - 简介: 拜占庭容错协议（BFT） 解决了拜占庭将军问题，确保分布式系统在部分节点遭到恶意攻击或不可靠的情况下依然能够正常运行。BFT 协议特别强调在节点故障或恶意行为的情况下，如何保持一致性和正确性。
   - 特点:
     - BFT 协议能够容忍最多 f 个节点故障，其中 f 为系统总节点数的三分之一。
     - 即使存在恶意节点，协议仍能保证 正确性 和 一致性，因此特别适合于 去中心化 系统，如区块链。
   - 适用场景: BFT 协议广泛用于 区块链 技术（如 PBFT）、去中心化 系统和 金融系统，特别是在需要保证系统在恶意节点存在时仍能保证一致性的场景。

### 6. Sharding and Distributed Consensus
   - 简介: 分片（Sharding） 和 分布式共识协议 结合使用，用于将数据分布到不同的节点或分片中，并确保各个分片之间的 一致性。每个分片可以独立运行，共享全局一致性。
   - 特点:
     - 每个分片通常使用自己的分布式一致性协议（如 Raft、Paxos）来保证局部一致性。
     - 通过 全局共识 来保证跨分片操作的一致性。
   - 适用场景: 适用于 大规模数据库系统 和 分布式存储系统，如 Google Spanner 和 MongoDB，用于支持 水平扩展 和 高可用性。

### 7. Chain-Replicated State Machine (CRSM)
   - 简介: 链式复制状态机（CRSM） 是一种结合了链式复制和状态机复制的协议。它通过将多个副本节点组织成链式结构，确保所有节点按照特定顺序应用操作，从而保证数据一致性。
   - 特点:
     - 每个节点处理所有请求，操作的顺序由链中的前后节点协调，确保没有任何操作被遗漏或发生冲突。
     - 强调 状态机一致性 和 顺序一致性，适用于需要保证操作顺序的场景。
   - 适用场景: 常用于 分布式事务管理 和 分布式日志系统，例如，适用于 高一致性要求 的系统。

### 总结：
除了常见的 Raft、Paxos、ZAB 等协议，还有许多其他的分布式一致性协议，如 三阶段提交（3PC）、链式复制（Chain Replication）、Gossip 协议、拜占庭容错（BFT） 等。这些协议有各自的优势和应用场景，适合解决不同类型的分布式一致性问题，尤其是在高可用性、容错性以及强一致性和最终一致性等要求下。

选择合适的一致性协议时，通常需要根据系统的 容错能力、性能需求、一致性要求 和 扩展性 来做出决策。

## 还有其他的吗?

当然，除了上述协议，还有一些其他在分布式系统中常见的协议和技术。这里列举了一些重要的分布式协议，它们解决了不同类型的问题，如一致性、容错、事务管理等。以下是更多的分布式协议和技术：

###  Leaderless Replication
- 目的：Leaderless Replication 协议是为了避免领导者节点成为瓶颈而提出的一个协议，它允许多个节点同时处理客户端的读写请求，而不依赖单一的领导者。
- 工作原理：
  - 每个写操作都在多个副本上并行执行，没有固定的领导者节点。系统通过 Quorum 的方式确保操作的一致性，即在足够多的副本节点上确认操作。
  - 通过对每个节点的操作进行版本控制和冲突解决，Leaderless Replication 能够处理并发操作和容错问题。
- 应用：这类协议通常应用于一些需要高可用性和容错性的系统，如 Cassandra 和 Amazon Dynamo。它们适用于对一致性要求不高，但需要高可用性和可扩展性的应用场景。

### Semantic Diff (Conflict Resolution)
- 目的：语义差异冲突解决协议（Semantic Diff）用于解决多个副本间数据更新时的冲突，特别是在 CRDTs 中，解决并发修改时的冲突问题。
- 工作原理：
  - 语义差异通过比较操作的意图和影响来确定最合适的操作。与传统的版本冲突解决（如 Last Write Wins）不同，Semantic Diff 尝试理解操作的语义，并根据上下文来合并不同副本的数据。
  - 这通常涉及一些高级数据结构，如 自适应树结构、版本化集合 或 版本向量 等。
- 应用：这种技术广泛用于一些需要高并发且要求最终一致性的系统，如 分布式文本编辑器 或 协作式应用程序。

### Chain-of-Authority (CoA)

- 目的：Chain-of-Authority 是一种分布式共识协议，特别用于基于区块链的分布式系统中，确保节点通过特定的认证链对操作进行验证。
- 工作原理：
  - 在 CoA 协议中，节点按一定的顺序形成一个链条，每个节点都有一个 数字签名 或 认证 机制，确保操作的合法性。
  - 每个节点只有在得到前一个节点认证的情况下，才能执行操作。这种链式认证机制保证了系统中的数据一致性和安全性。
- 应用：这种协议多用于基于区块链的系统中，如 Hyperledger 或 Fabric，以及需要高信任的分布式认证和操作验证场景。

### Lamport 时间戳

- 目的：Lamport 时间戳是一种用于分布式系统中事件排序的技术，确保操作的先后顺序。
- 工作原理：
  - 每个节点在处理事件时会生成一个时间戳，该时间戳基于本地时钟并通过 消息传递 进行同步。节点根据收到的消息的时间戳来调整自己的时钟。
  - 当两个事件发生在不同节点时，Lamport 时间戳保证通过比较时间戳来确定事件的顺序。
- 应用：广泛应用于分布式系统中的事件排序、日志记录、并发控制等场景，如 分布式数据库 和 分布式文件系统。

### Anti-Entropy

- 目的：Anti-Entropy 协议是一种用于保证分布式系统中节点数据一致性的协议，通过周期性地同步数据来解决节点之间的分歧。
- 工作原理：
  - 在 Anti-Entropy 协议中，系统中的每个节点会定期与其他节点交换其数据或状态。通过这种方式，节点可以逐步消除数据之间的差异，最终保证数据一致性。
  - 通常，使用 Merkle Tree 来高效比较和同步数据。每个节点维护自己的哈希树，周期性地与其他节点进行哈希对比，交换数据块。
- 应用：广泛应用于分布式存储系统，如 Amazon Dynamo 和 Riak，确保系统中数据副本的一致性。

### Paxos的变种：EPaxos 和 Multi-Paxos

- 目的：EPaxos（Egalitarian Paxos）和 Multi-Paxos 是对标准 Paxos 协议的扩展，旨在提高在高并发环境下的性能。
  - EPaxos：它改进了传统的 Paxos 协议，允许在多个操作同时进行时达到更高的吞吐量，并能够在无全局领导者的情况下进行共识。
  - Multi-Paxos：在单一领导者的情况下扩展 Paxos，使得多个操作可以在同一个领导者下按顺序执行，避免每个操作都重新进行领导者选举。
- 工作原理：
  - EPaxos 通过将不同的操作分配给不同的节点进行执行，避免了单个领导者的瓶颈。
  - Multi-Paxos 通过维持一个长期的领导者角色，减少领导者选举的频率，提高了多操作的吞吐量。
- 应用：EPaxos 和 Multi-Paxos 在需要高吞吐量和低延迟的分布式系统中广泛应用，尤其是在 数据库 和 分布式日志 系统中。

### Merkle Tree

- 目的：Merkle 树用于高效地验证和同步分布式系统中的数据，确保数据的完整性。
- 工作原理：
  - Merkle 树是一种 哈希树，叶子节点存储数据项的哈希值，内部节点存储其子节点哈希值。通过根哈希值，节点可以有效地验证数据是否一致。
  - 在分布式系统中，Merkle 树常用于确保节点间数据的完整性和一致性。
- 应用：广泛应用于 区块链、分布式文件系统 和 数据同步系统。

### 总结

以上列出了更多的分布式协议，这些协议解决了分布式系统中不同层面的问题，如一致性、容错、并发控制、事务管理等。每个协议有其适用场景和优缺点，因此在设计分布式系统时，选择合适的协议非常关键。


# 参考资料

[分布式共识(Consensus)：Viewstamped Replication、Raft以及Paxos](http://blog.kongfy.com/2016/05/%E5%88%86%E5%B8%83%E5%BC%8F%E5%85%B1%E8%AF%86consensus%EF%BC%9Aviewstamped%E3%80%81raft%E5%8F%8Apaxos/)

https://nan01ab.github.io/2017/08/Viewstamped-Replication.html

https://github.com/coilhq/viewstamped-replication-made-famous

[《ViewStamped replication revisited》解读](https://zhuanlan.zhihu.com/p/66984202)

* any list
{:toc}