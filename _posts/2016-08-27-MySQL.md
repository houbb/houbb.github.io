---
layout: post
title: MySQL
date: 2016-8-27 10:26:23 +0800
categories: [SQL]
tags: [mysql]
published: true
---
* any list
{:toc}

# MySQL

> [MySQL](https://www.mysql.com)

> [zh_CN](http://c.biancheng.net/cpp/html/1456.html)

# Date Type

## Date & time

- timestamp

```sql
CREATE TABLE test(
`create_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
COMMENT '创建时，默认为系统当前时间。以后不再刷新',

`update_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
COMMENT '创建/修改时刷新时间，同TIMESTAMP'
)ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='test';
```


# Index

The max limit number of mysql index is —— 16

## Index not work case

- ```!=``` or ```<>```

- use fun();

- JOIN, only use index when primary key has the same type with foreign key;

- LIKE, REGEX only use index when first char is not wildcard.

```sql
like '%abc'   ×
like 'abc%'   √
```

- ORDER BY: only use when the where condition is not a expression. It's not works well when has multi-table.

- index not works well when one column has many the same value, like (0/1), (y/n)

## Full-Text index

> [full-text](http://www.cnblogs.com/mguo/archive/2013/04/16/3023610.html)

The most time consuming sql may like this:

```sql
SELECT * FROM `table_name` WHERE `column_name` LIKE '%word%'
```

- create full-text

```sql
CREATE TABLE full_text(
  `id` BIGINT(20) NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(64) NOT NULL COMMENT '名称',
  `info` VARCHAR(128) NULL DEFAULT '' COMMENT '信息',
  PRIMARY KEY (`id`),
  FULLTEXT (`name`, `info`) COMMENT '添加全文索引'
) COMMENT = '全文检索' ENGINE = MyISAM;

INSERT INTO full_text (name, info) VALUES
  ('mark the word', 'you can mark the word'),
  ('kill the word', 'you can kill the word'),
  ('like the word', 'you can like the word'),
  ('miss the word', 'you can miss the word'),
  ('think the word', 'you can think the word');
```

- query

```
SELECT * FROM full_text WHERE MATCH(`name`, `info`) AGAINST ('think like mark') > 0.0001;
SELECT * FROM full_text WHERE MATCH(`name`, `info`) AGAINST ('you word miss') > 0.0001;
```


# Stored Procedure & Trigger    (5.0+)

> Stored Procedure

- define

```sql
DROP FUNCTION IF EXISTS shortLen;

CREATE FUNCTION shortLen(s VARCHAR(255), n INT)
  RETURNS VARCHAR(255)
  BEGIN
    IF ISNULL(s)
    THEN
      RETURN '';
    ELSEIF n < 15
      THEN
        RETURN LEFT(s, n);
    ELSE
      IF CHAR_LENGTH(s) <= n
      THEN
        RETURN s;
      ELSE
        RETURN CONCAT(LEFT(s, n - 10), '...', RIGHT(s, 5));
      END IF;
    END IF;
  END;
```

- use

```sql
SELECT shortLen('asdfasdfasdfasdfasfdasdgasdgfadghfgdhfgjghj', 15);
```

- result

```
asdfa...gjghj
```

- show functions

```sql
SHOW FUNCTION STATUS;

SHOW CREATE FUNCTION shortLen;
```

# Manage & Server Config

## Log

> [slow log](http://www.cnblogs.com/kerrycode/p/5593204.html)

> [slow log tool](http://unixlzx.blog.163.com/blog/static/10277375220136231545718/)

> [log with ui](http://www.ttlsa.com/mysql/mysql-slow-query-log-analysis-and-visualization-of-results/)

















