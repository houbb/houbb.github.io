---
layout: post
title: 监控报警系统-10-监控系统应该关注哪些指标？USE、RED、黄金四象限（Four Golden Signals）的思维模型
date:  2021-06-20 16:52:15 +0800
categories: [APM]
tags: [apm, system-design]
published: true
---

# chat

## 这3种方法论最底层的思维是什么？

这3种方法论（**黄金四象限、RED、USE**）的底层思维本质上是**通过分层抽象和量化指标，将复杂系统的健康状态简化为可观测、可行动的通用模型**。

它们的核心逻辑可以从以下三个维度拆解：

---

### **1. 分治思维：分层抽象，缩小问题域**
所有监控方法论的本质是**将复杂系统分解为可管理的层级**，避免“眉毛胡子一把抓”的混乱：
- **黄金四象限**：覆盖全栈监控，从**用户侧体验**（延迟、错误）到**系统资源**（流量、饱和度），形成端到端的视角。
- **RED方法**：专注**服务层**（API、微服务），以请求处理流程为核心，忽略底层硬件细节。
- **USE方法**：聚焦**资源层**（CPU、磁盘、网络），抽象掉业务逻辑，直接观察物理或虚拟资源的负载状态。  


**底层逻辑**：复杂系统的问题可能出现在任何层级，但通过分层抽象（服务层→资源层→用户体验层），可以快速缩小排查范围。

例如，服务延迟（RED的Duration）升高时，若资源层的CPU饱和度（USE的Saturation）正常，则问题可能出现在代码或依赖服务上。

---

### **2. 瓶颈思维：识别关键限制因素**
所有方法的核心目标是**找到系统的瓶颈**（Bottleneck），即对性能或稳定性影响最大的关键因素：
- **黄金四象限**的“饱和度”：直接指向资源瓶颈（如CPU过载、磁盘IO争用）。
- **RED方法**的“错误率”：暴露服务逻辑或依赖服务的瓶颈（如数据库超时）。
- **USE方法**的“使用率与饱和度”：量化资源瓶颈的严重程度（如内存使用率95%+队列积压）。


**底层逻辑**：系统性能受限于最弱的环节（木桶理论）。

例如，若数据库连接池（USE的饱和度）耗尽，即使应用服务器CPU空闲（USE的使用率低），整个服务仍可能因无法处理请求而崩溃（RED的错误率飙升）。

---

### **3. 量化思维：用数据驱动决策**
三大方法论均强调**指标的客观性、可测量性和可对比性**，避免主观臆断：
- **黄金四象限**：用延迟的百分位数（如P99）、错误率的绝对值（如5xx数量）量化用户体验。
- **RED方法**：通过请求速率（Rate）的时序数据，判断流量是否异常（如突降可能代表服务宕机）。
- **USE方法**：将硬件状态转化为数值（如CPU使用率80%），支持阈值告警和趋势预测。  

**底层逻辑**：只有将系统状态**量化**为统一语言（如“错误率0.5%”），才能实现跨团队的高效协作。

例如，开发团队（关注RED）和运维团队（关注USE）可通过共享指标（如数据库查询延迟）协同优化。

---

### **4. 问题导向：从现象到根因的推导链**
所有方法都遵循 **“现象→假设→验证”** 的根因分析路径：
- **黄金四象限**：用户投诉延迟高（现象）→ 检查饱和度（假设资源瓶颈）→ 发现磁盘IO队列积压（验证）。
- **RED方法**：错误率突增（现象）→ 假设是依赖服务故障→ 通过追踪链路验证下游服务超时。
- **USE方法**：CPU使用率低但饱和度（load average）高（现象）→ 假设是I/O等待（iowait）导致→ 用`iostat`验证磁盘瓶颈。  

**底层逻辑**：通过指标间的关联性构建推理链条。

例如，高流量（黄金四象限的Traffic）可能导致服务错误率（RED的Errors）上升，而错误可能由资源饱和（USE的Saturation）引起。

---

### **5. 预防性思维：从被动救火到主动防御**
方法论的设计隐含了**提前发现隐患**的目标：
- **黄金四象限的饱和度**：在资源耗尽前触发扩容。
- **RED的持续时间（Duration）** ：通过基线对比（如本周 vs 上周）发现性能劣化趋势。
- **USE的错误计数**：监控磁盘SMART错误，在硬件彻底故障前更换设备。  

**底层逻辑**：将监控从“故障报警”升级为“风险预警”。

例如，当内存使用率（USE）持续增长时，即使未达到阈值，也可提前分析是否存在内存泄漏。

---

### **总结：三大方法论的统一思维模型**
它们的底层逻辑可以归纳为以下公式：  
**健康系统 = 分层抽象（分治） + 瓶颈量化（数据） + 根因推导（逻辑） + 风险预防（预测）**  

#### **实际应用建议**：
1. **分层覆盖**：用USE监控基础设施（如Kubernetes节点）、RED监控服务（如微服务）、黄金四象限补充全局视角。
2. **指标联动**：当RED的延迟（Duration）异常时，联动检查USE的饱和度（如CPU load）。
3. **工具整合**：Prometheus采集USE指标（如`node_cpu_seconds_total`），Grafana仪表盘同时展示RED（请求速率）和USE（CPU饱和度）。  
通过融合这些底层思维，可以构建从代码到硬件的完整可观测性体系，最终实现 **“快速定位问题，最小化业务影响”** 的目标。

# 参考资料




* any list
{:toc}