---
layout: post
title:  ACP 学习-07-CDN 
date:  2020-7-19 16:40:20 +0800
categories: [Cloud]
tags: [cloud, sf]
published: true
---

# CDN

阿里云内容分发网络（Content Delivery Network，简称CDN）是建立并覆盖在承载网之上，由分布在不同区域的边缘节点服务器群组成的分布式网络。

**阿里云CDN分担源站压力，避免网络拥塞，确保在不同区域、不同场景下加速网站内容的分发，提高资源访问速度。**

阿里云CDN将源站资源缓存至阿里云遍布全球的加速节点上，当终端用户请求访问和获取该资源时，无需回源，系统自动调用离终端用户最近的CDN节点上已缓存的资源。

目前，CDN部分节点已支持IPv6进行访问。


# 为什么选择阿里云 CDN

## 产品竞争力

（1）性能强大

中国内地节点数最多的CDN服务商。

目前阿里云CDN在中国内地（大陆）拥有2300+节点，在港澳台和海外拥有超过500个节点。

中国内地领先的带宽输出能力。单节点带宽超过40Gbps，全网带宽输出能力130Tbps。

关键性能指标业内领先。包括缓存命中率超过95%+、响应时间达到ms级、加速视频时的视频流畅率超过95%+。

（2）产品易用

阿里云CDN支持多种行业、多种场景内容加速，例如：图片小文件、大文件下载、视音频点播、直播流媒体、全站加速、安全加速，并为您提供易用性的功能配置和脚本服务。已经成功接入阿里云CDN并实现业务加速的案例请参见客户案例、阿里云护航亚航季度大促顺利进行。

操作简单、功能丰富的控制台，可以帮助您可视化实现多样性配置和管理需求。

边缘脚本服务，可以快速支持您的定制化业务需求，解决定制化需求发布周期长等问题。

## 技术竞争力

先进的基础架构：在LVS采用四层负载均衡、Tengine采用七层负载均衡，以Swift作为HTTP缓存。

丰富的API接口：除了控制台，阿里云 CDN还开发了多样化的接口。目前我们推荐您使用新版API，详情请参见新版API参考。

多语言SDK工具包：我们为您准备了SDK使用说明，以便您了解如何获取、安装和调用阿里云SDK。您可以单击下载：Java、Python、PHP、.NET、C或C++、Go。

## 价格竞争力

性能和技术强大的同时，阿里云CDN的价格同样很有竞争力：

计费方式灵活多样，详情请参见下文：为您选型。

预付费套餐包价格常年优惠，详情请参见加速资源包。

如果您的业务需求量很大，您可以单独联系阿里云商务。

## 生态竞争力

阿里云拥有强大的产品功能体系：

如果您已经使用了其他阿里云的产品，那么借助生态优势，接入CDN服务会使您的实际业务更加流畅，提升您的业务运营效能。

## 服务竞争力

阿里云CDN拥有完善、强大的服务体系，包括：

完善的服务体系：7*24小时全网监控和服务。

完善的资料体系：

学习产品知识，请参见帮助文档；

学习基础课程，请前往阿里云大学；

浏览和讨论相关话题，请前往开发者社区。

完善的问题解决体系：

在线服务：您可以单击右侧联系我们，在智能顾问中咨询售前、售后问题，提交反馈建议。

工单服务：您也可以提交工单，和我们联系。

# CDN 的衡量指标

本文档为您介绍使用CDN前后衡量网站加速情况的主要性能指标，以及使用阿里云CDN的优势。

使用CDN加速，能够帮助您分担源站压力，加速资源访问速度。除了通用的数据观测指标外，不同的场景下也有更具体的指标。

观测这些指标，不仅可以帮助您体验CDN加速的效果，也能观测自身业务使用CDN的情况，帮助您更好地做出调整和决策。

## 通用指标

您可以根据以下几个主要性能指标，观察使用CDN前后，您的网站情况。

这些指标包含但不限于：

延时：指一个数据包从用户的计算机发送到网站服务器，然后再立即从网站服务器返回用户计算机的来回时间。延时越低，性能越好。

下载速度：指用户从网络上或者网络服务器上下载的数据时的传输速度。下载速度越快，性能越好。

打开速度：指用户打开网站的速度。打开速度越快，性能越好。

丢包率：指用户在网络传输中所丢失数据包数量占所发送数据组的比率。

回源率：回源率分为回源请求数比例及回源流量比例两种。

回源请求数比：指边缘节点对于没有缓存、缓存过期（可缓存）和不可缓存的请求占全部请求记录的比例。越低则性能越好。

回源流量比：回源流量是回源请求文件大小产生的流量和请求本身产生的流量。所以回源流量比=回源流量/（回源流量+用户请求访问的流量），比值越低，性能越好。

缓存命中率：指终端用户访问加速节点时，该节点已缓存了要被访问的数据的次数占全部访问次数的比例。缓存命中率越高，性能越好。

一般情况下，使用CDN后，您的网络延时、丢包率和回源率都会降低，与之相对的下载速度、打开速度、缓存命中率则会提高。

# 产品优势

与其他CDN服务商相比，阿里云CDN的主要优势包括稳定快速、性价比高、简单易用、高效智能。

## 稳定快速

先进的分布式系统架构，中国内地（大陆）节点2300+，海外、中国香港、中国澳门和中国台湾节点500+，六大洲覆盖，且中国内地节点数最多的云CDN。

充足的带宽和存储资源：单节点带宽40Gbps+，全网带宽输出能力130Tbps。

稳定高效的性能指标：95%+命中率，ms级响应时间，视频95%+流畅率。

完善的监控体系和服务体系：7*24小时全网监控，基于服务质量智能监控和调度。

## 性价比高

资源弹性扩展，按实际使用量付费，接入即可实现跨运营商、跨地域的全网覆盖。

先用后付，提供按流量或峰值带宽两种计费方式，满足不同业务需求。

对于网站突发流量，无需用户干预，自动作出响应和调整，有效减少源站压力。

## 简单易用

自助化配置域名的添、删、改、查，丰富简洁可定制配置项，支持自定义防盗链、缓存策略、HTTP响应头等功能。

开放API接口，提供服务开通、内容刷新、获取监控数据、下载分发日志等功能。

## 高效智能

标准化的配置响应更及时，通过用户自助提交的方式实现自动化，阿里云CDN控制台响应迅速，使用体验流畅。

而其他CDN需要人工的交互，响应时间相对较长。

# 工作原理

通过以下案例，您可以了解CDN的工作原理。

假设您的加速域名为www.a.com，接入CDN网络，开始使用加速服务后，当终端用户（北京）发起HTTP请求时，处理流程如下图所示。

![工作原理](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/5098/15670481554886_zh-CN.png)

1. 当终端用户（北京）向www.a.com下的某资源发起请求时，首先向LDNS（本地DNS）发起域名解析请求。

2. LDNS检查缓存中是否有www.a.com的IP地址记录。如果有，则直接返回给终端用户；如果没有，则向授权DNS查询。

3. 当授权DNS解析www.a.com时，返回域名CNAME www.a.tbcdn.com对应IP地址。

4. 域名解析请求发送至阿里云DNS调度系统，并为请求分配最佳节点IP地址。

5. LDNS获取DNS返回的解析IP地址。

6. 用户获取解析IP地址。

7. 用户向获取的IP地址发起对该资源的访问请求。

8. 如果该IP地址对应的节点已缓存该资源，则会将数据直接返回给用户，例如，图中步骤7和8，请求结束。

9. 如果该IP地址对应的节点未缓存该资源，则节点向源站发起对该资源的请求。获取资源后，结合用户自定义配置的缓存策略，将资源缓存至节点，例如，图中的北京节点，并返回给用户，请求结束。配置缓存策略的操作方法，请参见缓存配置。

# 场景概述

CDN的业务使用场景，分为静态内容加速、动态内容加速和安全加速。其中，阿里云CDN只针对于静态内容加速的使用；动态内容加速需使用阿里云全站加速；安全加速需使用阿里云安全加速。

了解动态内容和静态内容，请参见什么是静态内容和动态内容？。

## 常见场景

图片小文件	网站或应用App的主要业务为图片和小文件下载，包括各类型图片、html、css、js小文件等。

大文件下载	网站或应用App的主要业务为大文件下载，平均单个文件大小在20M以上，如游戏、各类客户端下载和App下载商店等。

视音频点播	网站或应用App的主要业务为视频点播或短视频类。支持MP4、FLV等主流视频格式。

全站加速	全站加速是阿里云一款独立产品，主要用于动态内容加速，也可以实现动静分离加速。

安全加速	安全加速适用于游戏、金融、政企安防、电商、医疗领域等易受攻击又必须兼顾加速的业务场景。

# 基本概念

## 加速域名

加速域名即您需要使用CDN加速的域名。域名是一组服务器的地址，可以是网站、电子邮件、FTP等。在阿里云CDN帮助文档中，加速域名通常指域名。

## CNAME记录

CNAME（Canonical Name）即别名，用来把一个域名解析到另一个域名，再由另一个域名提供IP地址。

例如，您有一台服务器上存放了很多资料，使用docs.example.com访问该资源，但又希望通过documents.example.com也能访问。

那么您可以在您的DNS解析服务商添加一条CNAME记录，将documents.example.com指向docs.example.com。

添加该条CNAME记录后，所有访问documents.example.com的请求都会被转到docs.example.com，获得相同的内容。

## CNAME域名

接入CDN，在阿里云控制台添加加速域名后，阿里云CDN将给您分配一个CNAME域名。

该CNAME域名的形式为*.*kunlun*.com。 您需要在您的DNS解析服务商添加一条CNAME记录，将自己的加速域名指向 `*.*kunlun*.com`的域名。

记录生效后，域名解析的工作就正式转向CDN服务，该域名所有的请求都将转向CDN节点，达到加速效果。

## DNS

DNS（Domain Name System），即域名解析服务。

DNS的作用：把域名转换成为网络可以识别的IP地址。

人们习惯记忆域名，但机器间互相只识别IP地址。域名与IP地址之间是一一对应的，它们之间的转换工作称为域名解析，域名解析需要由专门的域名解析服务器来完成，整个过程自动进行。

例如：您上网时输入的www.baidu.com会自动转换成为220.181.112.143。您可以使用阿里云云解析，也可以使用其他DNS服务商。

## SSL/TLS

SSL（Secure Sockets Layer，安全通讯协议），是一个架构于TCP之上的安全套接层。

它可以有效协助Internet应用软件提升通讯时的资料完整性以及安全性。

标准化之后的SSL名称改为TLS（Transport Layer Security，传输层安全协议），因此很多相关的文档将二者并称（SSL/TLS）。

## 边缘节点

在阿里云CDN的帮助文档中，边缘节点、CDN节点、Cache节点、缓存节点、加速节点、阿里云节点、节点等都指阿里云边缘节点。

边缘节点是相对于网络的复杂结构而提出的一个概念，指与最终接入的用户之间具有较少中间环节的网络节点，对最终接入用户有相对于源站而言更好的响应能力和连接速度。

其作用是将访问量较大的内容缓存到边缘节点的服务器上，以此来提高网终端用户访问网站内容的速度和质量。

## 源站

您实际业务的服务器。源站类型可以选择OSS域名、IP、源站或函数计算域名。

## 回源

CDN节点未缓存请求资源或缓存资源已到期时，回源站获取资源，返回给客户端。

例如：您访问某个URL时，如果解析到的CDN节点未缓存该资源，则您的访问请求会直接到源站获取资源，并根据URL请求返回给您。

## 回源HOST

源站决定了回源时，请求到哪个IP。回源HOST决定回源请求访问到该IP上的哪个站点。

例1：源站是域名。

源站为www.a.com，回源HOST为www.b.com，那么实际回源是请求到www.a.com解析到的IP，即对应的主机上的站点www.b.com。

例2：源站是IP。

源站为1.1.1.1，回源HOST为www.b.com，那么实际回源的是1.1.1.1对应的主机上的站点www.b.com。

## 协议回源

指回源时使用的协议和客户端访问资源时的协议保持一致，即如果客户端使用HTTPS方式请求资源，当CDN节点上未缓存该资源时，节点会使用相同的HTTPS方式回源获取资源。同理，如果客户端使用HTTP协议的请求，CDN节点回源时也使用HTTP协议。

## 过滤参数

借助过滤参数开关，您可以根据实际业务需要，决定在缓存时是否过滤用户请求URL中?之后的参数。

如果开启过滤参数，则CDN节点会截取没有参数的URL向源站请求，且CDN节点仅保留一份副本。

如果关闭过滤参数，则每个不同的URL会缓存不同的副本在CDN的节点上。

若您的资源URL中不同参数代表相同的内容，建议开启过滤参数，有效提升缓存命中率。

# 参考资料

[什么是 CDN](https://help.aliyun.com/product/27099.html?spm=a2c4g.750001.list.86.1cec7b13DbuHQW)

* any list
{:toc}