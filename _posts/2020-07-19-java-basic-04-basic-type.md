---
layout: post
title:  java 基础篇-04-java 8 大基本类型
date:  2020-7-19 10:37:20 +0800
categories: [Java]
tags: [java, java-base, sf]
published: true
---

# 为什么需要有数据类型？

生活中的数据本来就是有类型的，只不过我们没有在意或者去深入研究。那么计算机语言就是去告诉计算机如何去解决现实问题，当然需要对等的概念去描述数据。

数据类型有啥作用？

（1）决定了每个数据存储时所需要的字节数，字节有8个二进制的0或1构成。

（2）决定了数据所能执行的运算。

八大基本数据类型包括：整数类型（byte,short,int,long）,浮点类型（float，double）,字符类型（char）,布尔类型（boolean）,其实还有其它三个数据类型，类（class）,数组类型，接口类型（interface），本文不做展开。

## 数据类型范围

![输入图片说明](https://images.gitee.com/uploads/images/2020/1012/101757_53d80969_508704.png)

## 拆装箱

![输入图片说明](https://images.gitee.com/uploads/images/2020/1012/101836_5bfd7f4f_508704.png)

## 常见转义字符

![输入图片说明](https://images.gitee.com/uploads/images/2020/1012/101934_41fb75f6_508704.png)

# 几个问题

## 为什么需要基本类型

java 作为面向对象的语言，为什么会有 8 大基本类型？

在Java语言中包含基本数据类型是最有争议的设计决定之一，然后保留基本类型原因只有一个——性能。

### 基本类型的缺陷

基本类型是有害的，因为“它们把函数式的语义混进了面向对象模型里面，让面向对象变得不纯。

基本类型不是对象，但是它们却存在于以一流对象为根本的语言中”。

基本类型和(包装类形式的)对象类型提供了两种处理逻辑上相似的类型的方式，但是在底层的语义上却有着非常大的不同。

比如，两个实例如何来比较相等性？对于基本类型，使用==操作符，但是对于对象类型，更好的方式是调用equals()方法，而基本类型是没有这个操作的。

相似的，在赋值和传参的语义上也是不同的。

就连默认值也是不一样的，比如int的默认是值0，但是Integer的默认值是null。

ps: 关于默认值，在写框架的时候尤其突出，其他的对象不赋值也行，基本类型设置 null 就会直接报错，每次都要特殊处理。

### 内存的使用

Java中的double总是占据内存的64个比特，但是引用类型的字节数取决于JVM。

我的电脑运行64位Win7和64位JVM，因此在我的电脑上一个引用占用64个比特。

根据图1，一个double比如n1要占用8个字节(64比特)，一个Double比如n2要占用24个字节——对象的引用占8个字节，对象中的double的值占8个字节，对象中对Double对象的引用占8个字节。

此外，Java需要使用额外的内存来支持对象的垃圾回收，但是基本类型不需要。

### 性能

基本类型的性能更好。

当然对于维护性而言，这个性能还是需要我们去衡量取舍的。

不过在编写 leetcode，这种小技巧还是可以使用下的。

## 基本类型和封装类型的区别

基本类型可以通过自动装箱成封装类型；封装类型也可以通过自定拆箱变为基本类型。

不过 null 值对于基本类型是不支持的，比如我们从数据库查询结果，从外部接受请求等，基本类型都是应该避免使用的。

# 浮点型

## 什么是浮点型？

浮点型简单来说就是表示带有小数的数据，而恰恰小数点可以在相应的二进制的不同位置浮动，可能是这样就被定义成浮点型了。

## 什么是单精度和双精度？

C语言和C#语言中，对于浮点类型的数据采用单精度类型（float）和双精度类型(double)来存储，float数据占用32bit,double数据占用64bit,我们在声明一个变量float f= 2.25f的时候，是如何分配内存的呢？

如果胡乱分配，那世界岂不是乱套了么，其实不论是float还是double在存储方式上都是遵从IEEE的规范的，float遵从的是IEEE R32.24 ,而double 遵从的是R64.53。

无论是单精度还是双精度在存储中都分为三个部分：

1. 符号位(Sign) : 0代表正，1代表为负

2. 指数位（Exponent）:用于存储科学计数法中的指数数据，并且采用移位存储

3. 尾数部分（Mantissa）：尾数部分

其中float的存储方式如下图所示：

![输入图片说明](https://images.gitee.com/uploads/images/2020/1012/154046_9783e58e_508704.png)

而双精度的存储方式为:

![输入图片说明](https://images.gitee.com/uploads/images/2020/1012/154157_8782b029_508704.png)

R32.24和R64.53的存储方式都是用科学计数法来存储数据的。

而我们计算机根本不认识十进制的数据，他只认识0，1，所以在计算机存储中，首先要将上面的数更改为二进制的科学计数法表示，8.25用二进制表示可表示为1000.01。

120.5用二进制表示为：1110110.1用二进制的科学计数法表示1000.01可以表示为`1.0001*2^3`,任何一个数都的科学计数法表示都为 `1.xxx*2^n`,尾数部分就可以表示为xxxx,第一位都是1嘛，干嘛还要表示呀？

可以将小数点前面的1省略，所以23bit的尾数部分，可以表示的精度却变成了24bit，道理就是在这里，那24bit能精确到小数点后几位呢，我们知道9的二进制表示为1001，所以4bit能精确十进制中的1位小数点，24bit就能使float能精确到小数点后6位，而对于指数部分，因为指数可正可负，

8位的指数位能表示的指数范围就应该为:-127-128了，所以指数部分的存储采用移位存储，存储的数据为元数据+127。

### 实际存储

下面就看看8.25在内存中真正的存储方式。

首先看下8.25，用二进制的科学计数法表示为: 1.0001 * 2^3

按照上面的存储方式，符号位为:0，表示为正，指数位为:3+127=130 ,位数部分为 1.0001,故8.25的存储方式如下图所示:

![输入图片说明](https://images.gitee.com/uploads/images/2020/1012/163705_60560753_508704.png)

那么如果给出内存中一段数据，并且告诉你是单精度存储的话，你如何知道该数据的十进制数值呢？

其实就是对上面的反推过程，比如给出如下内存数据：0100001011101101000000000000，首先我们现将该数据分段，

```
0 10000 0101 110 1101 0000 0000 0000 0000
```

在内存中的存储就为下图所示：

![输入图片说明](https://images.gitee.com/uploads/images/2020/1012/164002_2281df04_508704.png)

根据我们的计算方式，可以计算出，这样一组数据表示为: `1.1101101*2^6=120.5`

而双精度浮点数的存储和单精度的存储大同小异，不同的是指数部分和尾数部分的位数。

### 精度问题

2.2用科学计数法表示应该为：将十进制的小数转换为二进制的小数的方法为将小数×2，取整数部分，所以0.282=0.4，所以二进制小数第一位为0.4的整数部分0，0.4×2=0.8，第二位为0,0.8×2=1.6,第三位为1，0.6×2 = 1.2，第四位为1，0.2×2=0.4，第五位为0，这样永远也不可能乘到=1.0，得到的二进制是一个无限循环的排列 00110011001100110011... ,对于单精度数据来说，尾数只能表示24bit的精度，所以2.2的float存储为:

![输入图片说明](https://images.gitee.com/uploads/images/2020/1012/164220_bfe83fac_508704.png)

但是这样存储方式，换算成十进制的值，却不会是2.2的，应为十进制在转换为二进制的时候可能会不准确，如2.2，而double类型的数据也存在同样的问题。

**所以在浮点数表示中会产生些许的误差，在单精度转换为双精度的时候，也会存在误差的问题**。

对于能够用二进制表示的十进制数据，如2.25，这个误差就会不存在，所以会出现上面比较奇怪的输出结果。

## 为什么不能用浮点型表示金额？

所以金额计算中，一定不能使用浮点型计算金额。

java 计算中，建议使用 BigDecimal 进行金额的计算。

# 小结

本文主要回顾了 java 中的 8 大基本类型的知识归纳。

重点回顾了浮点型的问题。

# 参考资料

[java八大基本数据类型](https://blog.csdn.net/Jacob_924/article/details/80944221)

[Java为什么需要保留基本数据类型](https://blog.csdn.net/findmyself_for_world/article/details/50094991)

[什么是浮点型？什么是单精度浮点数（float）以及双精度浮点数（double）？](https://blog.csdn.net/qq_44543508/article/details/101982298)

[浮点数在计算机中存储方式](https://www.cnblogs.com/jillzhang/archive/2007/06/24/793901.html)

* any list
{:toc}