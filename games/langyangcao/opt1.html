<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‹¼ã€ç¾Šã€è‰ æ²™ç›’æ¨¡æ‹Ÿ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            display: flex;
            justify-content: space-between;
            margin: 0;
        }
        .left-panel {
            flex-grow: 1;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .sandbox {
            display: grid;
            grid-template-columns: repeat(50, 15px);
            grid-template-rows: repeat(50, 15px);
            gap: 1px;
            margin-top: 20px;
        }
        .cell {
            width: 15px;
            height: 15px;
            border: 1px solid #ccc;
            text-align: center;
            vertical-align: middle;
            font-size: 12px;
            font-family: "Segoe UI Emoji", sans-serif;
        }
        .wolf {
            color: red;
        }
        .sheep {
            color: lightgreen;
        }
        .grass {
            color: green;
        }
        .empty {
            background-color: white;
        }
        .right-panel {
            width: 250px;
            margin-top: 20px;
            padding: 20px;
            background-color: #fff;
            border: 1px solid #ccc;
            font-size: 16px;
            text-align: left;
        }
        .right-panel div {
            margin: 10px 0;
        }
        button {
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <div class="left-panel">
        <div class="sandbox" id="sandbox"></div>
    </div>
    
    <div class="right-panel">
        <h3>ç»Ÿè®¡ä¿¡æ¯</h3>
        <div>å½“å‰å¤©æ°”: <span id="weather"></span></div>
        <div>å½“å‰å­£èŠ‚: <span id="season"></span></div>
        <div>æ—¶é—´: <span id="time"></span></div>
        <div>ç‹¼çš„æ•°é‡: <span id="wolfCount"></span></div>
        <div>ç¾Šçš„æ•°é‡: <span id="sheepCount"></span></div>
        <div>è‰çš„æ•°é‡: <span id="grassCount"></span></div>
        <div>æ¨¡æ‹Ÿæ—¶é—´: <span id="simTime"></span> ç§’</div>
    </div>

    <button onclick="startSimulation()">å¼€å§‹æ¨¡æ‹Ÿ</button>

    <script>
        const sandboxSize = 50;
        const seasons = ['æ˜¥', 'å¤', 'ç§‹', 'å†¬'];
        let grid = [];
        let animals = {
            wolf: [],
            sheep: []
        };
        let grass = [];
        let seasonIndex = 0;
        let weather = 'æ™´å¤©';
        let simTime = 0;
        let simInterval;

        function createSandbox() {
            const sandbox = document.getElementById('sandbox');
            for (let i = 0; i < sandboxSize; i++) {
                const row = [];
                for (let j = 0; j < sandboxSize; j++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    sandbox.appendChild(cell);
                    row.push(cell);
                }
                grid.push(row);
            }
        }

        function randomPosition() {
            return {
                row: Math.floor(Math.random() * sandboxSize),
                col: Math.floor(Math.random() * sandboxSize)
            };
        }

        function initializeEntities() {
            // åˆå§‹åŒ–è‰
            for (let i = 0; i < 500; i++) {
                const pos = randomPosition();
                if (!grass.some(g => g.row === pos.row && g.col === pos.col)) {
                    grass.push(pos);
                    grid[pos.row][pos.col].innerText = 'ğŸŒ¿';
                }
            }
            // åˆå§‹åŒ–ç¾Š
            for (let i = 0; i < 20; i++) {
                const pos = randomPosition();
                animals.sheep.push(pos);
                grid[pos.row][pos.col].innerText = 'ğŸ‘';
            }
            // åˆå§‹åŒ–ç‹¼
            for (let i = 0; i < 10; i++) {
                const pos = randomPosition();
                animals.wolf.push(pos);
                grid[pos.row][pos.col].innerText = 'ğŸº';
            }
        }

        function nextSeason() {
            seasonIndex = (seasonIndex + 1) % 4;
            updateWeather();
        }

        function updateWeather() {
            // ç®€å•çš„å¤©æ°”å˜åŒ–é€»è¾‘
            const weatherConditions = ['æ™´å¤©', 'é›¨å¤©', 'æš´é£é›ª'];
            weather = weatherConditions[Math.floor(Math.random() * 3)];
            document.getElementById('weather').textContent = weather;
        }

        function moveSheep() {
            animals.sheep.forEach(sheep => {
                // è®¡ç®—ç¾Šå‘è‰çš„æ–¹å‘
                let target = null;
                let minDist = Infinity;

                // æ‰¾åˆ°è·ç¦»ç¾Šæœ€è¿‘çš„è‰
                grass.forEach(g => {
                    const dist = Math.abs(sheep.row - g.row) + Math.abs(sheep.col - g.col);
                    if (dist < minDist) {
                        minDist = dist;
                        target = g;
                    }
                });

                if (target) {
                    const direction = (target.row - sheep.row > 0 ? 1 : (target.row - sheep.row < 0 ? -1 : 0));
                    const directionCol = (target.col - sheep.col > 0 ? 1 : (target.col - sheep.col < 0 ? -1 : 0));

                    const newRow = sheep.row + direction;
                    const newCol = sheep.col + directionCol;

                    // ç§»åŠ¨ç¾Š
                    if (newRow >= 0 && newRow < sandboxSize && newCol >= 0 && newCol < sandboxSize && !isOccupied(newRow, newCol)) {
                        // æ¸…ç©ºåŸä½ç½®
                        grid[sheep.row][sheep.col].innerText = '';
                        sheep.row = newRow;
                        sheep.col = newCol;
                        grid[sheep.row][sheep.col].innerText = 'ğŸ‘';

                        // å¦‚æœç¾Šç¢°åˆ°è‰
                        if (grid[sheep.row][sheep.col].innerText === 'ğŸŒ¿') {
                            grass = grass.filter(g => g.row !== sheep.row || g.col !== sheep.col);
                            grid[sheep.row][sheep.col].innerText = 'ğŸ‘';
                        }
                    }
                }
            });
        }

        function moveWolves() {
            animals.wolf.forEach(wolf => {
                // è®¡ç®—ç‹¼å‘ç¾Šçš„æ–¹å‘
                let target = null;
                let minDist = Infinity;

                // æ‰¾åˆ°è·ç¦»ç‹¼æœ€è¿‘çš„ç¾Š
                animals.sheep.forEach(s => {
                    const dist = Math.abs(wolf.row - s.row) + Math.abs(wolf.col - s.col);
                    if (dist < minDist) {
                        minDist = dist;
                        target = s;
                    }
                });

                if (target) {
                    // è®¡ç®—æ–¹å‘
                    const direction = (target.row - wolf.row > 0 ? 1 : (target.row - wolf.row < 0 ? -1 : 0));
                    const directionCol = (target.col - wolf.col > 0 ? 1 : (target.col - wolf.col < 0 ? -1 : 0));

                    // ç§»åŠ¨ç‹¼
                    const newRow = wolf.row + 2 * direction;
                    const newCol = wolf.col + 2 * directionCol;

                    if (newRow >= 0 && newRow < sandboxSize && newCol >= 0 && newCol < sandboxSize && !isOccupied(newRow, newCol)) {
                        grid[wolf.row][wolf.col].innerText = '';
                        wolf.row = newRow;
                        wolf.col = newCol;
                        grid[wolf.row][wolf.col].innerText = 'ğŸº';

                        // å¦‚æœç‹¼åƒåˆ°ç¾Š
                        if (grid[wolf.row][wolf.col].innerText === 'ğŸ‘') {
                            animals.sheep = animals.sheep.filter(s => s.row !== wolf.row || s.col !== wolf.col);
                        }
                    }
                }
            });
        }

        function isOccupied(row, col) {
            const cell = grid[row][col].innerText;
            return cell !== '' && cell !== 'ğŸŒ¿';  // ä¸èƒ½æ˜¯ç¾Šæˆ–ç‹¼
        }

        function growGrass() {
            if (weather === 'æ™´å¤©' && seasonIndex === 0) {
                if (grass.length < 1000) {
                    const pos = randomPosition();
                    if (!grass.some(g => g.row === pos.row && g.col === pos.col)) {
                        grass.push(pos);
                        grid[pos.row][pos.col].innerText = 'ğŸŒ¿';
                    }
                }
            }
        }

        function updateStats() {
            document.getElementById('season').textContent = seasons[seasonIndex];
            document.getElementById('time').textContent = new Date().toLocaleTimeString();
            document.getElementById('wolfCount').textContent = animals.wolf.length;
            document.getElementById('sheepCount').textContent = animals.sheep.length;
            document.getElementById('grassCount').textContent = grass.length;
            document.getElementById('simTime').textContent = simTime;
        }

        function startSimulation() {
            simInterval = setInterval(() => {
                moveSheep();
                moveWolves();
                growGrass();
                nextSeason();
                updateStats();
                simTime++;
            }, 1000);
        }

        createSandbox();
        initializeEntities();
        updateStats();
    </script>

</body>
</html>
