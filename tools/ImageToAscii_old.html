<canvas id="canvas"></canvas>
<!--<div id="opt" style="width: 800px; height: 800px;"></div>-->
<script>
    var canvas = document.getElementById("canvas");
    var context = canvas.getContext("2d");
    canvas.width = 800;
    canvas.height = 800;
    var img = new Image();
    img.src = "love.png";
    img.onload =function(){
        invert(this);
    };


    //    像素点的rgba数组
    function invert(img) {
//        context.drawImage(img,0,0);
//        //获取图片对象以及元素点的数组
//        var img1 = context.getImageData(0, 0, 800, 800);
//        var data = img1.data;
        //反转rgba
//        for (var i = 0, len = data.length; i < len; i += 4) {
//            data[i]=255-data[i];
//            data[i+1]=255-data[i+1];
//            data[i+2]=255-data[i+2];
//        }

        //转换灰度图
//        for (var i = 0, len = data.length; i < len; i += 4) {
//            var avg=(data[i]+data[i+1]+data[i+2])/3;
//            data[i]=avg;
//            data[i+1]=avg;
//            data[i+2]=avg;
//        }

        context.drawImage(img,0,0);
        //获取图片对象以及元素点的数组
        var img1 = context.getImageData(0, 0, 300, 300);
        var data = img1.data;

        //转换灰度图
        var arr=["M","N","H","Q","$","O","C","?","7",">","!",":","–",";","."];
        var result=[];
        for (var i = 0, len = data.length; i < len; i += 8) {
            var avg=(data[i]+data[i+1]+data[i+2])/3;
            var num=Math.floor(avg/18);
            result.push(arr[num]);
            if(i%(300*4)==0&&i!=0){
                result.push("<br>")
            }
        }
//        opt.innerHTML=result.join();
//        document.body.appendChild(opt);

        const dom = document.createElement('pre');
//        this.setStyle(dom);
        dom.innerHTML = result.join('');
        document.body.appendChild(dom);


//        context.putImageData(img1, 0, 0);
    }





</script>