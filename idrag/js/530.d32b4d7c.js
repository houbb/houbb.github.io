"use strict";(self["webpackChunkidrag"]=self["webpackChunkidrag"]||[]).push([[530],{9530:function(t,e,n){n.r(e),n.d(e,{default:function(){return en}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home"},[e("Toolbar"),e("main",[e("section",{staticClass:"left"},[e("ComponentList"),e("RealTimeComponentList")],1),e("section",{staticClass:"center"},[e("div",{staticClass:"content",on:{drop:t.handleDrop,dragover:t.handleDragOver,mousedown:t.handleMouseDown,mouseup:t.deselectCurComponent}},[e("Editor")],1)]),e("section",{staticClass:"right"},[t.curComponent?e("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:"属性",name:"attr"}},[e(t.curComponent.component+"Attr",{tag:"component"})],1)],1):e("CanvasAttr")],1)])],1)},i=[],s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"editor",class:{edit:t.isEdit},style:{...t.getCanvasStyle(t.canvasStyleData),width:t.changeStyleWithScale(t.canvasStyleData.width)+"px",height:t.changeStyleWithScale(t.canvasStyleData.height)+"px"},attrs:{id:"editor"},on:{mousedown:t.handleMouseDown,contextmenu:t.handleContextMenu}},[e("Grid"),t._l(t.componentData,(function(n,o){return e("Shape",{key:n.id,class:{lock:n.isLock},style:t.getShapeStyle(n.style),attrs:{"default-style":n.style,active:n.id===(t.curComponent||{}).id,element:n,index:o}},[n.component.startsWith("SVG")?e(n.component,{tag:"component",staticClass:"component",style:t.getSVGStyle(n.style),attrs:{id:"component"+n.id,"prop-value":n.propValue,element:n,request:n.request}}):"VText"!=n.component?e(n.component,{tag:"component",staticClass:"component",style:t.getComponentStyle(n.style),attrs:{id:"component"+n.id,"prop-value":n.propValue,element:n,request:n.request}}):e(n.component,{tag:"component",staticClass:"component",style:t.getComponentStyle(n.style),attrs:{id:"component"+n.id,"prop-value":n.propValue,element:n,request:n.request},on:{input:t.handleInput}})],1)})),e("ContextMenu"),e("MarkLine")],2)},r=[],c=(n(6699),n(629)),a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"shape",class:{active:t.active},on:{click:t.selectCurComponent,mousedown:t.handleMouseDownOnShape}},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.isActive(),expression:"isActive()"}],staticClass:"iconfont icon-xiangyouxuanzhuan",on:{mousedown:t.handleRotate}}),e("span",{directives:[{name:"show",rawName:"v-show",value:t.element.isLock,expression:"element.isLock"}],staticClass:"iconfont icon-suo"}),t._l(t.isActive()?t.getPointList():[],(function(n){return e("div",{key:n,staticClass:"shape-point",style:t.getPointStyle(n),on:{mousedown:function(e){return t.handleMouseDownOnPoint(n,e)}}})})),t._t("default")],2)},l=[],u=n(4003),h=n(2648),d={props:{active:{type:Boolean,default:!1},element:{required:!0,type:Object,default:()=>{}},defaultStyle:{required:!0,type:Object,default:()=>{}},index:{required:!0,type:[Number,String],default:0}},data(){return{pointList:["lt","t","rt","r","rb","b","lb","l"],pointList2:["r","l"],initialAngle:{lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315},angleToCursor:[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}],cursors:{}}},computed:(0,c.rn)(["curComponent","editor"]),mounted(){this.curComponent&&(this.cursors=this.getCursor())},methods:{handleRotate(){console.log("暂不支持旋转，敬请期待!")},getPointList(){return"line-shape"===this.element.component?this.pointList2:this.pointList},isActive(){return this.active&&!this.element.isLock},getPointStyle(t){const{width:e,height:n}=this.defaultStyle,o=/t/.test(t),i=/b/.test(t),s=/l/.test(t),r=/r/.test(t);let c=0,a=0;2===t.length?(c=s?0:e,a=o?0:n):((o||i)&&(c=e/2,a=o?0:n),(s||r)&&(c=s?0:e,a=Math.floor(n/2)));const l={marginLeft:"-4px",marginTop:"-4px",left:`${c}px`,top:`${a}px`,cursor:this.cursors[t]};return l},getCursor(){const t={};return t},handleMouseDownOnShape(t){if(this.$nextTick((()=>u.Z.$emit("componentClick"))),this.$store.commit("setInEditorStatus",!0),this.$store.commit("setClickComponentStatus",!0),(0,h.rc)(this.element.component)&&t.preventDefault(),t.stopPropagation(),this.$store.commit("setCurComponent",{component:this.element,index:this.index}),this.element.isLock)return;this.cursors=this.getCursor();const e={...this.defaultStyle},n=t.clientY,o=t.clientX,i=Number(e.top),s=Number(e.left);let r=!1;const c=t=>{r=!0;const c=t.clientX,a=t.clientY;e.top=a-n+i,e.left=c-o+s,this.$store.commit("setShapeStyle",e),this.$nextTick((()=>{u.Z.$emit("move",a-n>0,c-o>0)}))},a=()=>{u.Z.$emit("unmove"),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",c),document.addEventListener("mouseup",a)},selectCurComponent(t){t.stopPropagation(),t.preventDefault(),this.$store.commit("hideContextMenu")},handleMouseDownOnPoint(t,e){},isNeedLockProportion(){return!1}}},m=d,p=n(1001),f=(0,p.Z)(m,a,l,!1,null,"0e4c9b78",null),v=f.exports,g=n(9748),y=n(1457),C=function(){var t=this,e=t._self._c;return e("svg",{staticClass:"grid",attrs:{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg"}},[e("defs",[e("pattern",{attrs:{id:"smallGrid",width:"7.236328125",height:"7.236328125",patternUnits:"userSpaceOnUse"}},[e("path",{attrs:{d:"M 7.236328125 0 L 0 0 0 7.236328125",fill:"none",stroke:"rgba(207, 207, 207, 0.3)","stroke-width":"1"}})]),e("pattern",{attrs:{id:"grid",width:"36.181640625",height:"36.181640625",patternUnits:"userSpaceOnUse"}},[e("rect",{attrs:{width:"36.181640625",height:"36.181640625",fill:"url(#smallGrid)"}}),e("path",{attrs:{d:"M 36.181640625 0 L 0 0 0 36.181640625",fill:"none",stroke:"rgba(186, 186, 186, 0.5)","stroke-width":"1"}})])]),e("rect",{attrs:{width:"100%",height:"100%",fill:"url(#grid)"}})])},w=[],S={},x=(0,p.Z)(S,C,w,!1,null,"39ef9482",null),b=x.exports,k=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.menuShow,expression:"menuShow"}],staticClass:"contextmenu",style:{top:t.menuTop+"px",left:t.menuLeft+"px"}},[e("ul",{on:{mouseup:t.handleMouseUp}},[t.curComponent?[t.curComponent.isLock?e("li",{staticClass:"el-icon-unlock",on:{click:t.unlock}},[t._v(" 解锁")]):[e("li",{staticClass:"el-icon-top",on:{click:t.topComponent}},[t._v(" 置顶")]),e("li",{staticClass:"el-icon-bottom",on:{click:t.bottomComponent}},[t._v(" 置底")]),e("li",{staticClass:"el-icon-arrow-up",on:{click:t.upComponent}},[t._v(" 上移")]),e("li",{staticClass:"el-icon-arrow-down",on:{click:t.downComponent}},[t._v(" 下移")]),e("el-divider"),e("li",{staticClass:"el-icon-document-copy",on:{click:t.copy}},[t._v(" 复制")]),e("li",{staticClass:"el-icon-copy-document",on:{click:t.paste}},[t._v(" 粘贴")]),e("li",{staticClass:"el-icon-scissors",on:{click:t.cut}},[t._v(" 剪切")]),e("li",{staticClass:"el-icon-delete",on:{click:t.deleteComponent}},[t._v(" 删除")]),e("el-divider"),e("li",{staticClass:"el-icon-lock",on:{click:t.lock}},[t._v(" 加锁")])]]:e("li",{staticClass:"el-icon-copy-document",on:{click:t.paste}},[t._v(" 粘贴")])],2)])},$=[],D={data(){return{copyData:null}},computed:(0,c.rn)(["menuTop","menuLeft","menuShow","curComponent"]),methods:{handleMouseUp(){this.$store.commit("setClickComponentStatus",!0)},deleteComponent(){this.$store.commit("deleteComponent")},upComponent(){this.$store.commit("upComponent")},downComponent(){this.$store.commit("downComponent")},topComponent(){this.$store.commit("topComponent")},bottomComponent(){this.$store.commit("bottomComponent")},copy(){this.$store.commit("copy")},paste(){this.$store.commit("copy")},cut(){this.$store.commit("cut")},lock(){this.$store.commit("lock")},unlock(){this.$store.commit("unlock")}}},P=D,E=(0,p.Z)(P,k,$,!1,null,"3937014e",null),N=E.exports,L=function(){var t=this,e=t._self._c;return e("div",{staticClass:"mark-line"},t._l(t.lines,(function(n){return e("div",{directives:[{name:"show",rawName:"v-show",value:t.lineStatus[n]||!1,expression:"lineStatus[line] || false"}],key:n,ref:n,refInFor:!0,staticClass:"line",class:n.includes("x")?"xline":"yline"})})),0)},T=[],_={data(){return{lines:["xt","xc","xb","yl","yc","yr"],diff:3,lineStatus:{xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}}},computed:(0,c.rn)(["curComponent","componentData"]),mounted(){u.Z.$on("move",((t,e)=>{this.showLine(t,e)})),u.Z.$on("unmove",(()=>{this.hideLine()}))},methods:{hideLine(){Object.keys(this.lineStatus).forEach((t=>{this.lineStatus[t]=!1}))},showLine(t,e){const n=this.$refs,o=this.componentData,i=(0,g.fg)(this.curComponent.style),s=i.width/2,r=i.height/2;this.hideLine(),o.forEach((o=>{if(o==this.curComponent)return;const c=(0,g.fg)(o.style),{top:a,left:l,bottom:u,right:h}=c,d=c.width/2,m=c.height/2,p={top:[{isNearly:this.isNearly(i.top,a),lineNode:n.xt[0],line:"xt",dragShift:a,lineShift:a},{isNearly:this.isNearly(i.bottom,a),lineNode:n.xt[0],line:"xt",dragShift:a-i.height,lineShift:a},{isNearly:this.isNearly(i.top+r,a+m),lineNode:n.xc[0],line:"xc",dragShift:a+m-r,lineShift:a+m},{isNearly:this.isNearly(i.top,u),lineNode:n.xb[0],line:"xb",dragShift:u,lineShift:u},{isNearly:this.isNearly(i.bottom,u),lineNode:n.xb[0],line:"xb",dragShift:u-i.height,lineShift:u}],left:[{isNearly:this.isNearly(i.left,l),lineNode:n.yl[0],line:"yl",dragShift:l,lineShift:l},{isNearly:this.isNearly(i.right,l),lineNode:n.yl[0],line:"yl",dragShift:l-i.width,lineShift:l},{isNearly:this.isNearly(i.left+s,l+d),lineNode:n.yc[0],line:"yc",dragShift:l+d-s,lineShift:l+d},{isNearly:this.isNearly(i.left,h),lineNode:n.yr[0],line:"yr",dragShift:h,lineShift:h},{isNearly:this.isNearly(i.right,h),lineNode:n.yr[0],line:"yr",dragShift:h-i.width,lineShift:h}]},f=[],{rotate:v}=this.curComponent.style;Object.keys(p).forEach((t=>{p[t].forEach((e=>{e.isNearly&&(this.$store.commit("setShapeSingleStyle",{key:t,value:0!=v?this.translatecurComponentShift(t,e,i):e.dragShift}),e.lineNode.style[t]=`${e.lineShift}px`,f.push(e.line))}))})),f.length&&this.chooseTheTureLine(f,t,e)}))},translatecurComponentShift(t,e,n){const{width:o,height:i}=this.curComponent.style;return"top"==t?Math.round(e.dragShift-(i-n.height)/2):Math.round(e.dragShift-(o-n.width)/2)},chooseTheTureLine(t,e,n){n?t.includes("yr")?this.lineStatus.yr=!0:t.includes("yc")?this.lineStatus.yc=!0:t.includes("yl")&&(this.lineStatus.yl=!0):t.includes("yl")?this.lineStatus.yl=!0:t.includes("yc")?this.lineStatus.yc=!0:t.includes("yr")&&(this.lineStatus.yr=!0),e?t.includes("xb")?this.lineStatus.xb=!0:t.includes("xc")?this.lineStatus.xc=!0:t.includes("xt")&&(this.lineStatus.xt=!0):t.includes("xt")?this.lineStatus.xt=!0:t.includes("xc")?this.lineStatus.xc=!0:t.includes("xb")&&(this.lineStatus.xb=!0)},isNearly(t,e){return Math.abs(t-e)<=this.diff}}},Z=_,M=(0,p.Z)(Z,L,T,!1,null,"4f220f20",null),I=M.exports,A={components:{Shape:v,Grid:b,ContextMenu:N,MarkLine:I},props:{isEdit:{type:Boolean,default:!0}},data(){return{editorX:0,editorY:0,start:{x:0,y:0},width:0,height:0,isShowArea:!1,svgFilterAttrs:["width","height","top","left","rotate"]}},computed:(0,c.rn)(["componentData","curComponent","canvasStyleData","editor"]),mounted(){this.$store.commit("getEditor"),u.Z.$on("hideArea",(()=>{this.hideArea()}))},methods:{getShapeStyle:g.B$,getCanvasStyle:g.$i,changeStyleWithScale:y.EY,handleContextMenu(t){t.stopPropagation(),t.preventDefault();let e=t.target,n=t.offsetY,o=t.offsetX;while(e instanceof SVGElement)e=e.parentNode;while(!e.className.includes("editor"))o+=e.offsetLeft,n+=e.offsetTop,e=e.parentNode;this.$store.commit("showContextMenu",{top:n,left:o})},handleMouseDown(t){this.curComponent&&!(0,h.rc)(this.curComponent.component)||t.preventDefault(),this.hideArea();const e=this.editor.getBoundingClientRect();this.editorX=e.x,this.editorY=e.y;const n=t.clientX,o=t.clientY;this.start.x=n-this.editorX,this.start.y=o-this.editorY,this.isShowArea=!0;const i=t=>{this.width=Math.abs(t.clientX-n),this.height=Math.abs(t.clientY-o),t.clientX<n&&(this.start.x=t.clientX-this.editorX),t.clientY<o&&(this.start.y=t.clientY-this.editorY)},s=t=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",s),t.clientX==n&&t.clientY==o&&this.hideArea()};document.addEventListener("mousemove",i),document.addEventListener("mouseup",s)},hideArea(){this.isShowArea=0,this.width=0,this.height=0,this.$store.commit("setAreaData",{style:{left:0,top:0,width:0,height:0},components:[]})},getSelectArea(){const t=[],{x:e,y:n}=this.start;return this.componentData.forEach((o=>{if(o.isLock)return;const{left:i,top:s,width:r,height:c}=(0,g.fg)(o.style);e<=i&&n<=s&&i+r<=e+this.width&&s+c<=n+this.height&&t.push(o)})),t},getComponentStyle(t){return(0,g.C2)(t,this.svgFilterAttrs)},getSVGStyle(t){return(0,g.WF)(t,this.svgFilterAttrs)},handleInput(t,e){this.$store.commit("setShapeStyle",{height:this.getTextareaHeight(t,e)})},getTextareaHeight(t,e){let{lineHeight:n,fontSize:o,height:i}=t.style;""===n&&(n=1.5);const s=(e.split("<br>").length-1)*n*(o||this.canvasStyleData.fontSize);return i>s?i:s}}},R=A,O=(0,p.Z)(R,s,r,!1,null,"dc07f38a",null),V=O.exports,Y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"component-list",on:{dragstart:t.handleDragStart}},t._l(t.componentList,(function(t,n){return e("div",{key:n,staticClass:"list",attrs:{draggable:"","data-index":n}},[e("span",{staticClass:"iconfont",class:"icon-"+t.icon})])})),0)},j=[],q=n(6845),F={data(){return{componentList:q.ZP}},methods:{handleDragStart(t){t.dataTransfer.setData("index",t.target.dataset.index)}}},W=F,H=(0,p.Z)(W,Y,j,!1,null,"dab766b8",null),U=H.exports,X=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"toolbar"},[e("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:t.undo}},[t._v("撤消")]),e("el-button",{attrs:{icon:"el-icon-refresh-right"},on:{click:t.redo}},[t._v("重做")]),e("el-divider",{attrs:{direction:"vertical"}}),e("el-button",{attrs:{icon:"el-icon-view"},on:{click:function(e){return t.preview(!1)}}},[t._v("预览")]),e("el-button",{attrs:{icon:"el-icon-picture"},on:{click:function(e){return t.preview(!0)}}},[t._v("截图")]),e("el-button",{attrs:{icon:"el-icon-folder-add"},on:{click:t.save}},[t._v("保存")]),e("el-button",{attrs:{icon:"el-icon-delete"},on:{click:t.clearCanvas}},[t._v("清空画布")]),e("el-divider",{attrs:{direction:"vertical"}}),e("div",{staticClass:"canvas-config"},[e("span",[t._v("画布大小")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.canvasStyleData.width,expression:"canvasStyleData.width"}],domProps:{value:t.canvasStyleData.width},on:{input:function(e){e.target.composing||t.$set(t.canvasStyleData,"width",e.target.value)}}}),e("span",[t._v("*")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.canvasStyleData.height,expression:"canvasStyleData.height"}],domProps:{value:t.canvasStyleData.height},on:{input:function(e){e.target.composing||t.$set(t.canvasStyleData,"height",e.target.value)}}})])],1),t.isShowPreview?e("Preview",{attrs:{"is-screenshot":t.isScreenshot},on:{close:t.handlePreviewChange}}):t._e()],1)},G=[],z=function(){var t=this,e=t._self._c;return e("div",{ref:"container",staticClass:"bg"},[t.isScreenshot?e("el-button",{staticClass:"close",on:{click:t.htmlToImage}},[t._v("确定")]):e("el-button",{staticClass:"close",on:{click:t.close}},[t._v("关闭")]),e("div",{staticClass:"canvas-container"},[e("div",{staticClass:"canvas",style:{...t.getCanvasStyle(t.canvasStyleData),width:t.changeStyleWithScale(t.canvasStyleData.width)+"px",height:t.changeStyleWithScale(t.canvasStyleData.height)+"px"}},t._l(t.copyData,(function(t,n){return e("ComponentWrapper",{key:n,attrs:{config:t}})})),1)])],1)},B=[],J=function(){var t=this,e=t._self._c;return e("div",{on:{click:t.onClick,mouseenter:t.onMouseEnter}},[t.config.component.startsWith("SVG")?e(t.config.component,{ref:"component",tag:"component",staticClass:"component",style:t.getSVGStyle(t.config.style),attrs:{"prop-value":t.config.propValue,element:t.config,request:t.config.request,linkage:t.config.linkage}}):e(t.config.component,{ref:"component",tag:"component",staticClass:"component",style:t.getStyle(t.config.style),attrs:{"prop-value":t.config.propValue,element:t.config,request:t.config.request,linkage:t.config.linkage}})],1)},K=[],Q={props:{config:{type:Object,required:!0,default:()=>{}}},mounted(){},methods:{getStyle:g.C2,getSVGStyle:g.WF,onClick(){const t=this.config.events;Object.keys(t).forEach((e=>{this[e](t[e])})),u.Z.$emit("v-click",this.config.id)},onMouseEnter(){u.Z.$emit("v-hover",this.config.id)}}},tt=Q,et=(0,p.Z)(tt,J,K,!1,null,"2d945531",null),nt=et.exports,ot=function(t,e,n,o){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function r(t){try{a(o.next(t))}catch(e){s(e)}}function c(t){try{a(o["throw"](t))}catch(e){s(e)}}function a(t){t.done?n(t.value):i(t.value).then(r,c)}a((o=o.apply(t,e||[])).next())}))};const it="application/font-woff",st="image/jpeg",rt={woff:it,woff2:it,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:st,jpeg:st,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"};function ct(t){const e=/\.([^./]*?)$/g.exec(t);return e?e[1]:""}function at(t){const e=ct(t).toLowerCase();return rt[e]||""}function lt(t,e){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;const n=document.implementation.createHTMLDocument(),o=n.createElement("base"),i=n.createElement("a");return n.head.appendChild(o),n.body.appendChild(i),e&&(o.href=e),i.href=t,i.href}function ut(t){return-1!==t.search(/^(data:)/)}function ht(t,e){return`data:${e};base64,${t}`}function dt(t){return t.split(/,/)[1]}const mt=function(){let t=0;const e=()=>`0000${(Math.random()*Math.pow(36,4)<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${e()}${t}`)}();function pt(t){const e=[];for(let n=0,o=t.length;n<o;n+=1)e.push(t[n]);return e}function ft(t,e){const n=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(n.replace("px",""))}function vt(t){const e=ft(t,"border-left-width"),n=ft(t,"border-right-width");return t.clientWidth+e+n}function gt(t){const e=ft(t,"border-top-width"),n=ft(t,"border-bottom-width");return t.clientHeight+e+n}function yt(){let t,e;try{e=process}catch(o){}const n=e&&e.env?e.env.devicePixelRatio:null;return n&&(t=parseInt(n,10),Number.isNaN(t)&&(t=1)),t||window.devicePixelRatio||1}function Ct(t){return new Promise(((e,n)=>{const o=new Image;o.onload=()=>e(o),o.onerror=n,o.crossOrigin="anonymous",o.decoding="sync",o.src=t}))}function wt(t){return ot(this,void 0,void 0,(function*(){return Promise.resolve().then((()=>(new XMLSerializer).serializeToString(t))).then(encodeURIComponent).then((t=>`data:image/svg+xml;charset=utf-8,${t}`))}))}function St(t,e,n){return ot(this,void 0,void 0,(function*(){const o="http://www.w3.org/2000/svg",i=document.createElementNS(o,"svg"),s=document.createElementNS(o,"foreignObject");return i.setAttribute("width",`${e}`),i.setAttribute("height",`${n}`),i.setAttribute("viewBox",`0 0 ${e} ${n}`),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("externalResourcesRequired","true"),i.appendChild(s),s.appendChild(t),wt(i)}))}const xt={};function bt(t){let e=t.replace(/\?.*/,"");return/ttf|otf|eot|woff2?/i.test(e)&&(e=e.replace(/.*\//,"")),e}function kt(t,e){const n=bt(t);if(null!=xt[n])return xt[n];e.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());const o=n=>{let o="";if(e.imagePlaceholder){const t=e.imagePlaceholder.split(/,/);t&&t[1]&&(o=t[1])}let i=`Failed to fetch resource: ${t}`;return n&&(i="string"===typeof n?n:n.message),i&&console.error(i),{blob:o,contentType:""}},i=window.fetch(t).then((t=>t.blob().then((e=>({blob:e,contentType:t.headers.get("Content-Type")||""}))))).then((({blob:t,contentType:e})=>new Promise(((n,o)=>{const i=new FileReader;i.onloadend=()=>n({contentType:e,blob:i.result}),i.onerror=o,i.readAsDataURL(t)})))).then((({blob:t,contentType:e})=>({contentType:e,blob:dt(t)}))).catch(o);return xt[n]=i,i}function $t(t){const e=t.getPropertyValue("content");return`${t.cssText} content: '${e.replace(/'|"/g,"")}';`}function Dt(t){return pt(t).map((e=>{const n=t.getPropertyValue(e),o=t.getPropertyPriority(e);return`${e}: ${n}${o?" !important":""};`})).join(" ")}function Pt(t,e,n){const o=`.${t}:${e}`,i=n.cssText?$t(n):Dt(n);return document.createTextNode(`${o}{${i}}`)}function Et(t,e,n){const o=window.getComputedStyle(t,n),i=o.getPropertyValue("content");if(""===i||"none"===i)return;const s=mt();try{e.className=`${e.className} ${s}`}catch(c){return}const r=document.createElement("style");r.appendChild(Pt(s,n,o)),e.appendChild(r)}function Nt(t,e){Et(t,e,":before"),Et(t,e,":after")}var Lt=function(t,e,n,o){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function r(t){try{a(o.next(t))}catch(e){s(e)}}function c(t){try{a(o["throw"](t))}catch(e){s(e)}}function a(t){t.done?n(t.value):i(t.value).then(r,c)}a((o=o.apply(t,e||[])).next())}))};function Tt(t){return Lt(this,void 0,void 0,(function*(){const e=t.toDataURL();return"data:,"===e?Promise.resolve(t.cloneNode(!1)):Ct(e)}))}function _t(t,e){return Lt(this,void 0,void 0,(function*(){return Promise.resolve(t.poster).then((t=>kt(t,e))).then((e=>ht(e.blob,at(t.poster)||e.contentType))).then((t=>Ct(t)))}))}function Zt(t,e){return Lt(this,void 0,void 0,(function*(){return t instanceof HTMLCanvasElement?Tt(t):t instanceof HTMLVideoElement&&t.poster?_t(t,e):Promise.resolve(t.cloneNode(!1))}))}const Mt=t=>null!=t.tagName&&"SLOT"===t.tagName.toUpperCase();function It(t,e,n){var o;return Lt(this,void 0,void 0,(function*(){const i=Mt(t)&&t.assignedNodes?pt(t.assignedNodes()):pt((null!==(o=t.shadowRoot)&&void 0!==o?o:t).childNodes);return 0===i.length||t instanceof HTMLVideoElement?Promise.resolve(e):i.reduce(((t,o)=>t.then((()=>Vt(o,n))).then((t=>{t&&e.appendChild(t)}))),Promise.resolve()).then((()=>e))}))}function At(t,e){const n=window.getComputedStyle(t),o=e.style;o&&(n.cssText?o.cssText=n.cssText:pt(n).forEach((t=>{o.setProperty(t,n.getPropertyValue(t),n.getPropertyPriority(t))})))}function Rt(t,e){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value),t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}function Ot(t,e){return Lt(this,void 0,void 0,(function*(){return e instanceof Element?Promise.resolve().then((()=>At(t,e))).then((()=>Nt(t,e))).then((()=>Rt(t,e))).then((()=>e)):Promise.resolve(e)}))}function Vt(t,e,n){return Lt(this,void 0,void 0,(function*(){return n||!e.filter||e.filter(t)?Promise.resolve(t).then((t=>Zt(t,e))).then((n=>It(t,n,e))).then((e=>Ot(t,e))):Promise.resolve(null)}))}var Yt=function(t,e,n,o){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function r(t){try{a(o.next(t))}catch(e){s(e)}}function c(t){try{a(o["throw"](t))}catch(e){s(e)}}function a(t){t.done?n(t.value):i(t.value).then(r,c)}a((o=o.apply(t,e||[])).next())}))};const jt=/url\((['"]?)([^'"]+?)\1\)/g,qt=/url\([^)]+\)\s*format\((["'])([^"']+)\1\)/g,Ft=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Wt(t){const e=t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}function Ht(t){const e=[];return t.replace(jt,((t,n,o)=>(e.push(o),t))),e.filter((t=>!ut(t)))}function Ut(t,e,n,o,i){const s=n?lt(e,n):e;return Promise.resolve(s).then((t=>i?i(t):kt(t,o))).then((t=>"string"===typeof t?ht(t,at(e)):ht(t.blob,at(e)||t.contentType))).then((n=>t.replace(Wt(e),`$1${n}$3`))).then((t=>t),(()=>s))}function Xt(t,{preferredFontFormat:e}){return e?t.replace(Ft,(t=>{while(1){const[n,,o]=qt.exec(t)||[];if(!o)return"";if(o===e)return`src: ${n};`}})):t}function Gt(t){return-1!==t.search(jt)}function zt(t,e,n){return Yt(this,void 0,void 0,(function*(){if(!Gt(t))return Promise.resolve(t);const o=Xt(t,n);return Promise.resolve(o).then(Ht).then((t=>t.reduce(((t,o)=>t.then((t=>Ut(t,o,e,n)))),Promise.resolve(o))))}))}var Bt=function(t,e,n,o){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function r(t){try{a(o.next(t))}catch(e){s(e)}}function c(t){try{a(o["throw"](t))}catch(e){s(e)}}function a(t){t.done?n(t.value):i(t.value).then(r,c)}a((o=o.apply(t,e||[])).next())}))};function Jt(t,e){var n;return Bt(this,void 0,void 0,(function*(){const o=null===(n=t.style)||void 0===n?void 0:n.getPropertyValue("background");return o?Promise.resolve(o).then((t=>zt(t,null,e))).then((e=>(t.style.setProperty("background",e,t.style.getPropertyPriority("background")),t))):Promise.resolve(t)}))}function Kt(t,e){return Bt(this,void 0,void 0,(function*(){if((!(t instanceof HTMLImageElement)||ut(t.src))&&(!(t instanceof SVGImageElement)||ut(t.href.baseVal)))return Promise.resolve(t);const n=t instanceof HTMLImageElement?t.src:t.href.baseVal;return Promise.resolve(n).then((t=>kt(t,e))).then((t=>ht(t.blob,at(n)||t.contentType))).then((e=>new Promise(((n,o)=>{t.onload=n,t.onerror=o,t instanceof HTMLImageElement?(t.srcset="",t.src=e):t.href.baseVal=e})))).then((()=>t),(()=>t))}))}function Qt(t,e){return Bt(this,void 0,void 0,(function*(){const n=pt(t.childNodes),o=n.map((t=>te(t,e)));return Promise.all(o).then((()=>t))}))}function te(t,e){return Bt(this,void 0,void 0,(function*(){return t instanceof Element?Promise.resolve(t).then((t=>Jt(t,e))).then((t=>Kt(t,e))).then((t=>Qt(t,e))):Promise.resolve(t)}))}function ee(t,e){const{style:n}=t;e.backgroundColor&&(n.backgroundColor=e.backgroundColor),e.width&&(n.width=`${e.width}px`),e.height&&(n.height=`${e.height}px`);const o=e.style;return null!=o&&Object.keys(o).forEach((t=>{n[t]=o[t]})),t}var ne=function(t,e,n,o){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function r(t){try{a(o.next(t))}catch(e){s(e)}}function c(t){try{a(o["throw"](t))}catch(e){s(e)}}function a(t){t.done?n(t.value):i(t.value).then(r,c)}a((o=o.apply(t,e||[])).next())}))};const oe={};function ie(t){const e=oe[t];if(null!=e)return e;const n=window.fetch(t).then((e=>({url:t,cssText:e.text()})));return oe[t]=n,n}function se(t){return ne(this,void 0,void 0,(function*(){return t.cssText.then((e=>{let n=e;const o=/url\(["']?([^"')]+)["']?\)/g,i=n.match(/url\([^)]+\)/g)||[],s=i.map((e=>{let i=e.replace(o,"$1");return i.startsWith("https://")||(i=new URL(i,t.url).href),window.fetch(i).then((t=>t.blob())).then((t=>new Promise(((o,i)=>{const s=new FileReader;s.onloadend=()=>{n=n.replace(e,`url(${s.result})`),o([e,s.result])},s.onerror=i,s.readAsDataURL(t)}))))}));return Promise.all(s).then((()=>n))}))}))}function re(t){if(null==t)return[];const e=[],n=/(\/\*[\s\S]*?\*\/)/gi;let o=t.replace(n,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");while(1){const t=i.exec(o);if(null===t)break;e.push(t[0])}o=o.replace(i,"");const s=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,r="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",c=new RegExp(r,"gi");while(1){let t=s.exec(o);if(null===t){if(t=c.exec(o),null===t)break;s.lastIndex=c.lastIndex}else c.lastIndex=s.lastIndex;e.push(t[0])}return e}function ce(t){return ne(this,void 0,void 0,(function*(){const e=[],n=[];return t.forEach((e=>{if("cssRules"in e)try{pt(e.cssRules).forEach(((t,o)=>{if(t.type===CSSRule.IMPORT_RULE){let i=o+1;const s=t.href,r=ie(s).then((t=>t?se(t):"")).then((t=>re(t).forEach((t=>{try{e.insertRule(t,t.startsWith("@import")?i+=1:e.cssRules.length)}catch(n){console.error("Error inserting rule from remote css",{rule:t,error:n})}})))).catch((t=>{console.error("Error loading remote css",t.toString())}));n.push(r)}}))}catch(o){const i=t.find((t=>null==t.href))||document.styleSheets[0];null!=e.href&&n.push(ie(e.href).then((t=>t?se(t):"")).then((t=>re(t).forEach((t=>{i.insertRule(t,e.cssRules.length)})))).catch((t=>{console.error("Error loading remote stylesheet",t.toString())}))),console.error("Error inlining remote css file",o.toString())}})),Promise.all(n).then((()=>(t.forEach((t=>{if("cssRules"in t)try{pt(t.cssRules).forEach((t=>{e.push(t)}))}catch(n){console.error(`Error while reading CSS rules from ${t.href}`,n.toString())}})),e)))}))}function ae(t){return t.filter((t=>t.type===CSSRule.FONT_FACE_RULE)).filter((t=>Gt(t.style.getPropertyValue("src"))))}function le(t){return ne(this,void 0,void 0,(function*(){return new Promise(((e,n)=>{null==t.ownerDocument&&n(new Error("Provided element is not within a Document")),e(pt(t.ownerDocument.styleSheets))})).then((t=>ce(t))).then(ae)}))}function ue(t,e){return ne(this,void 0,void 0,(function*(){return le(t).then((t=>Promise.all(t.map((t=>{const n=t.parentStyleSheet?t.parentStyleSheet.href:null;return zt(t.cssText,n,e)}))))).then((t=>t.join("\n")))}))}function he(t,e){return ne(this,void 0,void 0,(function*(){return(null!=e.fontEmbedCSS?Promise.resolve(e.fontEmbedCSS):ue(t,e)).then((e=>{const n=document.createElement("style"),o=document.createTextNode(e);return n.appendChild(o),t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),t}))}))}var de=function(t,e,n,o){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function r(t){try{a(o.next(t))}catch(e){s(e)}}function c(t){try{a(o["throw"](t))}catch(e){s(e)}}function a(t){t.done?n(t.value):i(t.value).then(r,c)}a((o=o.apply(t,e||[])).next())}))};function me(t,e={}){const n=e.width||vt(t),o=e.height||gt(t);return{width:n,height:o}}function pe(t,e={}){return de(this,void 0,void 0,(function*(){const{width:n,height:o}=me(t,e);return Promise.resolve(t).then((t=>Vt(t,e,!0))).then((t=>he(t,e))).then((t=>te(t,e))).then((t=>ee(t,e))).then((t=>St(t,n,o)))}))}const fe=16384;function ve(t){(t.width>fe||t.height>fe)&&(t.width>fe&&t.height>fe?t.width>t.height?(t.height*=fe/t.width,t.width=fe):(t.width*=fe/t.height,t.height=fe):t.width>fe?(t.height*=fe/t.width,t.width=fe):(t.width*=fe/t.height,t.height=fe))}function ge(t,e={}){return de(this,void 0,void 0,(function*(){return pe(t,e).then(Ct).then((n=>{const o=document.createElement("canvas"),i=o.getContext("2d"),s=e.pixelRatio||yt(),{width:r,height:c}=me(t,e),a=e.canvasWidth||r,l=e.canvasHeight||c;return o.width=a*s,o.height=l*s,e.skipAutoScale||ve(o),o.style.width=`${a}`,o.style.height=`${l}`,e.backgroundColor&&(i.fillStyle=e.backgroundColor,i.fillRect(0,0,o.width,o.height)),i.drawImage(n,0,0,o.width,o.height),o}))}))}function ye(t,e={}){return de(this,void 0,void 0,(function*(){return ge(t,e).then((t=>t.toDataURL()))}))}var Ce={components:{ComponentWrapper:nt},props:{isScreenshot:{type:Boolean,default:!1}},data(){return{copyData:[]}},computed:(0,c.rn)(["componentData","canvasStyleData"]),created(){this.$set(this,"copyData",(0,h.p$)(this.componentData))},methods:{getStyle:g.C2,getCanvasStyle:g.$i,changeStyleWithScale:y.EY,close(){this.$emit("close")},htmlToImage(){ye(this.$refs.container.querySelector(".canvas")).then((t=>{const e=document.createElement("a");e.setAttribute("download","screenshot"),e.href=t,e.click()})).catch((t=>{console.error("oops, something went wrong!",t)})).finally(this.close)}}},we=Ce,Se=(0,p.Z)(we,z,B,!1,null,"97e0a75a",null),xe=Se.exports;function be(){return localStorage.getItem("canvasData")}function ke(){return localStorage.getItem("canvasStyle")}function $e(t){return localStorage.setItem("canvasData",t)}function De(t){return localStorage.setItem("canvasStyle",t)}var Pe={components:{Preview:xe},data(){return{scale:100,isShowPreview:!1,isScreenshot:!1}},computed:(0,c.rn)(["componentData","canvasStyleData","curComponent","curComponentIndex"]),created(){u.Z.$on("preview",this.preview),u.Z.$on("save",this.save),u.Z.$on("clearCanvas",this.clearCanvas),this.scale=this.canvasStyleData.scale},methods:{redo(){this.$store.commit("redo")},undo(){this.$store.commit("undo")},preview(t){this.isScreenshot=t,this.isShowPreview=!0,this.$store.commit("setEditMode","preview")},handlePreviewChange(){this.isShowPreview=!1,this.$store.commit("setEditMode","edit")},save(){$e(JSON.stringify(this.componentData)),De(JSON.stringify(this.canvasStyleData)),this.$message.success("保存成功")},clearCanvas(){this.$store.commit("setCurComponent",{component:null,index:null}),this.$store.commit("setComponentData",[]),this.$store.commit("recordSnapshot")}}},Ee=Pe,Ne=(0,p.Z)(Ee,X,G,!1,null,"599f0072",null),Le=Ne.exports,Te=function(){var t=this,e=t._self._c;return e("div",{staticClass:"attr-container"},[e("p",{staticClass:"title"},[t._v("画布属性")]),e("el-form",{staticStyle:{padding:"20px"}},t._l(Object.keys(t.options),(function(n,o){return e("el-form-item",{key:o,attrs:{label:t.options[n]}},[t.isIncludesColor(n)?e("el-color-picker",{attrs:{"show-alpha":""},model:{value:t.canvasStyleData[n],callback:function(e){t.$set(t.canvasStyleData,n,e)},expression:"canvasStyleData[key]"}}):e("el-input",{attrs:{type:"number"},model:{value:t.canvasStyleData[n],callback:function(e){t.$set(t.canvasStyleData,n,t._n(e))},expression:"canvasStyleData[key]"}})],1)})),1)],1)},_e=[],Ze={data(){return{options:{fontSize:"字体大小",opacity:"不透明度",color:"前景色",backgroundColor:"背景色"}}},computed:(0,c.rn)(["canvasStyleData"]),methods:{isIncludesColor(t){return t.toLowerCase().includes("color")}}},Me=Ze,Ie=(0,p.Z)(Me,Te,_e,!1,null,null,null),Ae=Ie.exports,Re=function(){var t=this,e=t._self._c;return e("div",{staticClass:"real-time-component-list"},t._l(t.componentData,(function(n,o){return e("div",{key:o,staticClass:"list",class:{actived:t.transformIndex(o)===t.curComponentIndex},on:{click:function(e){t.onClick(t.transformIndex(o))}}},[e("span",{staticClass:"iconfont",class:"icon-"+t.getComponent(o).icon}),e("span",[t._v(t._s(t.getComponent(o).label)+" "+t._s(o))]),e("div",{staticClass:"icon-container"},[t.getComponent(o).isLock?e("span",{staticClass:"el-icon-unlock handlitem",attrs:{title:"解锁"},on:{click:function(e){t.unlock(t.transformIndex(o))}}}):[e("span",{staticClass:"el-icon-arrow-up handlitem",attrs:{title:"向上"},on:{click:function(e){t.upComponent(t.transformIndex(o))}}}),e("span",{staticClass:"el-icon-arrow-down handlitem",attrs:{title:"向下"},on:{click:function(e){t.downComponent(t.transformIndex(o))}}}),e("span",{staticClass:"el-icon-delete handlitem",attrs:{title:"删除"},on:{click:function(e){t.deleteComponent(t.transformIndex(o))}}}),e("span",{staticClass:"el-icon-lock handlitem",attrs:{title:"锁定"},on:{click:function(e){t.lock(t.transformIndex(o))}}})]],2)])})),0)},Oe=[],Ve={computed:(0,c.rn)(["componentData","curComponent","curComponentIndex"]),methods:{getComponent(t){let e=this.transformIndex(t);return this.componentData[e]},transformIndex(t){return this.componentData.length-1-t},onClick(t){this.setCurComponent(t)},unlock(){setTimeout((()=>{this.$store.commit("unlock")}))},lock(){setTimeout((()=>{this.$store.commit("lock")}))},deleteComponent(){setTimeout((()=>{this.$store.commit("deleteComponent")}))},upComponent(){setTimeout((()=>{this.$store.commit("upComponent")}))},downComponent(){setTimeout((()=>{this.$store.commit("downComponent")}))},setCurComponent(t){this.$store.commit("setCurComponent",{component:this.componentData[t],index:t})}}},Ye=Ve,je=(0,p.Z)(Ye,Re,Oe,!1,null,"6121bc72",null),qe=je.exports,Fe=n(1840),We=n(9299),He=n(715);const Ue=["width","height","fontSize"];function Xe(t){Object.keys(t.style).forEach((e=>{if(Ue.includes(e)){if("fontSize"===e&&""===t.style[e])return;t.style[e]=Ge(t.style[e],We.Z.state.canvasStyleData.scale)}}))}function Ge(t,e){return(0,He.JpY)(t,(0,He.csF)(parseFloat(e),100))}var ze=n(9657);function Be(t){return 2==t.button}var Je=n(3703),Ke={components:{Editor:V,ComponentList:U,Toolbar:Le,CanvasAttr:Ae,RealTimeComponentList:qe},data(){return{activeName:"attr",reSelectAnimateIndex:void 0}},computed:(0,c.rn)(["componentData","curComponent","isClickComponent","canvasStyleData","editor"]),created(){this.restore(),(0,ze.Y)()},methods:{restore(){let t=be();t&&((0,Je.o)(JSON.parse(t)),this.$store.commit("setComponentData",JSON.parse(t)));let e=ke();e&&this.$store.commit("setCanvasStyle",JSON.parse(e))},handleDrop(t){t.preventDefault(),t.stopPropagation();const e=t.dataTransfer.getData("index"),n=this.editor.getBoundingClientRect();if(e){const o=(0,h.p$)(q.ZP[e]);o.style.top=t.clientY-n.y,o.style.left=t.clientX-n.x,o.id=(0,Fe.Z)(),Xe(o),this.$store.commit("addComponent",{component:o})}},handleDragOver(t){t.preventDefault(),t.dataTransfer.dropEffect="copy"},handleMouseDown(t){t.stopPropagation(),this.$store.commit("setClickComponentStatus",!1),this.$store.commit("setInEditorStatus",!0)},deselectCurComponent(t){this.isClickComponent||this.$store.commit("setCurComponent",{component:null,index:null}),Be(t)||this.$store.commit("hideContextMenu")}}},Qe=Ke,tn=(0,p.Z)(Qe,o,i,!1,null,null,null),en=tn.exports},9657:function(t,e,n){n.d(e,{Y:function(){return D},k:function(){return S}});var o=n(9299),i=n(4003);const s=17,r=91,c=86,a=67,l=88,u=89,h=90,d=71,m=66,p=76,f=85,v=83,g=80,y=68,C=46,w=69,S=[66,67,68,69,71,76,80,83,85,86,88,89,90],x={[c]:E,[u]:L,[h]:T,[v]:M,[g]:I,[w]:R},b={...x,[f]:V},k={...x,[a]:P,[l]:N,[d]:_,[m]:Z,[y]:A,[C]:A,[p]:O};let $=!1;function D(){window.onkeydown=t=>{if(console.log(t),!o.Z.state.isInEdiotr)return;const{curComponent:e}=o.Z.state,{keyCode:n}=t;n===s||n===r?$=!0:n==C&&e?o.Z.commit("deleteComponent"):$&&(!k[n]||e&&e.isLock?b[n]&&e&&e.isLock&&(t.preventDefault(),b[n]()):(t.preventDefault(),k[n]()))},window.onkeyup=t=>{t.keyCode!==s&&t.keyCode!==r||($=!1)},window.onmousedown=()=>{o.Z.commit("setInEditorStatus",!1)}}function P(){o.Z.commit("copy")}function E(){o.Z.commit("paste")}function N(){o.Z.commit("cut")}function L(){o.Z.commit("redo")}function T(){o.Z.commit("undo")}function _(){o.Z.state.areaData.components.length&&o.Z.commit("compose")}function Z(){const t=o.Z.state.curComponent;t&&!t.isLock&&"Group"==t.component&&o.Z.commit("decompose")}function M(){i.Z.$emit("save")}function I(){i.Z.$emit("preview")}function A(){o.Z.state.curComponent&&o.Z.commit("deleteComponent")}function R(){i.Z.$emit("clearCanvas")}function O(){o.Z.commit("lock")}function V(){o.Z.commit("unlock")}}}]);
//# sourceMappingURL=530.d32b4d7c.js.map