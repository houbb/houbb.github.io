"use strict";(self["webpackChunkidrag"]=self["webpackChunkidrag"]||[]).push([[367],{6367:function(t,e,n){n.r(e),n.d(e,{default:function(){return m}});var o=function(){var t=this,e=t._self._c;return"edit"==t.editMode?e("div",{staticClass:"v-text",on:{keydown:t.handleKeydown,keyup:t.handleKeyup}},[e("div",{ref:"text",class:{"can-edit":t.canEdit},style:{verticalAlign:t.element.style.verticalAlign},attrs:{contenteditable:t.canEdit,tabindex:"0"},domProps:{innerHTML:t._s(t.element.propValue)},on:{dblclick:t.setEdit,paste:t.clearStyle,mousedown:t.handleMousedown,blur:t.handleBlur,input:t.handleInput}})]):e("div",{staticClass:"v-text preview"},[e("div",{style:{verticalAlign:t.element.style.verticalAlign},domProps:{innerHTML:t._s(t.element.propValue)}})])},i=[],s=(n(6699),n(629)),r=n(9657),a=n(2689),c=n(4003),l=n(4471),u={extends:a.Z,props:{propValue:{type:String,required:!0,default:""},request:{type:Object,default:()=>{}},element:{type:Object,default:()=>{}},linkage:{type:Object,default:()=>{}}},data(){return{canEdit:!1,ctrlKey:17,isCtrlDown:!1,cancelRequest:null}},computed:{...(0,s.rn)(["editMode","curComponent"])},created(){c.Z.$on("componentClick",this.onComponentClick),this.request&&(this.cancelRequest=(0,l.ZP)(this.request,this.element,"propValue","string"))},beforeDestroy(){c.Z.$off("componentClick",this.onComponentClick),this.request&&this.cancelRequest()},methods:{onComponentClick(){this.curComponent.id!==this.element.id&&(this.canEdit=!1)},handleInput(t){this.$emit("input",this.element,t.target.innerHTML)},handleKeydown(t){this.canEdit&&t.stopPropagation(),t.keyCode==this.ctrlKey?this.isCtrlDown=!0:(this.isCtrlDown&&this.canEdit&&r.k.includes(t.keyCode)||46==t.keyCode)&&t.stopPropagation()},handleKeyup(t){this.canEdit&&t.stopPropagation(),t.keyCode==this.ctrlKey&&(this.isCtrlDown=!1)},handleMousedown(t){this.canEdit&&t.stopPropagation()},clearStyle(t){t.preventDefault();const e=t.clipboardData,n=e.getData("text/plain")||"";""!==n&&document.execCommand("insertText",!1,n),this.$emit("input",this.element,t.target.innerHTML)},handleBlur(t){this.element.propValue=t.target.innerHTML||"&nbsp;";const e=t.target.innerHTML;""!==e?this.element.propValue=t.target.innerHTML:(this.element.propValue="",this.$nextTick((()=>{this.element.propValue="&nbsp;"}))),this.canEdit=!1},setEdit(){this.element.isLock||(this.canEdit=!0,this.selectText(this.$refs.text))},selectText(t){const e=window.getSelection(),n=document.createRange();n.selectNodeContents(t),e.removeAllRanges(),e.addRange(n)}}},d=u,p=n(1001),h=(0,p.Z)(d,o,i,!1,null,"608c3f9e",null),m=h.exports},2689:function(t,e,n){n.d(e,{Z:function(){return u}});var o,i,s=n(4003),r={props:{linkage:{type:Object,default:()=>{}},element:{type:Object,default:()=>{}}},created(){this.linkage?.data?.length&&(s.Z.$on("v-click",this.onClick),s.Z.$on("v-hover",this.onHover))},mounted(){const{data:t,duration:e}=this.linkage||{};t?.length&&(this.$el.style.transition=`all ${e}s`)},beforeDestroy(){this.linkage?.data?.length&&(s.Z.$off("v-click",this.onClick),s.Z.$off("v-hover",this.onHover))},methods:{changeStyle(t=[]){t.forEach((t=>{t.style.forEach((t=>{t.key&&(this.element.style[t.key]=t.value)}))}))},onClick(t){const e=this.linkage.data.filter((e=>e.id===t&&"v-click"===e.event));this.changeStyle(e)},onHover(t){const e=this.linkage.data.filter((e=>e.id===t&&"v-hover"===e.event));this.changeStyle(e)}}},a=r,c=n(1001),l=(0,c.Z)(a,o,i,!1,null,null,null),u=l.exports},4471:function(t,e,n){n.d(e,{Ax:function(){return c},ZP:function(){return l},_q:function(){return i}});var o=n(4720);const i=/(https?):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/;function s(t){return new Promise(((e,n)=>{const o=new XMLHttpRequest;o.timeout=6e3;let i=c(t.url);"GET"===t.method&&(i+=`${r(t.data)}`),o.open(t.method,i),o.ontimeout=n,o.onerror=n,o.onload=t=>{e(t.target.response)},o.send(JSON.stringify(a(t.data,t.paramType)))}))}function r(t){let e="";return t.forEach((t=>{t[0]&&(e+=`&${t[0]}=${t[1]}`)})),e?"?"+e:""}function a(t,e){if(!t)return"";if("array"===e)return t;const n={};return t.forEach((t=>{t[0]&&(n[t[0]]=t[1])})),n}function c(t){return t.startsWith("http")?t:"https://"+t}function l(t,e,n,r="object"){let a,l=0;const u=t?.url;return(u&&!/^\d+$/.test(u)||i.test(c(u)))&&(t.series?a=setInterval((()=>{0!=t.requestCount&&t.requestCount<=l?clearInterval(a):(l++,s(t,r).then((t=>{e[n]="object"===r||"array"===r?JSON.parse(t):t})).catch((t=>o.Message.error(t?.message||t))))}),t.time):s(t,r).then((t=>{e[n]="object"===r||"array"===r?JSON.parse(t):t})).catch((t=>o.Message.error(t?.message||t)))),function(){clearInterval(a)}}},9657:function(t,e,n){n.d(e,{Y:function(){return x},k:function(){return Z}});var o=n(4017),i=n(4003);const s=17,r=91,a=86,c=67,l=88,u=89,d=90,p=71,h=66,m=76,f=85,y=83,k=80,g=68,v=46,C=69,Z=[66,67,68,69,71,76,80,83,85,86,88,89,90],w={[a]:T,[u]:D,[d]:L,[y]:P,[k]:j,[C]:O},b={...w,[f]:I},E={...w,[c]:M,[l]:q,[p]:H,[h]:S,[g]:A,[v]:A,[m]:V};let $=!1;function x(){window.onkeydown=t=>{if(console.log(t),!o.Z.state.isInEdiotr)return;const{curComponent:e}=o.Z.state,{keyCode:n}=t;n===s||n===r?$=!0:n==v&&e?o.Z.commit("deleteComponent"):$&&(!E[n]||e&&e.isLock?b[n]&&e&&e.isLock&&(t.preventDefault(),b[n]()):(t.preventDefault(),E[n]()))},window.onkeyup=t=>{t.keyCode!==s&&t.keyCode!==r||($=!1)},window.onmousedown=()=>{o.Z.commit("setInEditorStatus",!1)}}function M(){o.Z.commit("copy")}function T(){o.Z.commit("paste")}function q(){o.Z.commit("cut")}function D(){o.Z.commit("redo")}function L(){o.Z.commit("undo")}function H(){o.Z.state.areaData.components.length&&o.Z.commit("compose")}function S(){const t=o.Z.state.curComponent;t&&!t.isLock&&"Group"==t.component&&o.Z.commit("decompose")}function P(){i.Z.$emit("save")}function j(){i.Z.$emit("preview")}function A(){o.Z.state.curComponent&&o.Z.commit("deleteComponent")}function O(){i.Z.$emit("clearCanvas")}function V(){o.Z.commit("lock")}function I(){o.Z.commit("unlock")}}}]);
//# sourceMappingURL=367.203dc898.js.map