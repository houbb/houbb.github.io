"use strict";(self["webpackChunkidrag"]=self["webpackChunkidrag"]||[]).push([[134],{3134:function(t,e,n){n.r(e),n.d(e,{default:function(){return vt}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home"},[e("Toolbar"),e("main",[e("section",{staticClass:"left"},[e("ComponentList"),e("RealTimeComponentList")],1),e("section",{staticClass:"center"},[e("div",{staticClass:"content",on:{drop:t.handleDrop,dragover:t.handleDragOver,mousedown:t.handleMouseDown,mouseup:t.deselectCurComponent}},[e("Editor")],1)]),e("section",{staticClass:"right"},[t.curComponent?e("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:"属性",name:"attr"}},[e(t.curComponent.component+"Attr",{tag:"component"})],1)],1):e("CanvasAttr")],1)])],1)},s=[],i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"editor",class:{edit:t.isEdit},style:{...t.getCanvasStyle(t.canvasStyleData),width:t.changeStyleWithScale(t.canvasStyleData.width)+"px",height:t.changeStyleWithScale(t.canvasStyleData.height)+"px"},attrs:{id:"editor"},on:{mousedown:t.handleMouseDown,contextmenu:t.handleContextMenu}},[e("Grid"),t._l(t.componentData,(function(n,o){return e("Shape",{key:n.id,class:{lock:n.isLock},style:t.getShapeStyle(n.style),attrs:{"default-style":n.style,active:n.id===(t.curComponent||{}).id,element:n,index:o}},[n.component.startsWith("SVG")?e(n.component,{tag:"component",staticClass:"component",style:t.getSVGStyle(n.style),attrs:{id:"component"+n.id,"prop-value":n.propValue,element:n,request:n.request}}):"VText"!=n.component?e(n.component,{tag:"component",staticClass:"component",style:t.getComponentStyle(n.style),attrs:{id:"component"+n.id,"prop-value":n.propValue,element:n,request:n.request}}):e(n.component,{tag:"component",staticClass:"component",style:t.getComponentStyle(n.style),attrs:{id:"component"+n.id,"prop-value":n.propValue,element:n,request:n.request},on:{input:t.handleInput}})],1)})),e("ContextMenu")],2)},a=[],c=(n(6699),n(629)),r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"shape",class:{active:t.active},on:{click:t.selectCurComponent,mousedown:t.handleMouseDownOnShape}},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.isActive(),expression:"isActive()"}],staticClass:"iconfont icon-xiangyouxuanzhuan",on:{mousedown:t.handleRotate}}),e("span",{directives:[{name:"show",rawName:"v-show",value:t.element.isLock,expression:"element.isLock"}],staticClass:"iconfont icon-suo"}),t._l(t.isActive()?t.getPointList():[],(function(n){return e("div",{key:n,staticClass:"shape-point",style:t.getPointStyle(n),on:{mousedown:function(e){return t.handleMouseDownOnPoint(n,e)}}})})),t._t("default")],2)},l=[],m=n(4003),u=n(2648),p={props:{active:{type:Boolean,default:!1},element:{required:!0,type:Object,default:()=>{}},defaultStyle:{required:!0,type:Object,default:()=>{}},index:{required:!0,type:[Number,String],default:0}},data(){return{pointList:["lt","t","rt","r","rb","b","lb","l"],pointList2:["r","l"],initialAngle:{lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315},angleToCursor:[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}],cursors:{}}},computed:(0,c.rn)(["curComponent","editor"]),mounted(){this.curComponent&&(this.cursors=this.getCursor())},methods:{handleRotate(){console.log("暂不支持旋转，敬请期待!")},getPointList(){return"line-shape"===this.element.component?this.pointList2:this.pointList},isActive(){return this.active&&!this.element.isLock},getPointStyle(t){const{width:e,height:n}=this.defaultStyle,o=/t/.test(t),s=/b/.test(t),i=/l/.test(t),a=/r/.test(t);let c=0,r=0;2===t.length?(c=i?0:e,r=o?0:n):((o||s)&&(c=e/2,r=o?0:n),(i||a)&&(c=i?0:e,r=Math.floor(n/2)));const l={marginLeft:"-4px",marginTop:"-4px",left:`${c}px`,top:`${r}px`,cursor:this.cursors[t]};return l},getCursor(){const t={};return t},handleMouseDownOnShape(t){if(this.$nextTick((()=>m.Z.$emit("componentClick"))),this.$store.commit("setInEditorStatus",!0),this.$store.commit("setClickComponentStatus",!0),(0,u.rc)(this.element.component)&&t.preventDefault(),t.stopPropagation(),this.$store.commit("setCurComponent",{component:this.element,index:this.index}),this.element.isLock)return;this.cursors=this.getCursor();const e={...this.defaultStyle},n=t.clientY,o=t.clientX,s=Number(e.top),i=Number(e.left);let a=!1;const c=t=>{a=!0;const c=t.clientX,r=t.clientY;e.top=r-n+s,e.left=c-o+i,this.$store.commit("setShapeStyle",e),this.$nextTick((()=>{m.Z.$emit("move",r-n>0,c-o>0)}))},r=()=>{m.Z.$emit("unmove"),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",c),document.addEventListener("mouseup",r)},selectCurComponent(t){t.stopPropagation(),t.preventDefault(),this.$store.commit("hideContextMenu")},handleMouseDownOnPoint(t,e){},isNeedLockProportion(){return!1}}},d=p,h=n(1001),C=(0,h.Z)(d,r,l,!1,null,"0e4c9b78",null),v=C.exports,f=n(9748),g=n(1457),y=function(){var t=this,e=t._self._c;return e("svg",{staticClass:"grid",attrs:{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg"}},[e("defs",[e("pattern",{attrs:{id:"smallGrid",width:"7.236328125",height:"7.236328125",patternUnits:"userSpaceOnUse"}},[e("path",{attrs:{d:"M 7.236328125 0 L 0 0 0 7.236328125",fill:"none",stroke:"rgba(207, 207, 207, 0.3)","stroke-width":"1"}})]),e("pattern",{attrs:{id:"grid",width:"36.181640625",height:"36.181640625",patternUnits:"userSpaceOnUse"}},[e("rect",{attrs:{width:"36.181640625",height:"36.181640625",fill:"url(#smallGrid)"}}),e("path",{attrs:{d:"M 36.181640625 0 L 0 0 0 36.181640625",fill:"none",stroke:"rgba(186, 186, 186, 0.5)","stroke-width":"1"}})])]),e("rect",{attrs:{width:"100%",height:"100%",fill:"url(#grid)"}})])},k=[],w={},S=(0,h.Z)(w,y,k,!1,null,"39ef9482",null),x=S.exports,D=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.menuShow,expression:"menuShow"}],staticClass:"contextmenu",style:{top:t.menuTop+"px",left:t.menuLeft+"px"}},[e("ul",{on:{mouseup:t.handleMouseUp}},[t.curComponent?[t.curComponent.isLock?e("li",{staticClass:"el-icon-unlock",on:{click:t.unlock}},[t._v(" 解锁")]):[e("li",{staticClass:"el-icon-top",on:{click:t.topComponent}},[t._v(" 置顶")]),e("li",{staticClass:"el-icon-bottom",on:{click:t.bottomComponent}},[t._v(" 置底")]),e("li",{staticClass:"el-icon-arrow-up",on:{click:t.upComponent}},[t._v(" 上移")]),e("li",{staticClass:"el-icon-arrow-down",on:{click:t.downComponent}},[t._v(" 下移")]),e("el-divider"),e("li",{staticClass:"el-icon-document-copy",on:{click:t.copy}},[t._v(" 复制")]),e("li",{staticClass:"el-icon-copy-document",on:{click:t.paste}},[t._v(" 粘贴")]),e("li",{staticClass:"el-icon-scissors",on:{click:t.cut}},[t._v(" 剪切")]),e("li",{staticClass:"el-icon-delete",on:{click:t.deleteComponent}},[t._v(" 删除")]),e("el-divider"),e("li",{staticClass:"el-icon-lock",on:{click:t.lock}},[t._v(" 加锁")])]]:e("li",{staticClass:"el-icon-copy-document",on:{click:t.paste}},[t._v(" 粘贴")])],2)])},$=[],b={data(){return{copyData:null}},computed:(0,c.rn)(["menuTop","menuLeft","menuShow","curComponent"]),methods:{handleMouseUp(){this.$store.commit("setClickComponentStatus",!0)},deleteComponent(){this.$store.commit("deleteComponent")},upComponent(){this.$store.commit("upComponent")},downComponent(){this.$store.commit("downComponent")},topComponent(){this.$store.commit("topComponent")},bottomComponent(){this.$store.commit("bottomComponent")},copy(){this.$store.commit("copy")},paste(){this.$store.commit("copy")},cut(){this.$store.commit("cut")},lock(){this.$store.commit("lock")},unlock(){this.$store.commit("unlock")}}},_=b,L=(0,h.Z)(_,D,$,!1,null,"3937014e",null),Z=L.exports,A={components:{Shape:v,Grid:x,ContextMenu:Z},props:{isEdit:{type:Boolean,default:!0}},data(){return{editorX:0,editorY:0,start:{x:0,y:0},width:0,height:0,isShowArea:!1,svgFilterAttrs:["width","height","top","left","rotate"]}},computed:(0,c.rn)(["componentData","curComponent","canvasStyleData","editor"]),mounted(){this.$store.commit("getEditor"),m.Z.$on("hideArea",(()=>{this.hideArea()}))},methods:{getShapeStyle:f.B$,getCanvasStyle:f.$i,changeStyleWithScale:g.EY,handleContextMenu(t){t.stopPropagation(),t.preventDefault();let e=t.target,n=t.offsetY,o=t.offsetX;while(e instanceof SVGElement)e=e.parentNode;while(!e.className.includes("editor"))o+=e.offsetLeft,n+=e.offsetTop,e=e.parentNode;this.$store.commit("showContextMenu",{top:n,left:o})},handleMouseDown(t){this.curComponent&&!(0,u.rc)(this.curComponent.component)||t.preventDefault(),this.hideArea();const e=this.editor.getBoundingClientRect();this.editorX=e.x,this.editorY=e.y;const n=t.clientX,o=t.clientY;this.start.x=n-this.editorX,this.start.y=o-this.editorY,this.isShowArea=!0;const s=t=>{this.width=Math.abs(t.clientX-n),this.height=Math.abs(t.clientY-o),t.clientX<n&&(this.start.x=t.clientX-this.editorX),t.clientY<o&&(this.start.y=t.clientY-this.editorY)},i=t=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",i),t.clientX==n&&t.clientY==o&&this.hideArea()};document.addEventListener("mousemove",s),document.addEventListener("mouseup",i)},hideArea(){this.isShowArea=0,this.width=0,this.height=0,this.$store.commit("setAreaData",{style:{left:0,top:0,width:0,height:0},components:[]})},getSelectArea(){const t=[],{x:e,y:n}=this.start;return this.componentData.forEach((o=>{if(o.isLock)return;const{left:s,top:i,width:a,height:c}=(0,f.fg)(o.style);e<=s&&n<=i&&s+a<=e+this.width&&i+c<=n+this.height&&t.push(o)})),t},getComponentStyle(t){return(0,f.C2)(t,this.svgFilterAttrs)},getSVGStyle(t){return(0,f.WF)(t,this.svgFilterAttrs)},handleInput(t,e){this.$store.commit("setShapeStyle",{height:this.getTextareaHeight(t,e)})},getTextareaHeight(t,e){let{lineHeight:n,fontSize:o,height:s}=t.style;""===n&&(n=1.5);const i=(e.split("<br>").length-1)*n*(o||this.canvasStyleData.fontSize);return s>i?s:i}}},E=A,M=(0,h.Z)(E,i,a,!1,null,"92ca7642",null),T=M.exports,I=function(){var t=this,e=t._self._c;return e("div",{staticClass:"component-list",on:{dragstart:t.handleDragStart}},t._l(t.componentList,(function(t,n){return e("div",{key:n,staticClass:"list",attrs:{draggable:"","data-index":n}},[e("span",{staticClass:"iconfont",class:"icon-"+t.icon})])})),0)},Y=[],N=n(6845),P={data(){return{componentList:N.ZP}},methods:{handleDragStart(t){t.dataTransfer.setData("index",t.target.dataset.index)}}},X=P,O=(0,h.Z)(X,I,Y,!1,null,"dab766b8",null),q=O.exports,G=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"toolbar"},[e("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:t.undo}},[t._v("撤消")]),e("el-button",{attrs:{icon:"el-icon-refresh-right"},on:{click:t.redo}},[t._v("重做")]),e("el-divider",{attrs:{direction:"vertical"}}),e("div",{staticClass:"canvas-config"},[e("span",[t._v("画布大小")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.canvasStyleData.width,expression:"canvasStyleData.width"}],domProps:{value:t.canvasStyleData.width},on:{input:function(e){e.target.composing||t.$set(t.canvasStyleData,"width",e.target.value)}}}),e("span",[t._v("*")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.canvasStyleData.height,expression:"canvasStyleData.height"}],domProps:{value:t.canvasStyleData.height},on:{input:function(e){e.target.composing||t.$set(t.canvasStyleData,"height",e.target.value)}}})])],1)])},V=[],z={components:{},data(){return{scale:100}},computed:(0,c.rn)(["canvasStyleData"]),created(){this.scale=this.canvasStyleData.scale},methods:{redo(){this.$store.commit("redo")},undo(){this.$store.commit("undo")}}},F=z,R=(0,h.Z)(F,G,V,!1,null,"7c3e23c0",null),U=R.exports,B=function(){var t=this,e=t._self._c;return e("div",{staticClass:"attr-container"},[e("p",{staticClass:"title"},[t._v("画布属性")]),e("el-form",{staticStyle:{padding:"20px"}},t._l(Object.keys(t.options),(function(n,o){return e("el-form-item",{key:o,attrs:{label:t.options[n]}},[t.isIncludesColor(n)?e("el-color-picker",{attrs:{"show-alpha":""},model:{value:t.canvasStyleData[n],callback:function(e){t.$set(t.canvasStyleData,n,e)},expression:"canvasStyleData[key]"}}):e("el-input",{attrs:{type:"number"},model:{value:t.canvasStyleData[n],callback:function(e){t.$set(t.canvasStyleData,n,t._n(e))},expression:"canvasStyleData[key]"}})],1)})),1)],1)},W=[],j={data(){return{options:{fontSize:"字体大小",opacity:"不透明度",color:"前景色",backgroundColor:"背景色"}}},computed:(0,c.rn)(["canvasStyleData"]),methods:{isIncludesColor(t){return t.toLowerCase().includes("color")}}},H=j,J=(0,h.Z)(H,B,W,!1,null,null,null),K=J.exports,Q=function(){var t=this,e=t._self._c;return e("div",{staticClass:"real-time-component-list"},t._l(t.componentData,(function(n,o){return e("div",{key:o,staticClass:"list",class:{actived:t.transformIndex(o)===t.curComponentIndex},on:{click:function(e){t.onClick(t.transformIndex(o))}}},[e("span",{staticClass:"iconfont",class:"icon-"+t.getComponent(o).icon}),e("span",[t._v(t._s(t.getComponent(o).label)+" "+t._s(o))]),e("div",{staticClass:"icon-container"},[t.getComponent(o).isLock?e("span",{staticClass:"el-icon-unlock handlitem",attrs:{title:"解锁"},on:{click:function(e){t.unlock(t.transformIndex(o))}}}):[e("span",{staticClass:"el-icon-arrow-up handlitem",attrs:{title:"向上"},on:{click:function(e){t.upComponent(t.transformIndex(o))}}}),e("span",{staticClass:"el-icon-arrow-down handlitem",attrs:{title:"向下"},on:{click:function(e){t.downComponent(t.transformIndex(o))}}}),e("span",{staticClass:"el-icon-delete handlitem",attrs:{title:"删除"},on:{click:function(e){t.deleteComponent(t.transformIndex(o))}}}),e("span",{staticClass:"el-icon-lock handlitem",attrs:{title:"锁定"},on:{click:function(e){t.lock(t.transformIndex(o))}}})]],2)])})),0)},tt=[],et={computed:(0,c.rn)(["componentData","curComponent","curComponentIndex"]),methods:{getComponent(t){let e=this.transformIndex(t);return this.componentData[e]},transformIndex(t){return this.componentData.length-1-t},onClick(t){this.setCurComponent(t)},unlock(){setTimeout((()=>{this.$store.commit("unlock")}))},lock(){setTimeout((()=>{this.$store.commit("lock")}))},deleteComponent(){setTimeout((()=>{this.$store.commit("deleteComponent")}))},upComponent(){setTimeout((()=>{this.$store.commit("upComponent")}))},downComponent(){setTimeout((()=>{this.$store.commit("downComponent")}))},setCurComponent(t){this.$store.commit("setCurComponent",{component:this.componentData[t],index:t})}}},nt=et,ot=(0,h.Z)(nt,Q,tt,!1,null,"6121bc72",null),st=ot.exports,it=n(1840),at=n(3473),ct=n(715);const rt=["width","height","fontSize"];function lt(t){Object.keys(t.style).forEach((e=>{if(rt.includes(e)){if("fontSize"===e&&""===t.style[e])return;t.style[e]=mt(t.style[e],at.Z.state.canvasStyleData.scale)}}))}function mt(t,e){return(0,ct.JpY)(t,(0,ct.csF)(parseFloat(e),100))}var ut=n(9657);function pt(t){return 2==t.button}var dt={components:{Editor:T,ComponentList:q,Toolbar:U,CanvasAttr:K,RealTimeComponentList:st},data(){return{activeName:"attr",reSelectAnimateIndex:void 0}},computed:(0,c.rn)(["componentData","curComponent","isClickComponent","canvasStyleData","editor"]),created(){this.restore(),(0,ut.Y)()},methods:{restore(){},handleDrop(t){t.preventDefault(),t.stopPropagation();const e=t.dataTransfer.getData("index"),n=this.editor.getBoundingClientRect();if(e){const o=(0,u.p$)(N.ZP[e]);o.style.top=t.clientY-n.y,o.style.left=t.clientX-n.x,o.id=(0,it.Z)(),lt(o),this.$store.commit("addComponent",{component:o})}},handleDragOver(t){t.preventDefault(),t.dataTransfer.dropEffect="copy"},handleMouseDown(t){t.stopPropagation(),this.$store.commit("setClickComponentStatus",!1),this.$store.commit("setInEditorStatus",!0)},deselectCurComponent(t){this.isClickComponent||this.$store.commit("setCurComponent",{component:null,index:null}),pt(t)||this.$store.commit("hideContextMenu")}}},ht=dt,Ct=(0,h.Z)(ht,o,s,!1,null,null,null),vt=Ct.exports},9657:function(t,e,n){n.d(e,{Y:function(){return b},k:function(){return w}});var o=n(3473),s=n(4003);const i=17,a=91,c=86,r=67,l=88,m=89,u=90,p=71,d=66,h=76,C=85,v=83,f=80,g=68,y=46,k=69,w=[66,67,68,69,71,76,80,83,85,86,88,89,90],S={[c]:L,[m]:A,[u]:E,[v]:I,[f]:Y,[k]:P},x={...S,[C]:O},D={...S,[r]:_,[l]:Z,[p]:M,[d]:T,[g]:N,[y]:N,[h]:X};let $=!1;function b(){window.onkeydown=t=>{if(console.log(t),!o.Z.state.isInEdiotr)return;const{curComponent:e}=o.Z.state,{keyCode:n}=t;n===i||n===a?$=!0:n==y&&e?o.Z.commit("deleteComponent"):$&&(!D[n]||e&&e.isLock?x[n]&&e&&e.isLock&&(t.preventDefault(),x[n]()):(t.preventDefault(),D[n]()))},window.onkeyup=t=>{t.keyCode!==i&&t.keyCode!==a||($=!1)},window.onmousedown=()=>{o.Z.commit("setInEditorStatus",!1)}}function _(){o.Z.commit("copy")}function L(){o.Z.commit("paste")}function Z(){o.Z.commit("cut")}function A(){o.Z.commit("redo")}function E(){o.Z.commit("undo")}function M(){o.Z.state.areaData.components.length&&o.Z.commit("compose")}function T(){const t=o.Z.state.curComponent;t&&!t.isLock&&"Group"==t.component&&o.Z.commit("decompose")}function I(){s.Z.$emit("save")}function Y(){s.Z.$emit("preview")}function N(){o.Z.state.curComponent&&o.Z.commit("deleteComponent")}function P(){s.Z.$emit("clearCanvas")}function X(){o.Z.commit("lock")}function O(){o.Z.commit("unlock")}}}]);
//# sourceMappingURL=134.bdd1f16b.js.map